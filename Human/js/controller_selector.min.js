var HdTradeDef={NewGroup:{GAME_SALE:48,ALL_FESTIVAL:1,NFESTIVAL_YUANDAN:2,ALL_TYPE:46,ALL_PLAY:52,NOT_FESTIVAL:44,HANDLE_TYPE:60,NONE:0,},Id:{NORMAL:0,PROPERTY:14,}};var HdVerDef={FREE:0,BY:1,BJ:2,MD:3,};var Oss={Bss:{HD_TEMPLATES_CLICK:46}};var isClickActive=false;var selectShow;var change=0;if(countInfo.isShowOriginal){selectShow=angular.module("selectShowApp",["ngRoute"]);selectShow.config(["$routeProvider",function(a){a.when("/",{}).when("/prototype",{templateUrl:"proTypeGame.jsp"}).otherwise({redirectTo:"/"})}])}else{selectShow=angular.module("selectShowApp",[])}(function(d){var g=[].concat(countInfo.hdModelList[0].sysKeyword);countInfo.hdModelList[0].sysKeyword=countInfo.hdModelList[0].sysKeyword.join(" ");var f=function(o){if(!o){return}top.HdPortal.asyncCss.load("popup_guideOtherProduct",o.guideCss,function(){var q='<div class="hd_guideto_otherProduct"><div class="shutDownBox clearfix"><img class="shutDownNow floatRight" src="'+o.closeBtn+'"></div><div class="hd_guideto_inner"><p class="hd_guide_title">创建该模板需前往<span class="biggerFont">凡科微传单</span></p><div class="hd_special_pic"><img src="'+o.specialImg+'"></div><div class="clickBtnBox"><span class="goNow">立即前往</span><span class="waitAsecond">再看看</span></div></div></div>';var p=HdPortal.popup({name:"guideToFlyer",content:q,hasTitle:false,hasBottom:false,mustHideBg:true,hasBottom:false,});p.find(".shutDownNow").on("click",function(){p.hide();top.$(".bg-mask").hide();HdPortal.logDog(1000266,6)});p.find(".goNow").on("click",function(){top.open("http://"+o.guideHref+"/manage/flyerManage.jsp?openFrom=201");HdPortal.logDog(1000266,4)});p.find(".waitAsecond").on("click",function(){p.hide();HdPortal.logDog(1000266,5);top.$(".bg-mask").hide()});HdPortal.logDog(1000266,3)})};var k=function(p){if(!p||!p.gameArr){return}var q='<div class="hd_faster_get_game"><p class="theTopFixer"><img src="'+HdPortal.resRoot+'/version2/image/fasterStart/diamond.png" alt=""><span>试试创建一个你感兴趣的活动</span><img src="'+HdPortal.resRoot+'/version2/image/fasterStart/diamond.png" alt=""></p><div class="mainBoxer">';$.each(p.gameArr,function(r,s){q+='<div class="faster_Boxer faster_marginLeft" index="'+r+'"><img src="'+HdPortal.resRoot+"/version2/image/fasterStart/"+s.img+'" alt=""><p class="hd_inforMsg">'+s.gameName+"</p></div>"});q+='</div><p class="notCreate"><a href="#">先随便看看</a></p></div>';var o=HdPortal.popup({name:"fasterCreate",content:q,hasTitle:false,hasBottom:false,mustHideBg:true,hasBottom:false,});p.afterInit&&p.afterInit(o);o.find(".mainBoxer").on("click.clickFaster",".faster_Boxer",function(){var r=parseInt($(this).attr("index"));var v=p.gameArr[r].modelId;var u=p.gameArr[r].srcId;u&&HdPortal.logDog(1000228,u);var t;var s=countInfo.hdModelList;$("#ActiveBox2 .modActive").each(function(w){var x=parseInt($(this).attr("index"));if(s[x].id==v){t=$(this);return false}});if(t){if(!$(this).data("hasClick")){$(this).data("hasClick",true);HdPortal.loading.show();$.ajax({type:"post",url:"/ajax/hdportal_h.jsp?cmd=clickFaster",error:function(){HdPortal.loading.hide();HdPortal.hdShowMsg("error","服务繁忙，请稍候重试",false)},success:function(x){var w=$.parseJSON(x);HdPortal.loading.hide();if(w.rt==0){o.remove();top.$(".bg-mask").hide();showEditActivePage(t)}else{HdPortal.hdShowMsg("error","系统错误，请稍候重试",false)}}})}}else{HdPortal.hdShowMsg("error","没有发现此游戏",true)}});o.find(".notCreate a").on("click.notCreate",function(){HdPortal.loading.show();$.ajax({type:"post",url:"/ajax/hdportal_h.jsp?cmd=clickFaster",error:function(){HdPortal.loading.hide();HdPortal.hdShowMsg("error","服务繁忙，请稍候重试",false)},success:function(s){var r=$.parseJSON(s);HdPortal.loading.hide();if(r.rt==0){o.remove();top.$(".bg-mask").hide();HdPortal.logDog(1000228,5)}else{HdPortal.hdShowMsg("error",r.msg||"系统错误，请稍候重试",false)}}})});return o};if(gameSelector.isShowFasterCreate){if(top.HdPortal.newRegisterStep==5){if(gameSelector.hasClickFaster){k({gameArr:gameSelector.fasterGameList,})}}}var l={resetLoadPage:function(){this.isLoad=false;this.page=0;this.num=30;this.loadArray=$("#ActiveBox2 .modActive:visible")},setLoadObj:function(o){if(!o){return}$.extend(true,this,o)}};l.resetLoadPage();var e=$(".active").outerWidth()+6;var n=parseInt($(".active").css("margin-bottom"))+$(".active").width();var i=$(window).width()-parent.$("#hdManageLeft").width()-parseInt($(".ActiveBox").css("margin-left"));var c=$(window).height()-parent.$("#hdManageTop").height()-parseInt($(".ActiveBox").css("margin-top"));var m=parseInt(i/e)<=0?1:parseInt(i/e);var h=parseInt(c/n)<=0?1:parseInt(c/n);var b=m*(h+1);l.setLoadObj({num:b});function a(){for(var p=0;p<l.num;p++){var q=l.page*l.num+p;var o=l.loadArray.eq(q).find(".actPic .showPic");var s=parseInt(o.attr("index"));if(isNaN(s)){s=q}if(!countInfo.hdModelList[s]){continue}var r=countInfo.hdModelList[s].photo;o.attr("src",r);o.show();if(q>l.loadArray.length){l.setLoadObj({isLoad:true});return}}l.setLoadObj({page:++l.page,isLoad:false,})}countInfo.getGameBss=function(p){if(HdPortal.isOem){return false}var o;angular.forEach(countInfo.hdModelList,function(s,r){var t=s.id;if(p==t){var q=s.designer;o={modId:t,designerId:q,modName:hdFai.encodeUrl(s.name),acct:hdFai.encodeUrl(s.acct),photo:hdFai.encodeUrl(s.photo),kind:s.kind,kind2:s.kind2,key1:s.key1,key2:s.key2,key3:s.key3,};if(countInfo.designerList){angular.forEach(countInfo.designerList,function(v,u){if(v.sid==q){o._designer=hdFai.encodeUrl(v.name);return false}})}return false}});return o};$(".ActiveBox").on("mouseenter",".active",function(){$(this).find(".actCreate").addClass("actCreateHover");var p=parseInt($(this).attr("index"));var q=countInfo.hdModelList[p];var r=(q&&q.preview)||$(this).attr("data-preview");if(r&&r.length>0){var o=$(this).find(".previewGif");if(o.length<=0){$(this).find(".actPic").append('<img class="previewGif" src="'+r+'?v=12" />')}else{o.show()}}}).on("mouseleave",".active",function(){$(this).find(".actCreate").removeClass("actCreateHover");$(this).find(".previewGif").hide()}).on("click",".active",function(){var q=$(this).attr($(this).hasClass("modActive")?"rstyle":"_style");var t=$(this);if($.inArray(q,limitGameFor19)!=-1){var o={content:"为营造和谐安全的网络环境，提升用户体验，该功能近期正快马加鞭升级中，请耐心等待，造成不便敬请原谅！",hasTitle:false,contentStyles:"text-align: center; padding-top: 55px;"};if(countInfo.limitConf.tpgn.level==1){if(countInfo.verInfo.authVer==HdVerDef.FREE&&!HdPortal.isOem){HdPortal.popup(o);return false}}else{if(countInfo.limitConf.tpgn.level==2){HdPortal.popup(o);return false}}}if(!HdPortal.isStaff&&q==77){if(!hdFai.checkBit(top.HdPortal.$data.profFlag,16384)){HdPortal.hdShowMsg("error","该活动涉及支付功能，请先到个人中心开通公众号支付功能",false);return}if(countInfo.verInfo.realVer<HdPortal.hdVer.ZS){HdPortal.hdShowMsg("error","该活动需要"+countInfo.verInfo.zsName+"才能创建",false);return}}if(HdPortal.isOem||($(this).hasClass("baseActive")&&countInfo.isShowOriginal)){showEditActivePage($(this))}else{if(top.$("#poup_previewActive").length>0){top.$("#poup_previewActive").remove()}var p=countInfo.hdModelList[parseInt($(this).attr("index"))];if(p.isguide&&!HdPortal.isOem){f({guideCss:countInfo.guideProduct,closeBtn:HdPortal.resRoot+"/version2/image/guidePie/guideFlyer/close.png",specialImg:HdPortal.resRoot+"/version2/image/guidePie/guideFlyer/pic3.png",guideHref:countInfo.flyerHost,});HdPortal.logDog(1000266,2);return false}HdPortal.logDog(1000173,1);var r="";if(p.rstyle==67){r='<p class="goToPayMentGame">该模板不支持在线支付功能，如需在线支付请创建<a href="#" class="gotPayGame">砍价（带支付版）</a></p>'}HdPortal.loading.show();top.HdPortal.asyncCss.load("popup_previewActive",countInfo.css_activePreView,function(){HdPortal.loading.hide();var C=HdPortal.poupUpBox('<div class="showQrcodeBtn hide"><div class="qrcodeIcon"></div><div class="qrcodeText">扫码</div></div><div class="closeBtn"></div><div class="floatBlock leftBox"><div class="leftImgCont"><img src="'+(p.dataShowPoupGif?p.dataShowPoupGif:p.fstImgId)+'"></div><div class="waitImgCont hide"><img style="position:absolute; width:20px; height:20px; margin-left:125px; margin-top:210px;" src="'+HdPortal.resRoot+'/image/loading.gif"></div><div class="gameframe" style="position:absolute;"></div><div class="maskBg_B maskBg hide"><div class="showQrCodeBox"><div class="qrCodeImg"><img class="qrcodeImage" src="'+p.qrCode+'" ></div><div class="qrCodeTxt">微信扫一扫体验活动</div></div></div></div><div class="floatBlock rightBox rightBox_B"><div class="actName_New">'+p.name+'</div><div class="actExpTitle_New">玩法介绍</div><div class="actExp_New"></div><div class="marketingTitle_New">营销功能</div><div class="marketing_New"><div class="marketing">病毒营销</div><div class="marketing">吸粉</div><div class="marketing">联系信息</div><div class="marketing">线下引流</div></div><div id="preview_createBtn" class="main-Button createBtn">创建</div>'+r+"</div>",4,"","width: 660px;height: 518px;",true,"previewActive");var B="";if(p.rstyle==69){B="用户可以上传照片报名，也能给所有作品投票，商家根据投票结果派奖。";C.find(".actExp_New").text(B)}else{$.ajax({url:"/ajax/hdportal_h.jsp?cmd=getExplain",type:"post",data:{modAid:p.aid,gameId:p.gameId},success:function(H){var G=$.parseJSON(H);if(G.success){B=G.explain;p.gameExplain=B;if(B.length>57){C.find(".actExp_New").addClass("onlyShow3Line");C.on("mouseenter",".actExp_New",function(){var I='<div class="hoverBox">'+B+"</div>";C.find(".actExpTitle_New").after(I)}).on("mouseleave",".hoverBox",function(){C.find(".hoverBox").remove()})}C.find(".actExp_New").text(B)}}})}if(p.rstyle==67){C.find(".gotPayGame").off("click").on("click",function(){var H=HdPortal.m_debug?437:481;var G;$.each(countInfo.hdModelList,function(I,J){if(J.id==H){G=I;return false}});if(typeof G!=="undefined"){$("#ActiveBox2 .modActive").eq(G).trigger("click")}})}var F=top.$(".bg-mask");var y=[15,27,37,41,52,61];var u=[15,27,37,41,52,61];var E=[31,48,49,63,64,67,69,71,77];var w=false;var v=p.sign;var A=countInfo.getGameBss(parseInt(p.id));C.find(".leftImgCont img").on("load",function(){for(var H=0;H<y.length;H++){if(p.rstyle==y[H]){return}}C.find(".leftImgCont").hide();C.find(".waitImgCont").show();var G=p.newlink+"&testPlayAid="+HdPortal.$data.aid+"&testPlaySign="+v;C.find(".gameframe").html('<iframe style="margin-right:1rem;" class="gameiframe" width="272" height="470" scrolling="auto" src="'+G+'"></iframe>');C.find(".gameframe iframe").on("load",function(){C.find(".gameframe").css("z-index","5000");setTimeout(function(){C.find(".waitImgCont").hide()},6000)})});var x=true;for(var z=0;z<E.length;z++){if(p.rstyle==E[z]){x=false}}if(x){var D='<div class="marketing">抽奖</div>';C.find(".marketing_New").append(D)}if(A.key2==50){var D='<div class="marketing">投票</div>';C.find(".marketing_New").append(D)}if(A.key2==48||A.key2==50){var D='<div class="marketing">排行榜</div>';C.find(".marketing_New").append(D)}if(p.rstyle=="77"){var D='<div class="marketing">在线支付</div>';C.find(".marketing_New").append(D)}for(var z=0;z<u.length;z++){if(p.rstyle==u[z]){w=true;C.on("mouseenter.pre",".leftImgCont",function(){C.find(".maskBg").fadeIn("400").css("z-index","9999")}).on("mouseleave.pre",".maskBg",function(){C.find(".maskBg").fadeOut("400")})}else{C.find(".maskBg").off("mouseleave.pre");C.find(".showQrcodeBtn").off("click.preview").on("click.preview",function(){if(C.find(".qrcodeText").text()=="扫码"){C.find(".maskBg").fadeIn("400").css("z-index","9999")}if(C.find(".qrcodeText").text()=="收起"){C.find(".maskBg").fadeOut("400")}var G=C.find(".qrcodeText").text()=="扫码"?"收起":"扫码";C.find(".qrcodeText").text(G)})}}C.find(".showQrcodeBtn").toggle(!w);C.on("poupBox_close",function(){F.off("previewActive")});F.off("previewActive").on("click.previewActive",function(){C.find(".closeBtn").click()});C.find("#preview_createBtn").on("click",function(){showEditActivePage(t);C.find(".closeBtn").click()})});var s=countInfo.getGameBss(parseInt(p.id));s&&HdPortal.logBss(Oss.Bss.HD_TEMPLATES_CLICK,$.toJSON(s))}});$(function(){if(gameSelector.isShowNewGuide&&!top.HdPortal.popWin){var t=$(".active").eq(0);if(!countInfo.isOem){t=$(".active").eq(1)}var v=[{target:$("#newCategoryBox2"),transLateX:800,translateY:20,step:1,tipsUrl:"step1.png",buttonUrl:"nextStep.png",exposeFn:function(){HdPortal.logDog(1000166,12)}},{target:top.$(".moreBarContentBox"),transLateX:-84,translateY:20,step:2,tipsUrl:"step2.png",isOuter:true,buttonUrl:"nextStep.png"},{target:t,transLateX:479,translateY:-55,step:3,tipsUrl:"step3.png",buttonUrl:"nextStep.png",afterClick:function(x){if(gameSelector.isShowFasterCreate&&gameSelector.hasClickFaster){var w=k({gameArr:gameSelector.fasterGameList,});top.$(".bg-mask").hide();x.poupArray[3].target=w.find(".faster_Boxer").eq(0)}}},{target:null,transLateX:250,translateY:-135,step:4,isOuter:true,delay:300,tipsUrl:"step4.png",buttonUrl:"nextStep.png",afterClick:function(w){top.$(".bg-mask").show()}}];if(gameSelector.isShowFasterCreate&&gameSelector.hasClickFaster&&top.HdPortal.newRegisterStep==4){var r=k({gameArr:gameSelector.fasterGameList,});top.$(".bg-mask").hide();v[3].target=r.find(".faster_Boxer").eq(0)}HdPortal.newRegistPoup({page:"newActive",poupArray:v,cssSrc:countInfo.registerPoup});if(top.HdPortal.newRegisterStep>4){top.$("#newRegistWin").remove()}}var u=$("#hdcontent");var q=$("#activeScrollBox");var p=$("#activityTwo");var o=$("#activityTwo_holder");var s=p.offset().top;o.height(p.height());u.scroll(function(){var w=u.scrollTop();p.width(q.width()-2);hdFai.watch("activityTwoScroll1",w>s,function(x){p.toggleClass("staticClass",!x).toggleClass("moving",x);o.toggleClass("hide",!x)});if(q.height()/8<=$(window).height()+w){if(!l.isLoad){l.setLoadObj({isLoad:true});a()}}});$(".hd_theAll_Game_now").click();hdFai.top=window;$("#hdcontent .searchBoxCont").show();$(window).on("resize",function(){p.width(q.width());$("#hdcontent .selectBox").css("margin-left",q.width()/2)});$("#hdcontent .selectBox").css("margin-left",q.width()/2);$(".themeSelectBox").on("mouseover",function(){$(".allThemeSelect").show()}).on("mouseout",function(){$(".allThemeSelect").hide()});$("#activityTwo .festivalcolumn").on("mouseover",function(){$(this).css("background-color","#f5f5f5").addClass("removeColorClass").siblings().css("background-color","#fff")});$("#gameAdviceBox .ctrbtn").on("click",function(H){var E='<div class="adviceBoxPoupContent"><div class="form-group"><label class="title" for="desc"><span class="flag">*</span>游戏玩法描述：</label><textarea class="content" id="desc"></textarea><div class="message red hide">游戏玩法描述不能为空且长度不能超过255个字符</div></div><div class="form-group"><label class="title" for="refrence">参考链接或平台：</label><input class="content" id="refrence" type="text" /><div class="message red hide">参考链接或平台不能超过200个字符!</div></div><div class="form-group picture-wrap"><label class="title">参考图片：</label><span class="pic upload"><img src="'+HdPortal.resRoot+'/version2/image/upload_image_icon.jpg" />上传图片</span><div class="picture-upload-progress uploadtime"><div class="uploadInner"><div class="uploadprogres"></div></div><div class="uploadpercent">0%</div></div><div class="message">最多可上传4张图片，格式为jpg/bmp/png/gif</div></div></div>';var C=HdPortal.popup({name:"adviceBoxPoup",title:"未找到游戏",content:E,width:660,confirmBtnName:"提交",confirmFun:function(){var L=[];for(var M in y){L.push(y[M])}var N={description:D.val().trim(),agentAid:countInfo.agentAid,openGoal:countInfo.goal,acct:countInfo.acct,link:x.val().trim()};if(L.length){N.imgLink=JSON.stringify(L)}$.ajax({url:HdPortal.versionURL+"/ajax/hdProductOpt_h.jsp?cmd=addGameSuggestion&aid="+HdPortal.$data.aid,data:N,success:function(O){O=$.parseJSON(O);if(O.rt){HdPortal.hdShowMsg("error","提交失败，请稍后重试!");return}HdPortal.hdShowMsg("right","提交成功!")}})}});var G=0;var y={};var B=false;var D=C.find("#desc");var K=C.find(".confirmBtn");var x=C.find("#refrence");var I=C.find(".picture-wrap");var A=I.find(".picture-upload-progress");var w={timer:null,lastTime:0,totalTime:0,over:false,start:function(P){P||(P=5000);var Q=this;var O="0%";var M=A.find(".uploadpercent");var L=A.find(".uploadprogres");function N(S){var R=Date.now();Q.totalTime+=R-Q.lastTime;Q.lastTime=R;if(Q.over){cancelAnimationFrame(Q.timer);return}O=Math.min(99,parseInt(Q.totalTime/P*100))+"%";M.text(O);L.css("width",O);Q.lastTime++;Q.timer=requestAnimationFrame(N)}M.text(O);L.css("width",O);this.over=false;this.lastTime=Date.now();cancelAnimationFrame(this.timer);N()},end:function(){this.over=true;this.totalTime=0;var L="100%";A.find(".uploadpercent").text(L);A.find(".uploadprogres").css("width",L)}};var z=function(){var L=I.find(".pic:not(.upload)").length;L>=4?I.find(".upload").hide():I.find(".upload").show();return L};var J=function(L){L=L.trim();if(L===""||L==null||L.length>255){return false}return true};var F=function(M){if(z()>=4){return}var L='<span class="pic"><img src="'+M+'" /><span class="delete" _index="'+G+'"></span></span>';I.find(".upload").before(L);y["file"+(++G)]=M;z()};D.on("blur input propertychange",function(M){var L=J(D.val());D.toggleClass("hasErr",!L).siblings(".message").toggleClass("hide",L);K.toggleClass("disabled",x.val().trim().length>200||!L&&!B)});x.on("blur input propertychange",function(M){var L=x.val().trim().length>200;x.toggleClass("hasErr",L).siblings(".message").toggleClass("hide",!L);K.toggleClass("disabled",!J(D.val())||L&&!B)});K.on("click",function(L){if(K.hasClass("disabled")){return false}if(B){hdFai.ing("正在上传图片...",true);return false}if(!J(D.val())){D.blur();return false}if(x.val().trim().length>200){x.blur();return false}});$.fn.uploadify.call(C.find(".form-group .upload"),{auto:true,fileTypeExts:"*.jpg;*.jpeg;*.png;*.bmp;*.gif",fileSizeLimit:3*1024*1024,isPortal:true,buttonText:"",saveInfoLocal:false,multi:false,getFileSizeUrl:HdPortal.versionURL+"/ajax/advanceUpload.jsp?cmd=_getUploadSize",uploader:HdPortal.versionURL+"/ajax/advanceUpload.jsp?cmd=_upload&gameId=-1",breakPoints:true,showUploadedSize:true,showUploadedPercent:true,removeTimeout:9999999,onUploadStart:function(){if(z()>=4){return}B=true;A.show();w.start()},onSelect:function(L){if(L.length&&B){hdFai.ing("正在上传图片...",true)}return !B},onUploadSuccess:function(L,N){var M=$.parseJSON(N);if(M.rt||!M.success){hdFai.ing(M.msg||"系统繁忙，请稍后重试",true);return}if(z()>=4){return}F(M.path)},onUploadComplete:function(){setTimeout(function(){B=false;A.fadeOut();w.end()},300)}});C.on("click",".form-group .pic .delete",function(L){delete y["file"+$(this).attr("_index")];$(this).parents(".pic").remove();z()})})});function j(){$(".moreFestival").css("left",$(".spanForMoreFestival").offset().left-($(".new_moreFestivalB").width()-$(".spanForMoreFestival").width())*0.5+7)}d.controller("gameShowBox",["$scope","$timeout",function(C,s){C.topListForTwo=countInfo.topListForTwo;C.otherListForTwo=countInfo.otherListForTwo;C.PlayTypeList=countInfo.PlayTypeList;C.tradeTypeList=countInfo.tradeTypeList;C.recomModelList=countInfo.recomModelList;C.hdModelList=countInfo.hdModelList;C.watcher_1=0;C.watcher_2="";C.watcher_3="";C.showMoreMenu=false;C.hasUseNum=0;C.allCloumn="littleBlue";C.isShowResult=false;C.resultNum=0;var u={};HdPortal.initCallBack(u,["leavePage"]);function w(F){var E=$(F.target);C.$safeApply(function(){C.showMoreMenu=false});u.fire("leavePage",F)}$(window).resize(function(){s(j,0)});parent.$("#hdContainer").on("click.fromNewActive",w);$(document).on("click",w);var q=370;var x=top.$(".searchBoxCont");var B;if(x.length>=1){x.remove()}var B=HdPortal.searchInputBox("搜索活动名称",parent.$("#hdManageTop"),false,"height:35px;width:198px;position: absolute;"+(HdPortal.isYKY?"right:14rem;":HdPortal.isOem?"right:32rem;":"right:"+q+"px;")+"top:20px;z-index:100;border-radius:18px;",function(E){C.$safeApply(function(){if(E.length>0){HdPortal.logDog(1000253,2)}else{return}if(C.watcher_1==999){C.watcher_3=E}else{C.watcher_2=E}})},{keyUp:function(E){var F=B.find(".input");E=E.trim();F.val(E)}});var y=countInfo.keyWordList;var p;if(y){var o="";o+='<div class="searchTipsBox hide"><div class="seracBoxInner"><p class="clearFix"><span class="floatLeft">热门搜索：</span><span class="floatRight shutDown">关闭</span></p><div class="hotKeyWordBox">';$.each(y,function(E,F){o+='<span index="'+E+'" class="keyWord">'+F.keyword+"</span>"});o+="</div></div></div>";o=$(o);B.append(o);u.on("leavePage",function(){B.find(".searchTipsBox").hide()});o.on("click.addKeyWord",".keyWord",function(F){F.stopPropagation();var E=y[parseInt($(this).attr("index"))];B.find(".input").val(E.keyword);B.find(".searchBtn").trigger("click")}).on("click.shutDown",".shutDown",function(){B.find(".searchTipsBox").hide()});B.find(".searchTipsBox").on("click",function(E){E.stopPropagation()})}B.find(".input").on("focus.inputNow",function(E){E.stopPropagation();HdPortal.logDog(1000253,1);if(y){B.find(".searchTipsBox").show()}}).on("click.specialKey",function(E){E.stopPropagation()});var r=true;function v(E){if(!E||!r){return}r=false;var F={};$.extend(true,F,E);delete F.id;$.ajax({type:"post",url:"/ajax/hdProductOpt_h.jsp?cmd=addKeyWordRecord",data:F,error:function(){r=true;HdPortal.hdShowMsg("error","服务繁忙，请稍候重试",false)},success:function(G){r=true}})}function z(F,G){var E=false;angular.forEach(G,function(I,H){if(I.id==F){E=true;return false}});return E}C.$$on("$routeChangeSuccess",function(F,E){if(E.$$route.templateUrl!="proTypeGame.jsp"){return}C.$watch("watcher_1 == 999",function(H,G){B.find(".input").val(H?C.watcher_3:C.watcher_2)});C.$watch("watcher_3",function(H,G){if(H==G){return}$(".not_prototype_HdBoxer .baseActive").each(function(J){var K=$(this);var I=K.find(".actName").text();var L=K.data("filename");K.toggle(L.indexOf(H)!=-1||I.indexOf(H)!=-1)})})});C.changeSelector=function(H,I,G){C.watcher_2="";B.find(".input").val("");var E=[];switch(I){case 1:E=countInfo.tradeTypeList;break;case 2:E=countInfo.PlayTypeList;break;case 3:E=countInfo.topListForTwo;break;case 4:E=countInfo.otherListForTwo;break}var J=E[H];var K=J.id;if(!gameSelector.isATest){var F=-1;switch(K){case 47:F=3;break;case 48:F=4;break;case 53:F=6;break;case 54:F=7;break;case 55:F=16;break;case 60:F=8;break;case 56:F=9;break;case 57:F=10;break;case 58:F=11;break;case 59:F=12;break;case 49:F=13;break;case 50:F=14;break;case 51:F=15;break;case 0:F=1;break;case 52:F=5;break;default:F=-1;break}F>0&&HdPortal.logDog(1000217,F)}if(K!=999&&K!=888){HdPortal.logDog(1000168,K)}if(K==888){HdPortal.logDog(1000168,62);C.showMoreMenu=!C.showMoreMenu;j();G.stopPropagation();return}if(K==HdTradeDef.NewGroup.ALL_TYPE){C.watcher_1=countInfo.topListForTwo[0].id}else{if(K==HdTradeDef.NewGroup.GAME_SALE){C.watcher_1=countInfo.PlayTypeList[0].id}else{C.watcher_1=K}}};function A(E){if(!E){return}$.each(E,function(F,G){G.clickClass=""})}function t(F){if(!F){return}var E=[];$.each(F,function(G,H){E.push(H.id)});F.tradeId=E}t(countInfo.tradeTypeList);t(countInfo.topListForTwo);t(countInfo.otherListForTwo);t(countInfo.PlayTypeList);C.$watch("watcher_1",function(L,H){if(L==H||L==999){return}C.isShowResult=false;A(countInfo.tradeTypeList);if($.inArray(L,countInfo.tradeTypeList.tradeId)!=-1){var G=$.inArray(L,countInfo.tradeTypeList.tradeId);var J=countInfo.tradeTypeList[G];J.clickClass="littleBlue"}var E=countInfo.tradeTypeList[1];E.hasSelect=false;var I=countInfo.topListForTwo[countInfo.topListForTwo.length-1];if($.inArray(L,countInfo.topListForTwo.tradeId)!=-1){A(countInfo.topListForTwo);var G=$.inArray(L,countInfo.topListForTwo.tradeId);var J=countInfo.topListForTwo[G];E.clickClass="littleBlue gameSaleBtnColor";E.rotateMoving="rotateImg";J.clickClass="littleBlue";C.controlHeight_1="";C.controlHeight_2="specialHeight";E.hasSelect=true;I.name="更多节日"}else{C.controlHeight_1=C.controlHeight_2=E.clickClass=E.rotateMoving=""}if($.inArray(L,countInfo.otherListForTwo.tradeId)!=-1){A(countInfo.otherListForTwo);A(countInfo.topListForTwo);var G=$.inArray(L,countInfo.otherListForTwo.tradeId);var J=countInfo.otherListForTwo[G];E.clickClass="littleBlue gameSaleBtnColor";E.rotateMoving="rotateImg";countInfo.topListForTwo[countInfo.topListForTwo.length-1].clickClass="littleBlue";J.clickClass="littleBlue";C.controlHeight_1="";C.controlHeight_2="specialHeight";E.hasSelect=true;I.name=J.name}else{if(!E.hasSelect){E.clickClass=E.rotateMoving=C.controlHeight_2=""}C.controlHeight_1=""}var F=countInfo.tradeTypeList[3];F.isSelect=false;if($.inArray(L,countInfo.PlayTypeList.tradeId)!=-1){A(countInfo.PlayTypeList);var G=$.inArray(L,countInfo.PlayTypeList.tradeId);var J=countInfo.PlayTypeList[G];F.clickClass="littleBlue gameSaleBtnColor";F.rotateMoving="rotateImg";J.clickClass="littleBlue";C.controlHeight_1="specialHeight";C.controlHeight_2="";F.isSelect=true}else{C.controlHeight_1=F.clickClass=F.rotateMoving=""}var K=0;angular.forEach(countInfo.hdModelList,function(N,M){var O=false;if(L==HdTradeDef.NewGroup.NONE){O=true}else{if(E.hasSelect){if(!angular.isUndefined(N.key1)&&((L==HdTradeDef.NewGroup.ALL_FESTIVAL&&N.key1>=HdTradeDef.NewGroup.NFESTIVAL_YUANDAN&&N.key1<HdTradeDef.NewGroup.NOT_FESTIVAL)||N.key1==L)){O=true}}else{if(F.isSelect){if(!angular.isUndefined(N.key3)&&(L==HdTradeDef.NewGroup.ALL_PLAY&&N.key3>HdTradeDef.NewGroup.ALL_PLAY&&N.key3<=HdTradeDef.NewGroup.HANDLE_TYPE)||N.key3==L){O=true}}else{if(!angular.isUndefined(N.key2)&&L==N.key2){O=true}}}}if(M==0){N.isShow=true;O=false}else{N.isShow=!O}if(O){K++;$(".new_activeContent .modActive").eq(M).find(".showPic").attr("src",N.photo).removeClass("hide")}});if(K!=0){l.resetLoadPage();a()}});function D(G){var F=0;B.find(".input").val(G);var E={keyword:G};angular.forEach(countInfo.hdModelList,function(I,H){var J=false;if(I.keyword||I.sysKeyword){if(I.keyword){J=I.keyword.indexOf(G)>-1}if(I.sysKeyword&&!J){J=I.sysKeyword.indexOf(G)>-1}}if(!J){J=(I.name.indexOf(G)>-1)}if(H==0){if(G==""||HdPortal.isOem){I.isShow=true}else{if($.inArray(G,g)>-1){J=true}else{J=false}I.isShow=!J}}else{I.isShow=!J}if(J){F++;if(I.isguide){I.name=G;HdPortal.logDog(1000266,1)}else{$(".new_activeContent .modActive").eq(H).find(".actName span").html(I.name.replace(G,'<font color="#329fea">'+G+"</font>"))}if(I.isguide&&countInfo.isOem){F--}$(".new_activeContent .modActive").eq(H).find(".showPic").attr("src",I.photo).removeClass("hide")}});C.resultNum=F;if(F!=0){l.resetLoadPage();a()}if(G!=""){s(function(){C.isShowResult=true},0)}if(F>0){HdPortal.logDog(1000253,4)}else{HdPortal.logDog(1000253,3)}E.isMatch=F>0;v(E)}C.$watch("watcher_2",function(F,E){if(F==E){return}if(C.watcher_1!=0){C.watcher_1=0;s(function(){D(F)},0)}else{D(F)}});C.goBackSelect=function(){C.isShowResult=false;C.watcher_2=""}}]);d.directive("repeatFinish",function(){return{link:function(r,q,o){if(r.$last==true){l.setLoadObj({loadArray:$("#ActiveBox2 .modActive:visible")});for(var p=0;p<2;p++){a()}}}}})})(selectShow);(function(g,e){var d=e.isOem;var c=e.swiperOpenABTest;var f=e.isA;var a=e.bannerData||{};var b=a.dataList;g.controller("hdBanner",["$scope",function(h){h.swiperNumber=0;h.swiperSlides=[];h.activeIndex=0;h.swiperWrapStyle={width:"0%",transform:"translateX(0%)"};if(!$.isEmptyObject(a)){if(!d&&!c||(c&&f)){h.swiperNumber=a.ANumber;h.swiperSlides=b.A}if(!d&&c&&!f){h.swiperNumber=a.BNumber;h.swiperSlides=b.B}}h.setTransform=function(){h.swiperWrapStyle.transform="translateX("+(-h.activeIndex*(100/h.swiperNumber))+"%)"};h.changeActiveIndex=function(i){i=Math.min(h.swiperNumber-1,i);i=Math.max(0,i);h.$safeApply(function(){h.activeIndex=i;h.setTransform()})};h.handleBtnClick=function(l,k,j,i){if(l){HdPortal.logDog(1000255,l)}setTimeout(function(){if(!k){i&&top.changePage&&top.changePage(i)}else{if(j){if(!/^http(s)?:\/\//.test(j)){j="http://"+j}window.open(j)}}},0)};h.$safeApply(function(){h.swiperWrapStyle.width=h.swiperNumber+"00%";h.setTransform()});h.swiperSlides.forEach(function(i){var j=i.showSrcid;if(j){HdPortal.logDog(1000255,j)}});setInterval(function(){var i=h.activeIndex+1;if(i>=h.swiperNumber){i=0}h.changeActiveIndex(i)},5000)}])})(selectShow,bannerSwiperInfo);function loadEditAct(){HdPortal.safeReady($("#editActFramePage"),function(){if($("#editActFramePage").length==0){return}HdPortal.loading.hide();$("#editActive").show();$("#hdcontent").hide()},1500)}function showEditActivePage(d){if(gameSelector.isShowGuide&&top.step==3){HdPortal.sendGuide(top.step)}isClickActive=true;var c=d;var g=parseInt(c.attr("index"));var k=countInfo.hdModelList[g];var e;if(k){e=parseInt(k.id)}var a="editActive.jsp?from=newActive";if(e){a+="&modId="+e}else{var b=c.attr("_style");var f=c.attr("_tpl");var j=b+(typeof f==="undefined"?"":"_"+f);a+="&style="+b+(typeof f==="undefined"?"":"&tplId="+f)}a+="&newCreateGame=c";if(countInfo.isVersion3){var i=function(){if(countInfo.gameCount>=countInfo.verInfo.gameAmountLimit){HdPortal.hdShowMsg("error",countInfo.verInfo.verName+"最多同时创建"+countInfo.verInfo.gameAmountLimit+"个游戏",false)}else{HdPortal.openNew3EditActive(a)}};if(countInfo.gameCount===undefined){$.ajax({type:"post",url:"/ajax/hdportal_h.jsp?cmd=getGameCount",error:function(){countInfo.gameCount=0;i()},success:function(l){countInfo.gameCount=parseInt(l);i()}});return}else{i()}return}$("#editActive").html('<iframe id="editActFramePage" class="editActFramePage" name="framePage" frameborder="0" scrolling="auto" src="'+a+'" style="width:100%;height:100%;display:block;"></iframe>');HdPortal.loading.show();HdPortal.safeReady($("#editActFramePage"),function(){if($("#editActFramePage").length==0){return}HdPortal.loading.hide();$("#editActive").show();$("#hdcontent").hide()},1500);top.$(".searchBoxCont").hide();var h=parseInt($("#categoryBox .checked").attr("_themeId"));if(h==HdTradeDef.Id.NORMAL){parent.$(".hd-searchInputBox").hide()}}function editActiveErr(a){HdPortal.hdShowMsg("error",a||"新建游戏错误，请刷新再试",false);if(countInfo.isVersion3){return}HdPortal.loading.hide();HdPortal.clearIframe($("#editActFramePage"));$("#editActFramePage").remove();$("#editActive").hide()}function hideEditAct(){if(change>0){if(!confirm("离开页面内容将会消失")){return}}isClickActive=false;top.$(top).data("beforeunload",false);top.$(".searchBoxCont").show();$("#hdcontent").show();$("#editActive").hide();HdPortal.clearIframe($("#editActFramePage"))}function logDog(a){HdPortal.logDog(1000157,a)};