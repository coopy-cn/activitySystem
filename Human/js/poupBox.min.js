if(typeof HdPortal=="undefined"){var HdPortal={}}(function(a){function b(d){var c={left:0,top:0,};function e(h){if(top!==h){var g=h.parent;var f=$(h.frameElement).offset();c.left+=f.left;c.top+=f.top;f=null;e(g)}}e(d);return c}a.newRegistPoup=function(c){if(top!=window){c.offSet=b(window);return top.HdPortal.newRegistPoup.apply(this,arguments)}return a.Res.loadUrl("popup_newRegistPoup",c.cssSrc).then(function(){var f={page:"newActive",poupArray:[],pageMaxStep:{newActive:4,editActive:8,myActive:12,}};c=$.extend(true,f,c);var e=$("#newRegistWin");if(e.length<=0){var i='<div id="newRegistWin" class="hd-theSiganUp-Bclass-UserGuide hide"><div class="hd-NewSiganUp-boxer"><div class="hd-NewSiganUp-boxer-first hd_hg_grey theLittleBaby"><div id="special1" class="hd-NewSiganUp-boxer-special1 hide hd_hg_grey theLittleBaby"></div><div id="special2" class="hd-NewSiganUp-boxer-special2 hide hd_hg_grey theLittleBaby"></div><div id="special3" class="hd-NewSiganUp-boxer-special3 hide hd_hg_grey theLittleBaby"></div></div><div class="hd-NewSiganUp-boxer-second theLittleBaby clearFix"><div class="hd-NewSiganUp-shower-maskOne hd_hg_grey floatLeft"></div><div class="hd-NewSiganUp-shower-detail floatLeft"></div><div class="hd-NewSiganUp-shower-maskTwo hd_hg_grey floatLeft"></div></div><div class="hd-NewSiganUp-boxer-third hd_hg_grey theLittleBaby"></div></div><div class="hd-NewSiganUp-EventBox"><div class="theShowerImgerBoxer"><img class="theShowerImger"><div class="eventBox"><img class="theNormalImg"></div></div></div></div>';e=$(i);top.$("body").append(e)}c.box=e;var n=c.pageMaxStep[c.page]||c.pageMaxStep.newActive;function m(){if(++g==h*2){setTimeout(function(){k(a.newRegisterStep)},600)}}function k(o){var q;$.each(c.poupArray,function(r,s){if(s.step==a.newRegisterStep&&a.newRegisterStep!=0){q=s;return false}});if(q){if(!q.target||q.target.length<=0){!q.notSendGuide&&a.sendGuide(++a.newRegisterStep,true);e.toggle(false);return}e.toggle(true);var p=q.delay||0;setTimeout(l,p);e.off("click.nexStep").on("click.nexStep",function(){q.afterClick&&q.afterClick(c);!q.notSendGuide&&a.sendGuide(++a.newRegisterStep);if(n<a.newRegisterStep){e.toggle(false)}else{if(q.clickCaller){q.clickCaller(c)}else{k(a.newRegisterStep)}}})}else{e.toggle(false)}}function l(v){var w;$.each(c.poupArray,function(G,H){if(H.step==a.newRegisterStep&&a.newRegisterStep!=0){w=H;return false}});if(!w||!w.target||w.target.length<=0){if(w&&!w.notSendGuide){a.sendGuide(++a.newRegisterStep,true)}e.toggle(false);return}e.toggle(true);if(!w.hasExpose){w.hasExpose=true;w.exposeFn&&w.exposeFn()}var q=e.height();var B=e.width();var E=w.target.offset();if(!w.isOuter&&c.offSet){E.left+=c.offSet.left;E.top+=c.offSet.top}var D=w.target.outerWidth();var z=w.target.outerHeight();var s=a.Num.sub(B,a.Num.add(E.left,D));e.find(".hd-NewSiganUp-boxer-first").height(E.top);e.find(".hd-NewSiganUp-boxer-third").height(q-E.top-z);var C=e.find(".hd-NewSiganUp-boxer-second");C.height(z);C.find(".hd-NewSiganUp-shower-maskOne").width(E.left);C.find(".hd-NewSiganUp-shower-detail").width(D);C.find(".hd-NewSiganUp-shower-maskTwo").width(s);var A=e.find(".hd-NewSiganUp-EventBox");var y=w.translateY+E.top+z;var o=w.transLateX+E.left-A.width()/2;if(w.startFromTop){y=w.translateY+E.top}A.css({left:o,top:y,}).find(".theShowerImger").attr("src",w.tipsUrl);A.find(".theNormalImg").attr("src",w.buttonUrl);if(true){A.find(".theNormalImg").css({left:0,top:0});var p=A.find(".theNormalImg").offset();var t={};$.extend(true,t,p);var x=$(top).width();var r=$(top).height();var u=A.find(".theNormalImg").width();var F=A.find(".theNormalImg").height();if(p.top<0){p.top=0}if(p.left<0){p.left=0}if(p.left+u>x){p.left=x-u}if(p.top+F>r){p.top=r-F}p.left-=t.left;p.top-=t.top;A.find(".theNormalImg").css(p)}}var h=c.poupArray.length;var g=0;if(h>0&&n>=a.newRegisterStep){$.each(c.poupArray,function(o,p){p.buttonUrl=a.resRoot+"/image/newGuide2/"+p.buttonUrl;if(p.step==3||p.step==4){p.tipsUrl=a.resRoot+"/version2/image/fasterStart/"+p.tipsUrl}else{p.tipsUrl=a.resRoot+"/image/newGuide2/"+p.tipsUrl}a.imgReady(p.tipsUrl,function(){m()});a.imgReady(p.buttonUrl,function(){m()})})}var d;function j(){d&&clearTimeout(d);d=setTimeout(function(){l(true)},50)}$(window).off("resize.autoConfirm").on("resize.autoConfirm",j)})};a.sendGuide=function(c,d,e){$.ajax({type:"get",url:"/ajax/hdportal_h.jsp?cmd=setGuideStep&step="+hdFai.encodeUrl(c),success:function(h){var f=$.parseJSON(h);e&&e(f);var g=c;if(c==3){g=4}else{if(c==4){g=3}}!d&&a.logDog(1000166,g)}})};a.showRechargeBox=function(f,e){top.$(".bg-mask").off("click");var d=a.popup({name:"rechargeBox",title:f,content:'<div class="redPacketTopUpBox"><div class="topUpSuc"><div class="sucTip"><p>请您在新打开的页面完成支付</p><p>如充值有疑难请咨询客服</p></div></div></div>',confirmBtnName:"购买成功",cancelBtnName:"关闭窗口",confirmFun:function(){c();e&&e()},cancelFun:function(){if($(this).hasClass("goTopUpButon")){return"stop"}c();e&&e()}});var c=function(){var h=top.$(".poupBox:visible");if(h.length>1){var g=top.$(".bg-mask");g.bind("click",function(){$(h[0]).css("z-index",1000);g.hide();$(h[0]).hide()})}}};a.showCmtExportTask=function(d,c){return a.popup({name:"cmtExportTask",content:"您需要导出的报表数据量过大，可从下方预约下载该报表",title:"预约下载",width:463,confirmBtnName:"预约下载",confirmFun:d,cancelFun:c,isOneBottomBtn:true})};a.showExportCenterEntrance=function(){top.$(".moreBarContent").show();top.$(".moreBarContentBox").addClass("hoverChecked");top.$(".moreBarContent .headerTips ").show();top.$(".manageInfo112 .topBarServeMenuBox").show();top.$(".manageInfo112").addClass("hoverChecked");top.$(".manageInfo112 .headerTips ").show()};a.poupTopUpBox=(function(){var i,j,c,f,h;var g=false;var k=0;var d=3000;return function(m,l){if(top!==window){return top.HdPortal.poupTopUpBox.apply(this,arguments)}i=$(".redPacketTopUpBox");j=$(".bg-mask");f=m;if(j.length==0){j=$('<div class="bg-mask hide"></div>');$("body").append(j)}if(i.length==0){i=e(l)}i.find(".inputMoney").val(0).removeClass("inputErr");i.find(".errTips").hide();i.find(".payMoney,.poundage").text("0.00");h=l;$.ajax({type:"post",url:"/ajax/hdcash_h.jsp?cmd=getRechargeLimit",error:function(){a.hdShowMsg("error","服务繁忙，请稍候重试",false)},success:function(n){var o=$.parseJSON(n);if(o.success){if(!l){c=o.rechargeLimit}else{c=100000}g=o.isValidatePhone;if(!g){k=o.hasRecharge}i.find(".topUpTxt,.buttonSta1").show();i.find(".topUpSuc,.buttonSta2").hide();j.add(i).show();setTimeout(function(){j.addClass("bg-mask-animate");i.addClass("poup-box-animate")},0);i.find(".remainMoney").text(c)}}})};function e(n){var p=n?"http://"+a.OemPortalHost+"/portal.jsp#appId=shopCart":"http://"+a.HdPortalHost+"/portal.jsp#appId=shopCart";var o="";if(n){var l=a.feePercent;console.log(l);if(!l){l=0.02}l=l*100;o="<p>1.红包充值将收取"+l.toFixed(0)+"%的手续费用于支付转账及打款时产生的手续费用；</p><p>2.由于微信红包为代发服务，因此充值红包无法开具发票，请谅解；</p>"}else{o='<p>1.每人每月累计可充值上限为<span class="topUpMoney">100,000</span>元，本月额度剩余<span class="special remainMoney">5000</span>元；</p><p>2.红包充值将收取2%的手续费用于支付转账及打款时产生的手续费用；</p><p>3.<span style="padding: 0;">充值金额不开具发票，手续费可开发票，了解更多发票、提现及手续费问题请</span> <a target="_blank" href="http://hd.'+a.HomeHost+'/news/6621">点击这里</a></p>'}var q=$("body").hasClass("version3")?"main-Button-blue":"main-Button-white";var m=$('<div class="redPacketTopUpBox poupBox hide"><div class="poupTitle">微信红包充值<div class="closeBtn"></div></div><div class="topUpInfo poupContent"><div class="topUpTxt"><div class="setLine"><p class="flag">*</p>红包金额：<input type="text" class="inputMoney" maxlength="6" onkeypress="javascript:return hdFai.isNumberKey(event);" value="0"> 元</div><div class="tipTxt payTips">实际需支付<span class="special payMoney">0.00</span>元（手续费<span class="poundage">0.00</span>元）</div><div class="tipTxt errTips hide">输入不能为空，且充值金额最低为1元</div><div class="specilTips"><p>温馨提示：</p>'+o+'</div></div><div class="topUpSuc hide"><div class="sucTip"><p>请您在新打开的页面完成支付</p><p>如充值有疑难请咨询客服</p></div></div></div><div class="poupBottom"><div class="poupBtn main-Button buttonSta1 goTopUpButon">前往充值</div><div class="poupBtn '+q+' buttonSta1 cancleBtn">取消</div><div class="poupBtn main-Button buttonSta2 saveButon" style="display:none">充值成功</div><div class="poupBtn '+q+' buttonSta2 cancleBtn hide" style="display:none">关闭窗口</div></div></div>');$("body").append(m);m.find(".goTopUpButon").click(function(){var v=m.find(".inputMoney");var u=parseFloat(v.val());if(v.val().trim().length==0||u<1){v.addClass("inputErr");m.find(".payTips").hide();m.find(".errTips").show().html("输入不能为空，且充值金额最低为1元");return}else{if(u>c){v.addClass("inputErr");m.find(".payTips").hide();var t=h?"单次充值不能超过100000元，请调整金额分次充值":"充值金额已超过本月剩余额度，请调整金额或下个月再充值";m.find(".errTips").show().html(t);return}}if((!h&&!g&&k+u>=d)){a.verifyPhonePopup(s);return}var r=window.open();s(r);function s(x){var w=m.find(".payMoney").text();$.ajax({type:"post",url:"/ajax/hdcash_h.jsp?cmd=checkChargeLimit&amount="+v.val(),error:function(){a.hdShowMsg("error","服务繁忙，请稍候重试",false);x.close()},success:function(z){var A=$.parseJSON(z);if(A.success){m.find(".topUpTxt,.buttonSta1").hide();m.find(".topUpSuc,.buttonSta2").show();m.find(".buttonSta2,.closeBtn").addClass("sucCloseBtn");var y=p+"&iParams="+hdFai.encodeUrl("hdLuckymoney=true&urlProductPrice="+v.val())+"&iParams="+Math.random();console.log("jumpUrl："+y);x.location=y}else{x.close()}}})}});m.on("click",".closeBtn,.bottomButon,.poupBtn",function(){if($(this).hasClass("goTopUpButon")){return}if($(this).hasClass("sucCloseBtn")){a.getBalance(f)}m.find(".closeBtn").removeClass("sucCloseBtn");j.removeClass("bg-mask-animate");m.removeClass("poup-box-animate");setTimeout(function(){j.hide();m.hide()},300)});m.find(".inputMoney").on("blur input propertychange",function(){$(this).val($(this).val().replace(/[^0-9\.]/g,""));var t=parseFloat($(this).val());if($(this).val().trim().length==0||t<1){$(this).addClass("inputErr");m.find(".payTips").hide();m.find(".errTips").show().html("输入不能为空，且充值金额最低为1元");return}else{if(t>c){$(this).addClass("inputErr");m.find(".payTips").hide();var s=h?"单次充值不能超过100000元，请调整金额分次充值":"充值金额已超过本月剩余额度，请调整金额或下个月再充值";m.find(".errTips").show().html(s);return}}console.log(a.isStaff);if(a.isStaff){m.find(".payTips .payMoney").text((t).toFixed(2));m.find(".payTips .poundage").text((t*0).toFixed(2))}else{if(h){var r=a.feePercent;if(!r){r=0.02}m.find(".payTips .payMoney").text((t+t*r).toFixed(2));m.find(".payTips .poundage").text((t*r).toFixed(2))}else{m.find(".payTips .payMoney").text((t+t*0.02).toFixed(2));m.find(".payTips .poundage").text((t*0.02).toFixed(2))}}$(this).removeClass("inputErr");m.find(".payTips").show();m.find(".errTips").hide()});return m}})();a.verifyPhonePopup=function(e){var c='<div class="verifyHint">累计充值金额超过3,000，需要验证手机后才能继续充值</div><div class="formLine nameLine"><span class="requiredTag">姓名：</span><input class="nameInput" type="text" placeholder="请输入姓名"><div class="errTips hide">请输入姓名</div></div><div class="formLine phoneLine"><span class="requiredTag">手机号码：</span><input class="phoneInput" type="text" placeholder="请输入手机号码" onkeypress="javascript:return hdFai.isNumberKey(event);"><div class="errTips hide">请输入正确的手机号码</div></div><div class="formLine codeLine"><span class="requiredTag">验证码：</span><input class="codeInput" type="text" placeholder="请输入验证码"><div class="main-Button sendCodeBtn disabled">点击获取验证码</div><div class="errTips hide">请输入验证码</div></div>';var f=a.popup({name:"verifyPhone",title:"手机验证",width:550,content:c,confirmBtnName:"继续",confirmFun:function(){var i=f.find(".nameLine .nameInput").val();i=$.trim(i);if(!i){f.find(".nameLine .nameInput").addClass("inputErr");f.find(".nameLine .errTips").text("请输入姓名").show();return"stop"}var h=i.replace(/[^\x00-\xff]/g,"**").trim().length;if(h>20){f.find(".nameLine .nameInput").addClass("inputErr");f.find(".nameLine .errTips").text("姓名不能超过10个汉字").show();return"stop"}var g=f.find(".phoneLine .phoneInput").val();if(!/^1[3456789]\d{9}$/.test(g)){f.find(".phoneLine .phoneInput").addClass("inputErr");f.find(".phoneLine .errTips").show();return"stop"}var l=f.find(".codeLine .codeInput").val();if(!l){f.find(".codeLine .codeInput").addClass("inputErr");f.find(".codeLine .errTips").text("请输入验证码").show();return"stop"}var k={};k.name=i;k.phone=g;k.vcode=l;var j=window.open();$.ajax({type:"post",url:"/ajax/hdportal_h.jsp?cmd=validatePhoneForRecharge",data:k,error:function(){a.hdShowMsg("error","服务繁忙，请稍候重试",false);j.close()},success:function(m){var n=$.parseJSON(m);if(n.success){e&&e(j);f.find(".closeBtn").click()}else{f.find(".codeLine .errTips").text("验证码错误").show();j.close()}}});return"stop"}});var d=true;f.find(".nameInput").on("blur keyup propertychange",function(){var h=$(this).val();h=$.trim(h);if(!h){$(this).addClass("inputErr");f.find(".nameLine .errTips").text("请输入姓名").show();return}var g=h.replace(/[^\x00-\xff]/g,"**").trim().length;if(g>20){$(this).addClass("inputErr");f.find(".nameLine .errTips").text("姓名不能超过10个汉字").show();return}$(this).removeClass("inputErr");f.find(".nameLine .errTips").hide()});f.find(".phoneInput").on("blur keyup propertychange",function(i){var g=$(this).val().replace(/[^0-9\.]/g,"");if(g.length>=11&&d){d=false}if(/^1[3456789]\d{9}$/.test(g)){$(this).removeClass("inputErr");f.find(".phoneLine .errTips").hide();var h=f.find(".codeLine .sendCodeBtn");if(!h.hasClass("timing")){h.removeClass("disabled")}}else{if(!d){$(this).addClass("inputErr");f.find(".phoneLine .errTips").show()}f.find(".codeLine .sendCodeBtn").addClass("disabled")}});f.find(".codeInput").on("blur keyup propertychange",function(){var g=$(this).val();if(g){$(this).removeClass("inputErr");f.find(".codeLine .errTips").hide()}else{$(this).addClass("inputErr");f.find(".codeLine .errTips").text("请输入验证码").show()}});f.find(".sendCodeBtn").click(function(){console.log("new");if($(this).hasClass("disabled")){return}var g='<div class="formLine showCodeLine"><img src="validateCode.jsp?'+Math.random()+'" class="codeImg"><span class="resetCode">换一张</span></div><div class="formLine codeLine"><input class="codeInput" type="text" placeholder="请输入验证码"><div class="errTips hide">请输入验证码</div></div>';var h=a.popup({name:"imgVerifyCodePopup",title:"请完成验证",width:400,content:g,confirmFun:function(){var i=f.find(".phoneLine .phoneInput").val();var j=h.find(".codeLine .codeInput").val();if(!j){h.find(".codeLine .codeInput").addClass("inputErr");h.find(".codeLine .errTips").text("请输入验证码").show();return"stop"}$.ajax({type:"post",url:"/ajax/hdportal_h.jsp?cmd=sendValidateCodeSms&vcode="+j+"&phone="+i,error:function(){a.hdShowMsg("error","服务繁忙，请稍候重试",false)},success:function(n){var k=$.parseJSON(n);if(k.success){h.find(".poupTitle .closeBtn").click();var m=60;var l=f.find(".codeLine .sendCodeBtn");l.addClass("disabled").addClass("timing").text(m+"s 后可重新获取");var o=setInterval(function(){m--;if(m<=0){l.removeClass("disabled").removeClass("timing").text("点击获取验证码");clearInterval(o);return}l.text(m+"s 后可重新获取")},1000)}else{h.find(".showCodeLine .resetCode").click();h.find(".codeLine .codeInput").addClass("inputErr").val("").focus();h.find(".codeLine .errTips").text(k.msg||"验证码错误").show()}}});return"stop"}});h.find(".resetCode,.codeImg").on("click",function(){h.find(".codeImg").attr("src","validateCode.jsp?"+Math.random())});h.find(".codeInput").on("blur keyup propertychange",function(){var i=$(this).val();if(i){$(this).removeClass("inputErr");h.find(".codeLine .errTips").hide()}else{$(this).addClass("inputErr");h.find(".codeLine .errTips").text("请输入验证码").show()}});h.find(".codeInput").keyup(function(i){if(i.keyCode=="13"){h.find(".confirmBtn").click()}})})};a.initPoupWindow=function(j,p,k,s,n){if(typeof j!=="number"||j==0){return}var q,t,x;x=true;s&&(s=s.replace("hdm","www"));switch(j){case 1:t="getRedPackage";q=['<div class="theRedTypeBoxer" >','<div class="theRedType">','<div class="boxerKeeper">','<div class="MoneyShower"></div>','<div class="goingTips"></div>',"</div>","</div>",'<div class="theRedType theRedType2">','<div class="boxerKeeper">','<div class="MoneyShower"></div>','<div class="goingTips"></div>',"</div>","</div>",'<div class="theRedType theRedType3">','<div class="boxerKeeper">','<div class="MoneyShower"></div>','<div class="goingTips"></div>',"</div>","</div>",'<div class="theRedType theRedType4">','<div class="boxerKeeper">','<div class="MoneyShower"></div>','<div class="goingTips"></div>',"</div>","</div>","</div>",'<div class="clickBtn useClickBtn" ></div>','<div class="tipsWord theTipsWord" >点击按钮抽取红包，快来试试你的运气！</div>','<div class="tipsWordRight theTipsWord" >限抢一次</div>',];break;case 2:t="getRedPackage2";q=['<div class="theOutSideBoxer">','<div class ="theShowerForOcoup theTipsWord">','<div class="oneBaby" >升级互动版本时抵扣相应金额</div>','<div class="twoBaby" >截止日期：','<span class="theDeadLine"></span>',"</div>",'<div class="clickBtn useClickBtn" ><a  target="_blank" href="'+s+'/jump.jsp?t=42"></a></div>',"</div>","</div>"];break;case 3:t="packAgeEnd";q=['<div class="willEndSoon fontSet" >促销活动','<span class="canHideNow">还有</span>','<span class="specialTips fontSet" >3</span>','<span class="canHideNow">天</span>',"截止</div>",'<div class="moreInfluence fontSet" >铂金版，让游戏更有影响力！</div>','<div class="bojin fontSet" ></div>','<div class="theWord fontSet" >'+a.$data.discountsText+"</div>",'<div class="theInfoMation clearFix" >','<div class="theBoxer floatLeft" ></div>','<div class="theBoxer theBoxer2 floatLeft" ></div>','<div class="theBoxer theBoxer3 floatLeft" ></div>','<div class="theBoxer theBoxer4 floatLeft" ></div>',"</div>",'<div class="useClickBtn" ><a href="javascript:(0);" onclick="openQuickPay()"></a></div>'];break;case 4:t="gotToLose";q=['<div class="gotToLoseBoxer">','<div class="theTipsBow fontset" >您的','<span class="theSpecial">100元</span>',"凡科现金券</div>",'<div class="hasDay fontset" >','<span class="canHideNow">还有</span>','<span class="theSpecial theLessDayTer">3</span>','<span class="canHideNow">天</span>',"过期</div>",'<div class="limitOne fontset" >每人限用一次，过期不可再领</div>','<div class="tipsLeft" >','<div class="tipsOne" >现金券可用于购买任意版本的互动会员</div>','<div class="tipsTwo" >互动会员拥有','<span class="theSpecial">强制关注、派发微信红包</span>等特权',"</div>","</div>",'<div class="useClickBtn" ><a href="javascript:(0);" onclick="openQuickPay()"></a></div>',"</div>"];break;default:return;break}if($(".theRealBoxer").length>0){$(".theRealBoxer").html("")}var r=$("#popupBgPromotion");var i=j==2?0.5:0.7;if(r.length<=0){if(!a.isYKY){var r=$('<div id="popupBgPromotion"></div>');r.appendTo("body");a.bg("popupBgPromotionBg",i,function(){$(this).appendTo(r)});var z=$('<div class="poupWindow '+t+'"><div class="poupWindowBoxer"><div class="closeBtn"></div><div class="theRealBoxer"></div></div></div>');r.append(z)}}else{$(".poupWindow").removeClass("getRedPackage").removeClass("getRedPackage2").removeClass("packAgeEnd").removeClass("gotToLose").addClass(t)}$(q.join("")).appendTo($(".theRealBoxer"));$("#popupBgPromotion .closeBtn").off("click").on("click",function(){$("#popupBgPromotion").fadeOut(500)});$("#popupBgPromotion .useClickBtn").off("mouseover").on("mouseover",function(){if(!$(this).hasClass("hoverBtn")){$(this).addClass("hoverBtn")}}).off("mouseleave").on("mouseleave",function(){if($(this).hasClass("hoverBtn")){$(this).removeClass("hoverBtn")}});var c={now:20,go:20,turningTime:w(5000,6000),hasGoTime:0,};var A={theTime:k,};switch(j){case 1:m();$("#popupBgPromotion .useClickBtn").off("click").on("click",function(){clearTimeout(y);y=null;v=null;$(".goingTips").eq(0).removeClass("brightTips");if(x){x=false;$.ajax({url:a.versionURL+"/ajax/hdportal_h.jsp?cmd=getFestivalCoupon",type:"post",error:function(C){a.hdShowMsg("error","服务繁忙，请稍后重试。",false)},success:function(D){var C=$.parseJSON(D);if(C.success){k=C.data.theEndTime;$("#hd-poup-Floaer").remove();u()}else{x=true;a.hdShowMsg("error",C.msg,false)}}})}});break;case 2:var g=k;h();break;case 3:case 4:var e=new Date();var l=k;var B=e.getTime();var d=Math.ceil(l-B)/1000;var f=k;var o=$(".specialTips");if(j==4){o=$(".theLessDayTer")}$("#popupBgPromotion .canHideNow").show();if(f>2){o.html(f)}else{if(f==2){o.html("明天");$("#popupBgPromotion .canHideNow").hide()}else{o.html("今天");$("#popupBgPromotion .canHideNow").hide()}}break}$(".useClickBtn").on("click","a",function(){if(j!=1){$("#popupBgPromotion").remove()}if(j==3){a.logDog(1000144,5)}else{if(j==2){a.logDog(1000144,19)}else{if(j==4){a.logDog(1000144,20)}}}});if(j!=2){$.cookie("lastTimeShowHdEndActiveWindow",new Date().getTime()+g_timeDeviation,{expires:365})}function w(D,C){return D+Math.round(Math.random()*(C-D))}var y,v;function m(){var C=$(".goingTips").eq(0);if(v){v=null;C.removeClass("brightTips")}else{v=1;C.addClass("brightTips")}y=setTimeout(arguments.callee,500)}function h(){var C=new Date();C.setTime(k);var D=C.getFullYear()+"/"+(C.getMonth()+1)+"/"+C.getDate();$(".theDeadLine").text(D);k=null}function u(){if(c.now>0){var D=a.easeInOut((c.go-c.now),0,c.turningTime,c.go);c.now--;D-=c.hasGoTime;c.hasGoTime+=D;var G=(c.go-c.now)%4;G--;$(".theRedTypeBoxer .goingTips").removeClass("brightTips").eq(G).addClass("brightTips");setTimeout(arguments.callee,D)}else{x=true;var C=p;var E=k;c=null;var F=s;setTimeout(function(){a.initPoupWindow(2,C,E,F)},500)}}$("#popupBgPromotion").show();n&&n(j)};a.showPreviewBox=function(h){a.logDog(1000187,1);h=$.extend({game:null,moviePath:"",iframeUrl:"",opts:null,myActive:false,editActiveAuth:true,pubActiveAuth:true,},h);var n=h.game;var k=n.$$verInfo?n.$$verInfo:n.verInfo;var g=$("#poup_previewBox");if(g.length>0){g.remove()}var l=n._flagB?n._flagB.f512:hdFai.checkBit(n.flagB,512);var m='<div class="attentionTip"><div class="tip">您可以将活动链接复制到您的公众号菜单或自定义回复中</div></div>';var f=h.myActive;var j="";var p=a.isOem?"http://www.webportal.cc/sys/view.jsp?id=487":"http://hd."+a.HomeHost+"/news/5249";if(l&&(h.hasWXAuth=="false")){m='<div class="attentionTip"><div class="tip">已开启强制关注，请将活动链接放于公众号菜单中<a href="'+p+'" target="_balank">详细教程</a></div><div class="warn"><span class="warnIcon"></span>请勿把二维码或链接直接发给非公众号粉丝，否则将达不到强制关注的效果！</div></div>'}if(h.editActiveAuth){j='<a href="javascript:;" class="main-Button button button-edit"><i class="button-icon"></i>'+(f?"进入":"继续")+"编辑</a>"}if(h.pubActiveAuth&&!h.hasPublish){j='<a href="javascript:;" class="main-Button button button-publish active"><i class="button-icon"></i>马上发布</a>'+j}var d=a.getGameUrl(n.id,n.style,n.createTime,l,n.uriToken);var o="//"+location.hostname+"/qrCode.jsp?cmd=qrurl&siteUrl="+hdFai.encodeUrl(d+"&fromQrcode=true");var i='<div class="previewBox clearfix"><div class="left phoneBox"><div class="phone"><div class="wxTitle"><div class="actName">'+n.name+'</div></div><div class="phoneMask absBg" style="z-index:999"></div><div class="phoneQrcodeBox"><div class="phoneQrcode"><img src="'+o+'" style="width:100%;display:block;"></div><div class="text">扫二维码体验活动</div></div><iframe frameborder="0" scrolling="no"></iframe></div><span class="pointerIcon"></span></div><div class="left contentBox" style="margin-left: -130px;"><div class="item"><div class="content linkPicBox"><div class="linkPic"><img class="qrcodeImage" src="'+o+'" ><div class="wxScan"><span class="scan">微信扫一扫</span><span class="downCode">下载二维码<span></div></div></div></div><div class="item"><div class="title"></div><div class="content linkSiteBox"><input class="linkSite" readonly="" type="text" value="'+d+'" /><div class="main-Button-blue copyButton" >复制</div>'+m+'</div></div><div class="button-group">'+j+"</div></div></div>";var c=$.extend({name:"previewBox",content:i,hasTitle:true,hasBottom:false,title:"预览",width:700,height:0,showMask:true,confirmFun:null,cancelFun:null,styles:"",contentStyles:"",closeWhileClickOther:true,isComfirmBox:false},h.opts);g=a.popup(c);g.css("position","absolute");if(!h.fromCanal){g.find("iframe").attr("src",h.iframeUrl)}var q=top.$(".bg-mask");g.on("poupBox_close",function(){q.off("previewBox")});q.off("previewBox").on("click.previewBox",function(){g.find(".closeBtn").click()});g.find(".downCode").click(function(){a.logDog(1000187,4);window.location.href="//"+location.hostname+"/qrCode.jsp?type=1&cmd=qrurl&siteUrl="+hdFai.encodeUrl(d+"&fromQrcode=true")});function e(){if(g.data("publishing")){return}g.data("publishing",true);a.showPublishBoxById(n.id,k,function(r){if(r){a.logDog(1000022,f?3:2);g.closest("#poup_canalBox").remove()}else{g.removeData("publishing")}})}$().closest("selector");g.find(".publish").click(e);g.find(".button.button-edit").click(function(){a.logDog(1000187,(f?15:14));g.closest("#poup_canalBox").find(".poupTitle .closeBtn").click();h.onEditButtonClick&&h.onEditButtonClick()});!h.hasPublish&&g.find(".button.button-publish").click(function(){if(h.hasPublish){g.closest("#poup_canalBox").find(".poupTitle .closeBtn").click();return}a.logDog(1000187,13);if(a.isOem&&k.authVer===a.hdVer.FREE){a.hdShowMsg("error","试用版无法发布活动，请先升级版本",false)}else{e()}});top.HdPortal.copyText({btn:g.find(".copyButton"),input:g.find(".linkSite"),complete:function(){a.logDog(1000187,3)}});if(a.m_debug||top.indexTest){g.find(".qrcodeImage").on("click",function(r){r.stopPropagation();r.preventDefault();window.open(d+"&test=gg321")})}return g};a.showCanalView=function(f){var n=f.game;var k=a.getGameUrl(n.id,n.style,n.createTime,hdFai.checkBit(n.flagB,512),n.uriToken);var e=$("#poup_canalBox");if(e.length>0){e.remove()}e=a.popup({name:"canalBox",content:'<div class="canalBox"><div class="canalTable" style="height:507px;"></div><div class="addCanalName hide"><span class="pointerIcon"></span><input class="canalInput" placeholder="请输入渠道名称"/><div class="inputErrMsg hide" style="1px solid red">输入不能为空且长度不超过30个字</div><div class="addConfirm"><span class="main-Button-blue cancleAddBtn">取消</span><span class="main-Button confirmAddBtn">添加</span></div></div></div>',hasTitle:true,hasBottom:false,title:'<div class="tabContent" style="font-weight: normal"><span class="tab check">预览</span><span class="tab canal">渠道</span><div class="slideBar"><div class="transitionPanel"></div></div></div>',width:700,showMask:true,confirmFun:null,cancelFun:null,isComfirmBox:true,closeWhileClickOther:true,styles:"",contentStyles:"",isComfirmBox:false,mustHideBg:true,});function d(){var r='<form class="canalForm" method="post"><div ><span class="barBtn addCanal"> + 添加渠道</span><span class="barBtn exportCanal"><span class="exportIcon"></span>导出</span></div></form>';var q={toolBar:[{show:true,content:r}],tableColumn:{showCheckbox:false,columns:[{key:"name",name:"渠道名称",colClass:"textCenter columnFont",onsort:false,rowClass:"textCenter defaultWidth",extData:function(s,t){return hdFai.encodeHtml(s)}},{key:"link",name:"带参链接",colClass:"textCenter column3 ",rowClass:"textCenter detailWidth nowrap",onsort:false,noShowHovreTips:false,extData:function(s,t){return'<div style="width:140px"><input class="linkSite" readonly="" type="text" value="'+s+'" /><div class="main-Button copyButton_canal" >复制</div></div>'}},{key:"operation",name:"操作",onsort:false,colClass:"textCenter width80",rowClass:"textLeft  defaultWidth width80",extData:function(s,t){var u='<div class="optStyle"><span class="downloadQRCode">下载二维码</span><span class="editCanal">修改</span><span  class="delCanal">删除</span></div>';return u}},]},ajaxPage:{url:a.versionURL+"/ajax/hpFaiTabel_h.jsp?cmd=getCanalList&gameId="+n.id,cache:false,after:m,regroup:function(s){console.info(s);var t=[];if(s.dataList){$.each(s.dataList,function(v,w){var u={};u.key=w.key;u.name=w.name;t.push(u);w.link=k+"&canal="+w.key});n._setting.canalList=JSON.stringify(s.realList);console.info(s.realList)}}},bottom:{show:true,showTotal:true,showAllTotal:true,showPage:true,showPageJump:true,showPageNumSelect:false,},page:{startPage:1,showCount:5,},itemHover:true,noDataMsg:"<center>没有数据</center>",};e.find(".canalTable").faiTable(q)}d();e.find(".exportCanal").click(function(){var q="?cmd=exportCanal&gameId="+n.id+"&style="+n.style+"&gameUrl="+k+"&_TOKEN="+f.downLoadToken;window.location.href=a.versionURL+"/ajax/hdportal_h.jsp"+q;a.logDog(1000187,8)});var h;var j=false;function m(){e.find(".canalTable .optStyle span.delCanal").on("click",function(){var r={};r.name="delCanal";r.content='<div style="text-align:center;margin-top: 40px;color: #333;"> 删除渠道后原链接将失效，渠道数据将丢失。确认删除该渠道吗?</div>';r.hasTitle=false;r.hasBottom=true;r.isComfirmBox=true;r.width="200px";r.height="80px";r.showMask=false;r.confirmBtnName="确认";r.cancelBtnName="取消";r.cancelFun=function(){j=false};var q=$(this);var s=q.parents("tr").attr("_index");r.confirmFun=function(t){var u=e.find(".canalTable").faiTable("getPrimaryKeyData",s);i("del",u);e.find(".canalTable").faiTable("rmPrimaryKeyData",s);j=false};a.popup(r);j=true});e.find(".canalTable div.optStyle span.downloadQRCode").click(function(){var r=$(this);var t=r.parents("tr").attr("_index");var s=e.find(".canalTable").faiTable("getPrimaryKeyData",t);var q=s.link;a.logDog(1000187,10);window.location.href="//"+location.hostname+"/qrCode.jsp?type=1&cmd=qrurl&siteUrl="+hdFai.encodeUrl(q+"&fromQrcode=true")});top.HdPortal.copyText({btn:e.find(".copyButton_canal"),input:function(){return $(this).prev("input").val()},complete:function(){a.logDog(1000187,9)}});e.find(".canalInput").bind("input propertychange",function(){var q=$(this).val().trim();if(q.length==0||q.length>30){l();console.info(55)}else{p()}});e.find(".canalTable div.optStyle span.editCanal").bind("click",function(){e.find(".addCanalName").show();var s=$(this).offset().top-e.find(".barBtn").offset().top+40;var r=parseInt(e.find(".addCanalName").css("left"))-50;e.find(".addCanalName").css({left:"377px",top:s+"px"});e.find(".confirmAddBtn").text("修改");h=$(this).parents("tr").attr("_index");var q=e.find(".canalTable").faiTable("getPrimaryKeyData",h);e.find(".canalInput").val(q.name);p()})}function l(){e.find(".inputErrMsg").show();e.find(".confirmAddBtn").addClass("disable");e.find(".canalInput ").css("border","1px solid red");e.find(".addCanalName").css("height","129px")}function p(){e.find(".inputErrMsg").hide();e.find(".addCanalName").css("height","109px");e.find(".confirmAddBtn").removeClass("disable");e.find(".canalInput ").css("border","1px solid #e7e7e7")}e.find(".canalTable  .addCanal").click(function(){a.logDog(1000187,6);if(n.verInfo&&n.verInfo.authVer<2||n.$$verInfo&&n.$$verInfo.authVer<2){if(a.isOem){a.hdShowMsg("error","渠道管理为营销版功能",false)}else{a.hdShowMsg("error",'渠道管理为铂金版功能<a onclick="openQuickPay(1000144,25)" href="###">前往升级</a>');console.info(a.noSupportTipA)}return}var q=e.find(".canalTable").faiTable("returnDataCount");if(q>=30){a.hdShowMsg("error","最多添加30个渠道！",false);return}e.find(".addCanalName").show();e.find(".confirmAddBtn").text("添加");e.find(".addCanalName").css({left:"411px",top:"54px"});e.find(".canalInput ").val("");p()});e.find(".addConfirm span.cancleAddBtn").click(function(){e.find(".addCanalName").hide();e.find(".inputErrMsg").hide();e.find(".canalInput ").css("border","1px solid #e7e7e7")});e.find(".addConfirm span.confirmAddBtn").click(function(){var s=e.find(".canalInput").val().trim();if(s.trim()==""||s.length>30){l();return}var q={};q.name=s;e.find(".addCanalName").hide();if(e.find(".confirmAddBtn").text()=="添加"){i("add",q)}else{var r=e.find(".canalTable").faiTable("getPrimaryKeyData",h);r.name=s;console.info(r);i("edit",r)}e.find(".canalInput").val("")});function i(q,r){var s={};s.cmd="saveCanal";s.data=JSON.stringify(r);s.opt=q;s.gameId=n.id;$.ajax({type:"post",url:a.versionURL+"/ajax/hdportal_h.jsp",data:s,error:function(t){a.hdShowMsg("error","系统繁忙，请稍后重试",false)},success:function(u){var t=JSON.parse(u);if(t.rt!=0){a.hdShowMsg("error",t.msg,false)}else{if(q=="add"){a.logDog(1000187,7)}else{if("edit"==q){a.logDog(1000187,11)}else{a.logDog(1000187,12)}}a.hdShowMsg("right",t.msg,false);e.find(".canalTable").faiTable("loadAjaxPage")}}})}var o=top.$(".bg-mask");e.on("poupBox_close",function(){o.off("canalBox")});o.off("canalBox").on("click.canalBox",function(){if(!j){e.find(".closeBtn").click();j=false}});e.find(".poupContent").append(f.previewBox);f.previewBox.find(".poupTitle").addClass("hideImp");var g=e.find(".canalBox").hide();var c=e.find(".tabContent .transitionPanel");e.find(".tabContent .tab").each(function(q,r){$(this).click(function(s){$(this).addClass("check").siblings(".tab").removeClass("check");c.css("left",100*q);f.previewBox.toggle(q==0);if(q==0){e.find("iframe").attr("src",f.iframeUrl);a.logDog(1000187,2)}else{a.logDog(1000187,5)}g.toggle(q==1)})});if(f.fromCanal){e.find(".tabContent .canal").trigger("click")}return e};a.showBuyGiftBox=function(g,d,c,f,e){top.HdPortal.Res.loadg("popBoxForBuy").then(function(){function i(){var k=top.$("#popBoxForBuy .boxInfo .nowNum").val();var m=parseFloat(top.$("#popBoxForBuy .boxInfo .price").text().replace(/￥/,""));var l=(k*m).toLocaleString();var n=l.split(".");if(n.length==1){n[1]="00"}else{if(n[1].length==1){n[1]=n[1]+"0"}}n="￥"+n.join(".");top.$(".boxBottom .total").text(n);n=n.replace(/,/,"");top.$(".boxInfo .total").text(n)}var h='<div id="popBoxForBuy" class="poupBox confirmPoupBox canalBox poup-box-animate hide"><div class="boxTitle"><div class="boldFont">礼品</div><div class="closeGiftBox"></div></div><div class="boxTop"><span class="boxTopTitle_name">商品</span><span class="boxTopTitle_price">单价</span><span class="boxTopTitle_num">数量</span><span class="boxTopTitle_total">总计</span></div><div class="boxInfo"><div class="giftImg_small"><img /></div><div class="giftText_small"></div><div class="price"></div><div class="number"><div class="subNum">-</div><input maxlength="6" class="nowNum onlyNum" value="1" type="text"><div class="addNum">+</div></div><div class="total boldFont"></div></div><div class="boxBottom"><div class="settlementBtn">去结算</div><div class="total boldFont"></div><div class="totalText">总金额：</div></div></div>';top.$("body").append(h);function j(){top.$("#popBoxForBuy .boxInfo .number .subNum").off("click.oper").on("click.oper",function(){var k=top.$("#popBoxForBuy .boxInfo .number .nowNum").val();if(k==1){return}k--;top.$("#popBoxForBuy .boxInfo .number .nowNum").val(k);i()});top.$("#popBoxForBuy .boxInfo .number .addNum").off("click.oper").on("click.oper",function(){var k=top.$("#popBoxForBuy .boxInfo .number .nowNum").val();if(k==999999){return}k++;top.$("#popBoxForBuy .boxInfo .number .nowNum").val(k);i()});top.$("#popBoxForBuy .boxInfo .number .nowNum").on("keydown",function(m){var k=top.$("#popBoxForBuy .boxInfo .number .nowNum").val();var l=m.keyCode;if(k==""&&(l==48||l==96)){return false}}).on("keyup",function(){var k=top.$("#popBoxForBuy .boxInfo .number .nowNum").val();if(k=="0"){top.$("#popBoxForBuy .boxInfo .number .nowNum").val("1")}i()}).on("blur",function(){var k=top.$("#popBoxForBuy .boxInfo .number .nowNum").val();if(k==""){top.$("#popBoxForBuy .boxInfo .number .nowNum").val("1")}i()});top.$("#popBoxForBuy .boxTitle .closeGiftBox").on("click",function(){top.$(".bg-mask").removeClass("bg-mask-animate");top.$(".bg-mask").hide();top.$("#popBoxForBuy").remove()});top.$("#popBoxForBuy .boxBottom .settlementBtn").on({mouseover:function(){$(this).addClass("settlementBtnOver")},mouseout:function(){$(this).removeClass("settlementBtnOver")}});top.$("#popBoxForBuy .boxTitle .closeGiftBox").on({mouseover:function(){$(this).addClass("closeGiftBoxOver")},mouseout:function(){$(this).removeClass("closeGiftBoxOver")}})}j();$.ajax({url:a.versionURL+"/ajax/hdgift_h.jsp?cmd=getGiftInfo&typeB="+g,type:"post",success:function(q){var l=$.parseJSON(q);if(l.success){var p=l.data.price.toFixed(2);var o=a.isOem?l.data.price1.toFixed(2):0;var k=a.isOem?o:p;var r=l.data.title;var n=l.data.pic;a.productId=a.isOem?l.data.oem_productId:l.data.productId;top.$("#popBoxForBuy .boxInfo .giftImg_small img").attr("src",a.resRoot+n);top.$("#popBoxForBuy .boxInfo .giftText_small").html(r);top.$("#popBoxForBuy .boxInfo .price").html("￥"+k);if(d){top.$("#popBoxForBuy .boxInfo .number .nowNum").val(d)}var m=$(".bg-mask");if(m.length==0){m=$('<div class="bg-mask hide"></div>');$("body").append(m)}top.$(".bg-mask").show().addClass("bg-mask-animate").off("click");top.$("#popBoxForBuy").show();i()}}});top.$(".settlementBtn").on("click",function(){var m=top.$("#popBoxForBuy .boxInfo .nowNum").val();var p=parseFloat(top.$("#popBoxForBuy .boxInfo .price").text().replace(/￥/,""));var o=m*p;var n=$(".giftTypeClick").data("type");var k=3000;var l=window.open();if(a.isOem){q(l);return}$.ajax({type:"post",url:"/ajax/hdgift_h.jsp?cmd=getBuyGiftMoney",error:function(){a.hdShowMsg("error","服务繁忙，请稍候重试",false);l.close()},success:function(s){var r=$.parseJSON(s);if(r.success){if(!r.isValidatePhone){if(o+r.hasBuy>k){l.close();a.verifyPhonePopup(q);return}}q(l);return}l.close()}});function q(t){var r=a.productId;var s=a.isOem?a.OemPortalHost:a.HdPortalHost;t.location="http://"+s+"/portal.jsp?#appId=shopCart&iParams="+hdFai.encodeUrl("urlProductId="+r+"&amount="+m)+"&iParams="+Math.random();a.showRechargeBox("购买礼品",function(){top.$(".bg-mask").removeClass("bg-mask-animate");top.$(".bg-mask").hide();top.$("#popBoxForBuy").remove();$.ajax({type:"post",url:a.versionURL+"/ajax/hdgift_h.jsp?cmd=getAssetAmount&storeId="+c+"&areaId"+f,error:function(){a.hdShowMsg("error","服务繁忙，请稍候重试",false)},success:function(u){var v=$.parseJSON(u);if(v.success){e&&e(v.data)}}})})}})})};a.bind_WX_poup=function(e){var c={status:1,qrCodeUrl:null,isPublishing:false,openId:"",storeId:0,areaId:0,callBack:null,succBind:null,};e=$.extend(c,e);if(e.status!=2&&!e.qrCodeUrl){return}var d=top.$(".bg-mask");top.HdPortal.Res.loadg("bindWXpoup").then(function(){var g={};var h="";var i=500;g.name="bind_wx_poup_"+e.status;g.hasTitle=false;g.hasBottom=e.status==2;g.height=460;switch(e.status){default:case 1:h="<div class='finishBind'><img src='"+e.qrCodeUrl+"'/><p class='textCenter'>微信扫一扫</p></div><p class='bingTips1 wxPoup_tipsColor textCenter'>请先绑定\"凡科互动\"公众号后继续操作</p><p class='bingTips2 wxPoup_tipsColor textCenter'>绑定后，可在微信中收取活动关键信息（实时参与人数，获奖人数等）</p>";break;case 2:h="<div class='finishBind'><img src='"+a.resRoot+"/version2/image/icon-wcbd.png'/></div><p class='textCenter'>完成绑定！</p>";g.confirmBtnName="关闭窗口";g.isOneBottomBtn=true;if(e.isPublishing){g.confirmFun=function(){top.window.location.reload(true)}}break;case 3:i=450;h="<div class='finishBind'><img src='"+e.qrCodeUrl+"'/></div><p class='bingTips1 wxPoup_tipsColor textCenter'>请使用新的微信号扫码绑定</p><p class='bingTips2 wxPoup_tipsColor textCenter'>更换后，活动关键信息将发送给新绑定的微信号</p>";break}g.content=h;g.width=i;var l=a.popup(g);e.callBack&&e.callBack(l);var k;if(e.status!=2){l.find(".finishBind img").attr("src",e.qrCodeUrl);d.off("click.bindWX_poup").on("click.bindWX_poup",function(){k&&k();l.hide();d.toggle(!e.isPublishing);if(!e.isPublishing){$(".poupBox:visible").not(l).css({"z-index":1000})}})}else{e.succBind&&e.succBind(l);d.off("click.bindWX_poup")}a.loading.hide();if(e.status!=2){a.logDog(1000242,1);var j=l.find(".finishBind img");f(l);if(j.data("hasBin")){return}j.data("hasBin",true).off("click.loadImg").on("click.loadImg",function(o){a.loading.show();var n=this;var m=1;if(e.openId&&e.openId.length>0){m=0}var p={isnew:m,storeId:e.storeId,areaId:e.areaId,};$.ajax({type:"post",url:"/ajax/hdportal_h.jsp?cmd=needCode",data:p,error:function(){a.loading.hide();a.hdShowMsg("error","服务繁忙，请稍候重试",false)},success:function(q){var r=$.parseJSON(q);a.loading.hide();if(r.needCode){$(n).attr("src",r.wxQRCodeUrl)}else{d.hide();a.hdShowMsg("error","数据异常，请刷新后重试！",false)}}})})}function f(m){var p=a.poll.$new();var o=$.extend({},e);var n={storeId:o.storeId,areaId:o.areaId,};k=p({name:"isBindWX",time:2000,poll:function(q,r){$.ajax({url:"/ajax/hdportal_h.jsp?cmd=bindsuccess",cache:false,data:n}).then(function(t){var s=$.parseJSON(t);if(s.needShow){if(s.hasBind){if(s.openid!=o.openId){m.remove();a.$data.isBindOpenId=true;a.bind_WX_poup({status:2,isPublishing:o.isPublishing,succBind:o.succBind,});return}}}else{m.remove();a.hdShowMsg("error",s.msg,false);return}q()})}})}})};a.initVersionDead=function(i){if(!i||a.isOem){return}var l=i.verName;var c=i.daoqiTime;var d=c-new Date().getTime();d=d>0?d:0;var o=24*60*60*1000;var e=Math.floor(d/o);if(e>30||d<=0||!i.isUpdate||!i.isBUser){top.$(".ver_zs_head .almostPassVersion").hide();return}i.appendBox.append('<div class="almostPassVersion">即将到期</div>');var p=top.HdPortal.$data;var k=p.httpStr+"://"+top.HdPortal.HdPortalHost+"/jump.jsp?t=42";var g=false;var f=1;if(e<7&&e>=0){g=true;f=2}var h="hd_fkw_version_dead_"+p.aid+"_type_"+f;var n=a.getLocalStorage(h);if(n&&n==c||(g&&!i.hasGetCoup)){return}top.HdPortal.asyncCss.load("popup_versionDead",i.css_key,function(){if(g){j()}else{m()}});function m(){var r='<div class="version_deadLine tipBarVersionDead"><img src="'+a.resRoot+'/version2/image/payService/hourglass.png?v=201808191753" alt=""><p class="versionInfo">您的<span class="versionName">'+l+'</span>将于<span class="dayLeft">'+e+'天</span>后过期</p><p class="xufeiTips">请及时续费，以保留'+l+'特权</p><div class="gotoReHax">前往续费</div><span class="shutDown">关闭</span></div>';var q=$(r);q.find(".gotoReHax").on("click.goToPay",function(){a.logDog(1000272,2);window.open(k)});q.find(".shutDown").on("click.shutDown",function(){var s=a.getDate(new Date(),30);a.setLocalStorage(h,c);q.remove()});top.$("body").append(q);a.logDog(1000272,1)}function j(){var s=new Date();s.setTime(c);var u=s.getFullYear()+"年"+(s.getMonth()+1)+"月"+s.getDate()+"日";var t='<div class="version_deadLine tipBarVersionCoup"><div class="coupBoxInfo"><p class="coupNum"><span class="danweiTips">￥</span><span class="moneyPass">100</span></p><p class="coupTipsInfo">已送您一张100元现金券续费版本</p></div><p class="versionInfo">您的<span class="versionName">'+l+'</span>将于<span class="dayLeft">'+u+'</span>过期</p><p class="xufeiTips">'+l+'只剩<span class="leastTime"></span>有效</p><div class="gotoReHax">使用现金券续费</div><span class="shutDown">关闭</span></div>';var r=$(t);r.find(".gotoReHax").on("click.goToPay",function(){a.logDog(1000272,4);window.open(k)});r.find(".shutDown").on("click.shutDown",function(){a.setLocalStorage(h,c);r.remove()});function q(){var B=new Date().getTime();if(B>c){r.remove()}else{var x=c-B;var A="";if(x>o){var v=Math.floor(x/o);A+=v+"天";x=x-(v*o)}var w=Math.floor(x/(60*60*1000));x-=w*60*60*1000;var z=Math.floor(x/(60*1000));x-=z*60*1000;var y=Math.floor(x/1000);if(w<10){w="0"+w}A+=w+":";if(z<10){z="0"+z}A+=z+":";if(y<10){y="0"+y}A+=y;r.find(".leastTime").text(A);setTimeout(arguments.callee,1000)}}q();top.$("body").append(r);a.logDog(1000272,3)}}}(HdPortal));