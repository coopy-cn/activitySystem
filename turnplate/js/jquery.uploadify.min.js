(function(a){a.fn.uploadify=function(n){var q='<div id="${fileID}" class="uploadify-queue-item "><div class="uploadify-progress"><div class="uploadify-progress-bar"></div></div><span class="up_filename">${fileName}</span><span class="uploadbtn">上传</span><span class="delfilebtn">删除</span></div>';var k={fileTypeExts:"",uploader:"",auto:false,method:"post",multi:false,formData:{},fileObjName:"filedata",fileSizeLimit:2048,showUploadedPercent:false,showUploadedSize:false,buttonText:"",buttonClass:"",progressBox:null,removeTimeout:1000,itemTemplate:q,breakPoints:false,fileSplitSize:1024*1024,getFileSizeUrl:"",isPortal:false,isparallel:false,onFilterErr:null,getUploadedSize:function b(w){var v=0;a.ajax({url:m.getFileSizeUrl,async:false,type:"post",dataType:"json",data:{fileMd5:w.md5,fileSplitSize:m.fileSplitSize,fileName:w.name,totalSize:w.size},success:function(x){if(x.success){v=x.size}else{v=-1}}});return v},saveUploadedSize:null,saveInfoLocal:false,onUploadStart:null,onUploadSuccess:null,onUploadComplete:null,onUploadError:null,onInit:null,onCancel:null,onSelect:null,onProgress:null};var m=a.extend(k,n);var c=m.isparallel?a(this).parent():a("body");var e=m.progressBox||c;var p=function(){return typeof m.uploader=="function"?m.uploader():m.uploader};var s=function(v){m.uploader=v};var i=function(v,w){if(v>1024*1024&&!w){v=(Math.round(v*100/(1024*1024))/100).toString()+"MB"}else{v=(Math.round(v*100/1024)/100).toString()+"KB"}return v};var j=function(v,x){for(var w=0;w<x.length;w++){if(x[w].index==v){return x[w]}}return false};var f=function(z){var w=[];var x=z.split(";");for(var y=0,v=x.length;y<v;y++){w.push(x[y].split(".").pop())}return w};var u={zip:["application/x-zip-compressed"],jpg:["image/jpg"],jpeg:["image/jpeg"],png:["image/png"],gif:["image/gif"],bmp:["image/bmp"],doc:["application/msword"],xls:["application/vnd.ms-excel"],docx:["application/vnd.openxmlformats-officedocument.wordprocessingml.document"],xlsx:["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],ppt:["application/vnd.ms-powerpoint "],pptx:["application/vnd.openxmlformats-officedocument.presentationml.presentation"],mp3:["audio/mp3"],mp4:["video/mp4"],pdf:["application/pdf"],exe:["application/x-msdownload"],html:["text/html"],ico:["image/x-icon"],txt:["text/plain"],flv:[".flv"],swf:["application/x-shockwave-flash"]};var t=function(v){return u[v]};var d=function(A){var y=f(A);var w=[];for(var x=0,v=y.length;x<v;x++){var z=t(y[x]);if(z){w.push(z)}}return w.join(",")};var h=function(w,z,y,v){z.open(m.method,w,true);z.setRequestHeader("X-Requested-With","XMLHttpRequest");var x=new FormData();x.append(m.fileObjName,y,y.name);if(v){for(key in v){x.append(key,v[key])}}z.send(x)};function l(v){m.onProgress&&m.onProgress(v)}function o(){return !m.onFilterErr||(m.onFilterErr.apply(m,arguments)!==false)}var r=null;this.each(function(){var z=a(this);var x=m.isPortal?"":" uploadify-button-game";if(m.buttonClass){x+=" "+m.buttonClass}var v=a(".uploadify").length+1;var w='<input id="select_btn_'+v+'" class="selectbtn theSpecialDesigan"  type="file" name="fileselect[]"';w+=m.multi?" multiple":"";w+=' accept="';if(m.fileTypeExts==null||m.fileTypeExts==""||m.fileTypeExts=="*"){w+="*.*"}else{w+=d(m.fileTypeExts)}w+='"/>';w+='<a id="file_upload_'+v+'-button" href="javascript:;" class="uploadify-button'+x+'">';w+=m.buttonText;w+="</a>";var y='<div id="file_upload_'+v+'-queue" class="uploadify-queue"></div>';z.append(w);r={xhr:null,uploadAllowed:true,fileInput:z.find(".selectbtn"),uploadFileList:a(document).find(".uploadify-queue"),url:p(),fileFilter:[],uploadOver:false,filter:function(F){var C=[];var B=false;var G=f(m.fileTypeExts);if(m.fileTypeExts==""||m.fileTypeExts=="*.*"||m.fileTypeExts==null){B=true}if(G.length>0){for(var E=0,A=F.length;E<A;E++){var D=F[E];if(D.size>m.fileSizeLimit){if(o("outLimit",D)){hdFai.ing("单个文件超过"+m.fileSizeLimit/1024/1024+"MB",true)}continue}if(!B){if(a.inArray(D.name.split(".").pop().toLowerCase(),G)>=0){C.push(D)}else{if(o("typeErr",D)){hdFai.ing("文件"+D.name+"类型不允许！",true)}}}else{C.push(D)}}}return C},funSelect:function(C){if(m.onSelect&&!m.onSelect(C)){r.fileFilter=[];return}if(m.breakPoints){var D=this.funGetUploadedSize(C[0])}if(D==-1){return}var B=(D/C[0].size*100).toFixed(2);var A={status:"start",id:C[0].id,title:"准备上传.....",percent:B,size:C[0].size};l(A);if(m.breakPoints){A={status:"ing",id:C[0].id,title:"正在上传.....",percent:B};l(A);this.funUploadFile(C[0])}},onProgress:function(B,D,H){var E=e.find("#progressWrap_"+B.id);var I=D;var A=E.attr("lastLoaded")||0;D-=parseInt(A);if(D<0){D=0}var F=e.find("#progress"+B.id);var C=m.breakPoints?parseFloat(F.css("width")):0;var G=(D/H*100+C).toFixed(2);G=G>100?99.99:G;if(I<m.fileSplitSize){E.attr("lastLoaded",I)}else{E.removeAttr("lastLoaded")}tmpoptions={status:"ing",id:B.id,title:"正在上传.....",percent:G};l(tmpoptions)},funGetProgressWidth:function(A){},funGetUploadedSize:function(A){if(m.getUploadedSize){return m.getUploadedSize(A)}else{if(m.saveInfoLocal){return parseInt(localStorage.getItem(A.name))||0}}},funSaveUploadedSize:function(A,B){if(m.saveUploadedSize){m.saveUploadedSize(A,B)}else{if(m.saveInfoLocal){localStorage.setItem(A.name,B)}}},funGetFiles:function(D){var C=D.target.files;C=this.filter(C);for(var B=0,A=C.length;B<A;B++){this.fileFilter.push(C[B])}if(this.fileFilter.length==0){return}this.funDealFiles(C);return this},funDealFiles:function(D){var E=a(document).find(".uploadify-queue .uploadify-queue-item").length;for(var C=0,A=D.length;C<A;C++){D[C].index=++E;D[C].id="fileupload_"+v+"_"+D[C].index;var B=typeof D[C].lastModifiedDate==="object"?D[C].lastModifiedDate.getTime():D[C].lastModifiedDate;D[C].md5=a.md5(D[C].name+D[C].size+D[C].type+B);if(D[C].size>=0&&D[C].size<20<<10<<10){m.fileSplitSize=5<<10<<10}else{if(D[C].size>=20<<10<<10&&D[C].size<50<<10<<10){m.fileSplitSize=5<<10<<10}else{if(D[C].size>=50<<10<<10&&D[C].size<100<<10<<10){m.fileSplitSize=8<<10<<10}else{if(D[C].size>=100<<10<<10&&D[C].size<500<<10<<10){m.fileSplitSize=10<<10<<10}else{m.fileSplitSize=20<<10<<10}}}}}this.funSelect(D);return this},funDeleteFile:function(B){for(var D=0,A=this.fileFilter.length;D<A;D++){var C=this.fileFilter[D];if(C.index==B){if(m.breakPoints){this.uploadAllowed=false}this.fileFilter.splice(D,1);a(document).find("#fileupload_"+v+"_"+B).fadeOut();r.clearInputFile();m.onCancel&&m.onCancel(C);break}}return this},clearInputFile:function(){r.fileInput.val("");if(r.fileInput.val()){var A=r.fileInput.next();a("<form></form>").append(r.fileInput)[0].reset();r.fileInput.insertBefore(A)}},funUploadFile:function(F){r.xhr=new XMLHttpRequest();var M=F;var C=false;var A=a(document).find("#fileupload_"+v+"_"+F.index);var J=function(){if(r.uploadOver){A.find(".uploadify-progress-bar").css("width","100%");m.showUploadedSize&&A.find(".uploadedsize").text(A.find(".totalsize").text());m.showUploadedPercent&&A.find(".up_percent").text("100%");m.onUploadSuccess&&m.onUploadSuccess(M,r.xhr.responseText);r.funDeleteFile(F.index);setTimeout(K,1500)}};var K=function(){if(r.fileFilter.length!=0){var P=r.funGetUploadedSize(r.fileFilter[0]);var O=(P/r.fileFilter[0].size*100);var N={status:"start",id:r.fileFilter[0].id,title:"准备上传.....",percent:O,size:r.fileFilter[0].size};l(N);N={status:"ing",id:r.fileFilter[0].id,title:"正在上传.....",percent:O};l(N);r.funUploadFile(r.fileFilter[0])}};try{r.xhr=new XMLHttpRequest()}catch(L){r.xhr=ActiveXobject("Msxml12.XMLHTTP")}if(m.breakPoints){var H=F.name,E=F.id,D=F.index,G=F.size,I=F.md5;var B=parseInt(this.funGetUploadedSize(M));if(G>=m.fileSplitSize){F=M.slice(B,B+m.fileSplitSize);C=false;r.lastSplit=false}else{C=true;r.lastSplit=true}F.name=H;F.id=E;F.index=D;F.md5=I}if(r.xhr.upload&&B!==false){r.xhr.upload.addEventListener("progress",function(N){r.onProgress(F,N.loaded,M.size)},false);r.xhr.onreadystatechange=function(){if(r.xhr.readyState==4){r.uploadOver=true;if(r.xhr.status==200){var O=JSON.parse(r.xhr.responseText);if(O.success){if(m.breakPoints){B+=m.fileSplitSize;r.funSaveUploadedSize(M,B>=G?G:B);if(B<G){r.uploadOver=false;if(r.uploadAllowed){if((B+m.fileSplitSize)>=G){F=M.slice(B,G);C=true}else{F=M.slice(B,B+m.fileSplitSize);C=false}F.name=H;F.id=E;F.index=D;F.size=G;m.formData.fileMd5=M.md5;m.formData.totalSize=M.size;m.formData.complete=C;m.formData.initSize=B;setTimeout(h(r.url,r.xhr,F,m.formData),2000)}}else{J()}}else{J()}}else{var N={status:"end",id:F.id};l(N);r.uploadOver=true;J()}}else{r.uploadOver&&m.onUploadError&&m.onUploadError(M,r.xhr.responseText)}if(r.uploadOver){m.onUploadComplete&&m.onUploadComplete(M,r.xhr.responseText);r.clearInputFile()}}};m.onUploadStart&&m.onUploadStart(F);m.formData.fileMd5=F.md5;m.formData.totalSize=M.size;m.formData.complete=C;m.formData.initSize=B;r.uploadAllowed=true;g(m.post_params);h(r.url,r.xhr,F,m.formData)}},init:function(){if(this.fileInput.length>0){this.fileInput.change(function(A){r.funGetFiles(A)})}z.find(".uploadify-button").on("click",function(){var A=z.hasClass("canNotClick_Photo")||z.hasClass("canNotClick_Logo")||z.hasClass("photoIsLimit");if(!A){z.find(".selectbtn").trigger("click")}});m.onInit&&m.onInit()}};r.init()});function g(w){var v=p();for(key in w){v+="&"+key+"="+w[key]}r.url=v}return{genUploadUrl:g,setUploader:s,stop:function(){r.xhr.abort();r.uploadOver=false;r.uploadAllowed=false;for(var w=0,v=r.fileFilter.length;w<v;w++){r.funDeleteFile(++w)}r.fileFilter=[]},upload:function(y){if(y==="*"){var v=v=r.fileFilter.length;for(var x=0,v=r.fileFilter.length;x<v;x++){r.funUploadFile(r.fileFilter[x])}}else{var w=j(y,r.fileFilter);w&&r.funUploadFile(w)}},cancel:function(x){x="*";if(x=="*"){for(var w=0,v=r.fileFilter.length;w<v;w++){r.funDeleteFile(++w)}}else{r.funDeleteFile(x)}},disable:function(w){var v=w?a("file_upload_"+w+"-button"):a("body");v.find(".uploadify-button").css("background-color","#888").off("click")},ennable:function(w){var v=w?a("file_upload_"+w+"-button"):a("body");v.find(".uploadify-button").css("background-color","#707070").on("click",function(){v.find(".selectbtn").trigger("click")})}}}})(jQuery);