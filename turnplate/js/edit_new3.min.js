function getPreviewWin(){if(!$$.win){try{$$.win=document.getElementById("gamePreviewPage").contentWindow}catch(a){throw"game iframe not ready —— "+a}}return $$.win}function toggleLock(c,b,a){c.toggle(!!b);ERR.lockErr(c,!b,a)}function isEmptyInput(a){if($.trim(a).length==0){return true}return false}function upDateAttentionBox(){if($("#editActive .topBarWarp").find(".column.checked").text()==="中奖页面"){return}var c=getPreviewWin();var a=$$("#resule-gift-box");if(c.isOldAwardPage){$$("#resule-gift-scrollWrap").css("height",$(c).height()-a.find(".attentionBox").height()*1.2-$(c).width()*(1.8/16))}else{$$("#resule-gift-scrollWrap").css("height",$(c).height()-a.find(".attentionBox").height()*1.2-$(c).width()*(1.8/16)+40)}$$("#awardScrollWrap").css("height",$$("#poupInfoBox").height()-$$(".poupHead").outerHeight()-$$("#awardBox .attentionBox").outerHeight()*1.2-$$("#awardInfo").outerHeight());a.css("height",$(c).height()-a.find(".attentionBox").outerHeight());var d=$$("#resule-faiImg").parent();var b=parseFloat(d.css("top"))+d.outerHeight()-a.innerHeight();if(b>0){d.css("top",(parseFloat(d.css("top"))-b)+"px")}$$(".menuAgain:not(.tellToTA),.menuBack,.backListen:not(.backToListen)").css("bottom",a.find(".attentionBox").height());c.hg.fire("changeBottomBar")}function addCommas(b){b+="";x=b.split(".");x1=x[0];x2=x.length>1?"."+x[1]:"";var a=/(\d+)(\d{3})/;while(a.test(x1)){x1=x1.replace(a,"$1,$2")}return x1+x2}function getJqSrc(b){var d="";if(!b||b.length==0){return d}if(d=b.attr("edit_store_src")||""){return d}if(b.attr("src")){d=b.attr("src")}else{if(b.val()){d=b.val()}else{if(b.css("background-image")){var c=b.css("background-image");var a=c.match(/url\(["']?(.+?)["']?\)/);if(a){d=a[1]}}}}return d}function setJqSrc(a,c,b){a.each(function(){var e=$(this)[0].nodeName;if(/img/i.test(e)){$(this).attr("src",c)}else{if(/input/i.test(e)){$(this).val(c)}else{if(b){$(this).css("background-image",'url("'+c+'")')}else{$(this).css({"background-image":'url("'+c+'")',"background-position":"center center","background-repeat":"no-repeat",}).addClass("hd-game-theBg-fillAuto");var d=this;HdPortal.imgReady(c,function(){if($(d).hasClass("hd-img-fillDiv")){var j=$$(d).data("defData");!$(d).data("defPositionData")&&($(d).data("defPositionData",{left:$(d).position().left+$(d).width()/2,top:$(d).position().top+ +$(d).height()/2}));if(!j){return false}var m=$.extend(true,{},j);m={width:getPreviewWin().parseRemToPx(m.width),height:getPreviewWin().parseRemToPx(m.height)};var l={width:$(d).width(),height:$(d).height()};var g=hdFai.Img.calcSize(this.width,this.height,m.width,m.height,hdFai.Img.MODE_SCALE_DEFLATE_FILL);var f={left:$(d).position().left+(l.width-g.width)/2,top:$(d).position().top+(l.height-g.height)/2};var i=getPreviewWin().HdGame.getPosition($(d),{width:l.width,height:l.height},{width:g.width,height:g.height});$(d).css({width:g.width+"px",height:g.height+"px",left:i.left+"px",top:i.top+"px"})}else{var l={width:$(d).width(),height:$(d).height()};var g=hdFai.Img.calcSize(this.width,this.height,l.width,l.height,hdFai.Img.MODE_SCALE_DEFLATE_FILL);var h=100*g.width/l.width;var k=100*g.height/l.height;$(d).css("background-size",h+"% "+k+"%")}})}}}});a.hdTrigger("hd-editUpload-changeTheSrc",[a,c])}function parsePxToRem(a){var b=$$.win?$$.win.g_rem:23.4375;if(typeof a=="number"){return(parseInt(a)/b<=0?4:parseInt(a)/b)+"rem"}return parseInt(a)/b+"rem"}function getCodeListByVal(b){if(typeof b!="string"||b.length==0){return[]}var a=b.split("\n").map(function(d,c){return d.trim()});a=a.filter(function(d,c){if(d!=""){return true}else{return false}});return a}function getCodeListByLevel(b){var a=[];$.each(cusCodelist,function(c,d){if(d.level==(b+1)&&d.type&&d.type==1){a.push(d.custom)}});return a}(function(){var a,b;window.ERR=HdPortal.getERR({parentDef:$(".editDetail"),onCheckErr:function(d){var c=d.getErr();if(!a){a=$("#activeTab .tabSetting");b=$("#awardBoxTitle .awardLevelItem")}a.removeClass("hasErr");b.removeClass("hasErr");c.each(function(){var f=$(this);var i=f.closest(".awardSettingBox");if(i.length>0){b.eq(i.attr("_index")).addClass("hasErr")}var h=f.closest(".settingBox");if(h.length>0){var g=h.attr("option");if(g!==undefined){a.filter("[option="+g+"]").addClass("hasErr")}}});var e=c.length>0;if(getIsSave()){$("#saveButon,#savePubButon").toggleClass("disabled",e);$("#newSavePubButon").toggleClass("hideImp",e)}},setMargin:true})})();if(typeof HdGame=="undefined"){var Edit={}}(function(c){$.fn.extend({hdTrigger:function(e,d){this.trigger.apply(this,arguments)}});c.getInjector=function(){return $("#editActContainer").injector()};c.rootSafeApply=function(d){c.getInjector().invoke(["$rootScope",function(e){e.$safeApply(d)}])};c.compileHtml=function(e,i,f){var h={html:"",link:null,scope:null,beforeLink:null,};if(arguments.length==1&&$.isPlainObject(e)){$.extend(h,e)}else{h.html=e;h.link=i;h.scope=f}if(!h.html){return""}var d="",g=c.getInjector();f=h.scope;g.invoke(["$rootScope","$compile","watch",function(j,l,m){if(f){if(f=="root"){f=j}else{if($.type(f)=="function"){f=f(j)}else{if($.type(f)=="string"||f.nodeType||f instanceof jQuery){f=$(f).scope();f&&(f=f.$new())}}}}var k=f||j.$new();k.$safeApply(function(){h.beforeLink&&g.invoke(h.beforeLink,k,{$scope:k});d=l(h.html)(k);h.link&&g.invoke(h.link,k,function(o){var n={$element:d,$scope:k,};if(o.indexOf("$newWatch")!=-1){n.$newWatch=m.$new(k)}return n})})}]);return d};c.defend=function(e,d){$.each(e,function(g,h){var f=d[g];if($.isPlainObject(h)&&$.isPlainObject(f)){return c.defend(h,f)}if(hp.getType(h)=="undefined"||h!=h){e[g]=f}})};c.clear=function(f,e){var d=e?/^[$].+/:/^[_\$].+/;$.each(f,function(g,h){if(d.test(g)){delete f[g]}else{if($.isPlainObject(h)||$.isArray(h)){c.clear(h,e)}}});return f};c.checkedAllWatch=function(){var d=null;c.getInjector().invoke(["watch","$injector",function(j,h){var g=/^(.+?)\./;var f=true;for(var e=0;f;e++){f=false;j.checkedAll(function(l,i){if(!i){return}d=null;var k=i;if(typeof i=="function"){d=h.invoke(i)}if(d===false){return}f=true;if($.isPlainObject(i)){d=i}else{if(i==="$def"){k=l.replace(g,"$1Def.")}else{if(i==="$old"){k=l.replace(g,"$1Last().")}}}if(d&&d.cmd){d.fn&&d.fn();return d.cmd}if(k.indexOf("=")==-1){k=l+"="+k}this.$eval(k)});if(d&&d.cmd&&d.cmd==="breakSave"){return}if(e>10){console.warn("checke err over 10");return}}}]);return d};c.watch=hdFai.watch.$new();c.scrollView=function(f,d){d=d||10;var j=f.closest(".scrollBox");if(j.length==0){j=$(window)}var k=e(f)-e(j);var m=0;if(j[0].id=="awardBox"){m=112}var g=f.outerHeight();var i=j.height();var l=j.scrollTop();if(k-d-m<0){j.scrollTop(l+k-d-m)}else{if(k+d+g-i>0){j.scrollTop(l+k+g-i+d)}}function e(h){var n=h.offset();if(n){return n.top}return 0}};c.bindEditEvent=function(e,f){e.on("click.skill",".skillLinkToShop",function(){linkToShop()});if(game.$$isOem){return}var d=function(){var g=Array.prototype.slice.apply(arguments);g[5]=f;c.showNoSupportTips.apply(c,g)};e.on("mouseover",".powerIcon",function(){$(this).parents(".verTipsBox").find('input[type="radio"]:disabled+label').eq(0).trigger("click.version")});e.on("click.version",'input[type="radio"]:disabled+label',function(){var l=$(this);var m=l.prev("input");var k=m.attr("_ver");var j=game.$$verInfo;if(!m.attr("disabled")||k===undefined||HdPortal.compareHdVer(j.authVer,k)){return}var i=j.map[k].name;var g=l.closest(".verTipsBox");var h=g.find(".powerIcon");switch(l.attr("for").replace(/\d*?$/,"")){case"noLimitNum":if(game.style==49||game.$$data.isNewVoteGame){if(game.$$createTime>g_data.compat_regTime){d(h,"不限参与人数为互动"+i+"功能",1)}else{d(h,"不限报名人数为互动"+i+"功能",1)}}else{if(game.style==71){d(h,"不限建团数量为互动"+i+"功能",1,6)}else{d(h,"不限参与人数为互动"+i+"功能",1,6)}}break;case"openFansOnly":if(game.style==69){d(h,"关注后报名为互动"+i+"功能",10,15)}else{d(h,"强制关注为互动"+i+"功能",10,15)}break;case"noLimitRegNum":if(game.$$createTime>g_data.compat_regTime){d(h,"不限参与人数为互动"+i+"功能",1)}else{d(h,"不限报名人数为互动"+i+"功能",1)}break;case"openAwardLinkNoDraw":d(h,"联系兑奖为互动"+i+"功能",3);break;case"openHelpShare":case"openHelpInvite":d(h,"好友助力为互动"+i+"功能",2,7);break;case"generateWxCard":d(h,"微信卡券为互动"+i+"功能",4);break;case"cusAwardCode":d(h,"生成券号为互动"+i+"功能",5,10);break;case"needlessCancel":d(h,"无需核销为互动"+i+"功能",0);break;case"autoCancel":d(h,"自助核销为互动"+i+"功能",0);break;case"openAwardLink":d(h,"联系兑奖为互动"+i+"功能",3);break;case"hideSkillSup":game.isOldSkill&&d(h,"广告为互动"+i+"功能",0);break;case"cuctomUnit":d(h,"分数单位为互动"+i+"功能",6,11);break;case"openSlide":d(h,"轮播获奖信息为互动"+i+"功能",8,21);break;case"someArea":d(h,"可"+(game.$$data.isNewVoteGame?"报名":"参与")+"地区为互动"+i+"功能",9,14);break;case"cusWxShareText":d(h,"分享内容为互动"+i+"功能",11,16);break;case"noLImitTime":d(h,"不限游戏时间为互动"+i+"功能",7,12);break;case"cuctomTime":d(h,"自定义游戏时间为互动"+i+"功能",7,12);break;case"hideSkill":game.isOldSkill&&d(h,"隐藏广告为互动"+i+"功能",0);break;case"selfSkill":game.isOldSkill&&d(h,"自定义广告为互动"+i+"功能",0);break;case"userDefined":var o=g.find(".name").text().trim().replace("：","");d(h,o+"为互动"+i+"功能",0,17);break;case"beforeJoinLink":case"beforeDrawLink":case"afterAwardLink":d(h,"联系信息为互动"+i+"功能",3,8);break;case"edit_selfAwardExp":d(h,"编辑奖品说明为互动"+i+"功能",13,18);break;case"oneAccessKey":case"publicAccessKey":case"cusText":d(h,"访问密钥为互动"+i+"功能",0,24);break;default:var n=l.attr("_info");if(n){d(h,n+"为互动"+i+"功能",l.attr("_src1"),l.attr("_src2"))}}})};c.checkAwardList=function(n){for(var j=0;j<n;j++){var l=awardList[j];var h=l.style;var f=l.awardtype;if(f==4){var e=d(h);if(e>10){$(".awardLevelItem").eq(j).click();return"奖项等级超过10个字，请修改后再保存"}var q=l.name;e=m(q);if(e>18){$(".awardLevelItem").eq(j).click();return"奖项名称超过9个汉字或18个字母，请修改后再保存"}var k=l.opti;e=m(k);if(e>32){$(".awardLevelItem").eq(j).click();return"操作提示超过16个汉字或32个字母，请修改后再保存"}var p=Date.parse(l.cbt);var r=Date.parse(l.cet);if(r<p){$(".awardLevelItem").eq(j).click();return"兑奖结束日期必须大于开始日期，请修改后再保存"}var g=l.stl;e=m(g);if(e>36){$(".awardLevelItem").eq(j).click();return"副标题超过18个汉字或36个字母，请修改后再保存"}var o=l.cashinfo;e=m(o);if(e>400){$(".awardLevelItem").eq(j).click();return"兑奖须知超过200个汉字或400个字母，请修改后再保存"}}else{var e=d(h);if(e>10){$(".awardLevelItem").eq(j).click();return"奖项等级超过10个字，请修改后再保存"}var q=l.name;e=d(q);if(e>24){$(".awardLevelItem").eq(j).click();return"奖项名称超过24个字，请修改后再保存"}var k=l.opti;e=d(k);if(e>32){$(".awardLevelItem").eq(j).click();return"操作提示超过32个字，请修改后再保存"}var p=Date.parse(l.cbt);var r=Date.parse(l.cet);if(r<p){$(".awardLevelItem").eq(j).click();return"兑奖结束日期必须大于开始日期，请修改后再保存"}var g=l.stl;e=d(g);if(e>36){$(".awardLevelItem").eq(j).click();return"副标题超过36个字，请修改后再保存"}var o=l.cashinfo;e=d(o);if(e>400){$(".awardLevelItem").eq(j).click();return"兑奖须知超过400个字，请修改后再保存"}}}function m(t){var s=0;if(!t){return}for(var i=0;i<t.length;i++){if(hdFai.isChinese(t.charAt(i))){s+=2}else{s++}}return s}function d(i){if(!i){return}return i.trim().length}};c.parsedGameArg=function(e,j,r,p){var o,v,u,m,d,l;if(e){if(typeof e==="string"){l=e;e=$$("#"+e);e.length===0&&(e=$$("."+l));if(e.length===0&&game.style!=48&&!game.$$isQmKj&&game.style!=67&&game.style!=71){if(!((l==="startBtnImg"||l==="titleImg"||l==="ruleImg")&&game.$$drawType==0)){HdPortal.hdShowMsg("error","自定义编辑数据错误，请重新检查",true)}return false}}var g=function(n,i){return i?{left:parsePxToRem(n.css("left")),top:parsePxToRem(n.css("top"))}:{width:parsePxToRem(n.width()),height:parsePxToRem(n.height())}};if(e.length>1&&game.style==65){o=[];e.each(function(i,n){if((m=$(n).closest(".ui-wrapper")).length==0){m=$(n)}o.push(g(m,true))});v=g(m)}else{if((m=e.closest(".ui-wrapper")).length==0){m=e}o=g(m,true);v=g(m)}if(p){var t=function(w,n,i){if(w&&$.isArray(w)){n=$.map(m,function(z,y){return g($(z),i)})}return n};o=t(p.pos,o,true);v=t(p.size,v,false)}o=$.toJSON(o);v=$.toJSON(v);u=getJqSrc(e)}if(j){u={};var h=false;if(j[0].indexOf("editTarget")!==-1){u=[];h=true}if(!r){r=j}for(var k=0,f=j.length;k<f;k++){var q=null;if(j[k] instanceof jQuery){q=j[k]}else{q=$$("#"+j[k]);if(q.length===0){q=$$("."+j[k])}}var s=q.attr("src");if(h){u[k]=getJqSrc(q)}else{u[r[k]]=getJqSrc(q)}}u=$.toJSON(u)}if(!o&&!v&&!u){HdPortal.hdShowMsg("error","自定义编辑数据错误，请重新检查",true);return false}return{pos:o,size:v,path:u}};(function(){c.getImgReplacementQuality=function(g){var r=[0,0];var m=getPreviewWin().HdGame.getModuleLayerImg();for(var n=0;n<m.length;++n){var o=m[n];if(f(o,g)){if(!d(o)){r[0]+=1}}else{if(o.selecter=="#resule-gift-sucImg"){var q=awardList;var k=gameDef._awardList;var p=game._setting.an;for(var l=0;l<p;++l){if(e(q[l].aimg)!=e(k[l].aimg)){r[1]+=1}}if(game._flag.f16){var h=q.length;if(e(q[h-1].aimg)!=e(k[h-1].aimg)){r[1]+=1}}}else{if(o.selecter.indexOf("advertising")>=0){if(game._flagB.f1048576&&!d(o)){r[1]+=1}}else{if(!d(o)){r[1]+=1}}}}}r[0]=r[0]?r[0]:0;r[1]=r[1]?r[1]:0;return r};function f(g,h){if(h=="55"){if(g.elem.closest(".gameBox").length>0||g.selecter=="#ruleImg"||g.selecter=="#titleImg"||g.selecter=="#homeBg"||g.selecter=="#"){return true}}else{if(h=="54"){if(g.elem.closest("#gameLayerBox").length>0){return false}}else{if(h=="48"){if(g.selecter=="#ruleImg"||g.selecter=="#titleImg"||g.selecter=="#homeBg"||g.selecter=="#startBtnImg"||g.elem.closest(".hd-imgMoveShow").length>0){return true}else{return false}}}}if(g.elem.closest(".home").length>0||g.selecter=="#ruleImg"||g.selecter=="#titleImg"||g.selecter=="#homeBg"||g.selecter=="#startBtnImg"){return true}if(g.edit){if(g.edit.closest(".home").length>0){return true}}return false}function e(g){if(g.indexOf("?v=")>=0){var h=g.indexOf("?v=");g=g.substr(0,h)}return g}function d(h){var g=true;var i=$(h.elem[0]);var j=h.defSrc;j=e(j);if(i.attr("src")&&i.attr("src").indexOf("//")>=0){g=i.attr("src").indexOf(j)>=0;return g}if(i.css("backgroundImage")&&i.css("backgroundImage").indexOf("//")>=0){g=i.css("backgroundImage").indexOf(j)>=0;return g}if(i.val()&&i.val().indexOf("//")){g=i.val().indexOf(j)>=0;return g}return g}})();c.getEditPoup=function(){var d=HdPortal.getEditPoup.apply(HdPortal,arguments);if(!d._editReady){d._editReady=true;d.on("ready",function(){d.box.addClass("version3");d.box.on("poup_show",function(e){e.stopPropagation();getPreviewWin().HdGame.removeAllEditLayer()}).on("poup_hide",function(e){e.stopPropagation();d.win().HdPortal.hoverTipsBox.hide()});c.bindEditEvent(d.box,d.win())})}return d};c.editPoup=c.getEditPoup("edit");(function(){c.initEditImgLine=function(j){j=$.extend({win:null,arg:null,index:0,warp:null,},j);var v=j.arg;if(v.hide){return}var t=$$(v.from);var s=getJqSrc(t);var k=t[0]?t[0].id:"";if(k=="resule-gift-sucImg"){s=game._awardList[j.index].aimg}var q="";if(["theGetPricePic","theGetPricePicTwo","theGetPricePicThree"].contains(k)){q='<div class="theSpecialHtmler tipsColor">';q+='<span style="display: inline-block;width:25px;vertical-align: top;">注：</span><span style="display: inline-block;width: 395px;">1.请勿上传涉及诱导分享、诱导关注等违反微信朋友圈管理规定的图片信息，否则有可能被微信拉黑朋友圈仅自己可见！<br/>';q+="2.请勿在没中奖页设置中奖信息，当用户已达到最多中奖次数和奖品数量为零时再抽奖会显示没中奖页！</span>";q+="</div>"}if(v&&"谢谢参与".indexOf(v.title)>=0){q+='<div class="theSpecialHtmler tipsColor">';q+="注：请勿把谢谢参与设置为奖品图片，当用户已达到最多中奖次数和奖品数量为零时再抽奖会显示谢谢参与！";q+="</div>"}var i=v.hasOwnProperty("showPath");var p=j.win.$('<div class="editLine uploadLine '+(i?"":"commonImg")+'"><div class="title item">'+v.title+"：</div>"+(!i?"":('<input id="hideEditImg'+j.index+'" class="hideEditImg" type="radio" name="isShowEditImg'+j.index+'" checked><label for="hideEditImg'+j.index+'">隐藏</label><input id="showEditImg'+j.index+'" class="showEditImg" type="radio" name="isShowEditImg'+j.index+'" ><label for="showEditImg'+j.index+'">显示</label>'))+'<div class="content '+(i?"mgbox":"item")+'"><div class="imgBox item"><img id="uploadImg-'+j.index+'" class="img" src="'+s+'" onload="hdFai.Img.optimize(this, {width:80, height:80, mode:hdFai.Img.MODE_SCALE_FILL});"/></div><div class="btnBox item"><span id="uploadBtn-'+j.index+'" class="selectbtn"></span><div class="recoveryBtn main-Button-blue">恢复默认</div></div>'+(i?'<span class="hoverIcon rightIcon"></span>':"")+"</div>"+(!i?'<span class="hoverIcon rightIcon"></span>':"")+"</div>"+q);j.warp&&j.warp.append(p);var o="down";var l=function(){return'图片像素建议为 <span class="uploadSize-'+j.index+'" style="color:#64cea6" >'+(v.defSize||v.size||"--px*--px")+"</span><br>格式为jpg\\bmp\\png\\gif"};if(v.title=="背景图片"){l=function(){return'<div class="imgBox"><div class="img"></div></div><div class="textBox"><div class="explainBox first"><div class="explainTitle">主要区域</div><div class="explainContent">背景图片的主要展示区域高度为<span>1136px</span></div></div><div class="explainBox second"><div class="explainTitle">适配区域</div><div class="explainContent">少部分手机屏幕高度会超过主要区域，需预留一定空间进行适配</div></div><a href="'+HdPortal.resRoot+'/version2/image/pictureRule.jpg" class="downloadNorm" download target="_blank">下载图片规范</a></div><div class="bottomBox"><div class="bottomText">图片像素建议为<span class="uploadSize-'+j.index+'" style="color:#74b7e6">'+(v.defSize||v.size||"--px*--px")+'</span></div><div class="bottomText">格式为jpg\\bmp\\png\\gif</div></div>'};o+=" bgImgBox"}j.win.HdPortal.hoverTipsBox.link({agent:p.find(".rightIcon"),time:100},o,l,{html:true},"right");!v.defSize&&HdPortal.imgReady(v.defSrc.replace(/!\d+?x\d+?(.\w+)$/,"$1"),function(){if(this.width==640&&this.height>1600){this.height=1600}v.defSize=this.width+"px*"+this.height+"px";$("#uploadSize-"+j.index).html(v.defSize)});if(c.getImgName(v.defSrc)!==c.getImgName(s)){p.find(".recoveryBtn").css("display","inline-block")}p.find(".recoveryBtn").click(function(w){c.recoveryImg(this,v.defSrc,p.find("#uploadImg-"+j.index),t);changeIsSave()});c.createHtml5Upload({groupId:0,uploadImg:p.find("#uploadImg-"+j.index),uploadBtn:p.find("#uploadBtn-"+j.index),from:v.from,limit:v.limit,onSuccess:function(w){if(t.length<=0){return}if(t.attr("id")=="resule-gift-sucImg"){$$("#resule-gift-sucImg").data("theImgUploadIndex",j.index)}t.hdTrigger("hd-editUpload-success",[w,j.index]);j.onSuccess&&j.onSuccess(w)},showProgress:true,});if(i){var n=p.find(".showEditImg");var m=p.find(".hideEditImg");var r=p.find(".content");var u=function(w){r.toggle(w!==0);if(v.showPath[v.showPathIndex]!=w){changeIsSave()}v.showPath[v.showPathIndex]=w;t.each(function(){var y=$(this);if(w!==0){if(/img/i.test(this.nodeName)){if(!y.attr("src")&&y.attr("edit_store_src")){y.attr("src",y.attr("edit_store_src"))}y.show()}else{if(!/input/i.test(this.nodeName)){var z=y.attr("edit_store_src");if(z){setJqSrc(y,z,z===y.data("edit_laststore_src"));y.removeAttr("edit_store_src").removeData("edit_laststore_src")}}}}else{if(/img/i.test(this.nodeName)){y.hide()}else{if(!/input/i.test(this.nodeName)){var A=getJqSrc(y);y.attr("edit_store_src",A).data("edit_laststore_src",A);$(this).css("background-image","none")}}}})};n.on("click",function(){u(1)});m.on("click",function(){u(0)});setTimeout(function(){if(v.showPath[v.showPathIndex]!==0){n.attr("checked","checked").click()}else{m.attr("checked","checked").click()}},10)}return p};c.initEditImgLineTitle=function(i,m){var l=i.getWarp("info");var k=HdPortal.syncOuterWidth(l.find(".editLine .title"));l.find(".editLine>.mgbox").css("margin-left",k);var j=k-130+(hdFai.isChrome()?4:16);if(j>0){i.box.css("width",i.box.width()+j+"px");!m&&i.box.one("poup_close",function(n){i.box.css("width","")})}};c.showEditByGame=function(j,o,m){var p=this;if(j==-1){c.editPoup.show({className:"upload",title:"编辑图片",info:function(s,r,t){$.each(m,function(v,u){c.initEditImgLine({win:t,arg:u,index:v,warp:s,})});setTimeout(function(){c.initEditImgLineTitle(r)},50);$$(p).hdTrigger("hd-editUpload-imgEdit",[r,m])},});return}if(j==-4){var n=getPreviewWin().hg.sound.list;var q=getPreviewWin().hg.sound.listDef;var l="游戏设置";c.editPoup.show({title:l,info:function(v,r,w){var s="<div>";var u=game.$$isHaveTimeSetting;n&&$.each(n,function(z,B){var A=q[z];s+='<div class="editLine forMusicBox"><div class="mainLine verTipsBox"><div class="title item"><span class="powerIcon flag '+game.$$verInfo.byClass+'"></span><span class="name">'+A.fileName.split(".")[0]+'：</span></div><div class="content item"><input type="radio" id="defaultSound'+z+'" name="loadingStyle'+z+'" _isDef=true checked /><label for="defaultSound'+z+'">默认</label><input type="radio" id="closeSound'+z+'" name="loadingStyle'+z+'" /><label for="closeSound'+z+'">关闭</label><input id="userDefined'+z+'" class="js_ver" _ver="'+HdPortal.hdVer.BY+'" type="radio" name="loadingStyle'+z+'" /><label for="userDefined'+z+'">自定义</label></div></div><div class="detailsLine" style="margin-left:118px;"><div class="title item"><span class="musicName" title="'+B.fileName+'">'+B.fileName+'</span></div><input type="hidden" class="musicPath" value="'+B.path+'"><input type="hidden" class="musicDefPath" value="'+A.path+'"><div class="btnBox item"><span id="uploadBtn-'+z+'" class="selectbtn"></span></div></div></div><div class="cutLine"></div>'});if(u&&!game.$$isQuestionGame){var t=game.style==53?"记忆":"游戏";s+='<div class="editLine verTipsBox"><span class="title item"><span class="powerIcon '+game.$$verInfo.byClass+' flag"></span><span class="name">'+t+'时间：</span></span><input type="radio" id="dafeultTime" ng-model="game._setting.gametimetype" ng-value=::1 name="seGameTime" /><label for="dafeultTime">默认</label>';if(game.$$gameTimeType!=2){s+='<input class="js_ver" _ver="1" type="radio" id="noLImitTime" ng-model="game._setting.gametimetype" ng-value=::2 name="seGameTime"/><label for="noLImitTime">不限</label>'}s+='<input class="js_ver" _ver="1" type="radio" id="cuctomTime" ng-model="game._setting.gametimetype" ng-value=::3 name="seGameTime""/><label for="cuctomTime">自定义</label><span id="gameTimeTxt" ed-show="game._setting.gametimetype == 3"><input id="setTimesLimit" class="minInput onlyNum" ng-model="game._setting.gametimenum" model-format="int" ng-blur="gametimenumBlur()" maxlength="3" type="text" />秒</span></div><div class="cutLine"></div>'}if(game.$$isHaveScore){s+='<div class="editLine verTipsBox"><span class="title item"><span class="powerIcon '+game.$$verInfo.byClass+' flag"></span><span class="name">分数单位：</span></span><input type="radio" id="defaultUnit" ng-model="game._setting.$customUnit" ng-value=false name="cuctomUnit" checked/><label for="defaultUnit">默认</label><input class="js_ver" _ver="1" type="radio" id="cuctomUnit" ng-model="game._setting.$customUnit" ng-value=true name="cuctomUnit"/><label for="cuctomUnit">自定义</label><span id="gameUnit" ng-show="game._setting.$customUnit">分数以<input id="setGameUnit" class="minInput" maxlength="3" ng-model="game._setting.gameunit" type="text"/>为单位<span class="hd_theScore_SetTips hoverIcon rightIcon"></span></span></div><div class="cutLine"></div>'}s+="</div>";function y(){var z=v.find(".editLine");n&&$.each(n,function(B,D){var E=z.eq(B);var C=B===0?0:2;if(D.optFlag===C){var A=q[B];D.path=A.path;D.fileName=A.fileName}else{D.path=E.find(".musicPath").val();D.fileName=E.find(".musicName").html()}})}c.compileHtml(s,["$element","$scope","$newWatch",function(A,B,E){v.append(A);var D=120;w.HdPortal.hoverTipsBox.link(A.find(".hd_theScore_SetTips"),"down","开启自定义后，可根据自身活动的需求来更改分数单位。例如：100分可以改成100金币",null,"center");if(u&&!game.$$isQuestionGame){E("game._setting.gametimetype",function(H,G){var F=H==3||(H==1&&gameDef._setting.gametimenum!=0);if(F){B.$safeApply(function(){game._setting.gametimenum=H==3?game.$$_lasGameTimeNum:gameDef._setting.gametimenum})}if(G==3&&G!=H){ERR.removeErr(top.$("#setTimesLimit"))}$$(function(){$$(".timeBox").toggle(F)})});B.gametimenumBlur=function(){if(isNaN(game._setting.gametimenum)){B.$safeApply(function(){game._setting.gametimenum=5})}}}if(game.$$isHaveScore){var C=game._setting.gameunit;var z=A.find("#setGameUnit");E("game._setting.gameunit",function(G,F){if(G===F){return}if($.trim(G).length==0){ERR.addErr(z,"分数单位不能为空",null,"margin-left:"+D+"px");return"$old"}ERR.removeErr(z);if(game._setting.$customUnit){C=game._setting.gameunit}$$(function(){$$(".gameScoreUnit,.scoreUnit,.result-scoreUnit").text(G)})})();E("game._setting.$customUnit",function(G,F){if(G){game._setting.gameunit=C}else{game._setting.gameunit=gameDef._setting.gameunit}})}r.box.data("editClose",function(){y();if(ERR.hasErr(A)){HdPortal.hdShowMsg("error","尚有信息未填写或填写错误,请先填写或修改");return false}B.$destroy()});setTimeout(function(){D=HdPortal.syncOuterWidth(v.find(".verTipsBox .title"));var F=D-130+(hdFai.isChrome()?4:16);if(F>0){r.box.css("width",r.box.width()+F)}HdPortal.syncOuterWidth(v.find(".detailsLine .title"));var G=v.find(".editLine");n&&$.each(n,function(I,K){var L=G.eq(I);var H=L.find(".detailsLine");c.createHtml5Upload({groupId:0,uploadBtn:L.find("#uploadBtn-"+I),from:"forMusic",limit:I===0?1000:50,showProgress:true,progressBox:H,});w.HdPortal.hoverTipsBox.link({agent:L.find(".selectbtn .uploadify-button"),target:L.find(".detailsLine .title"),time:100},"up",(I===0?"大小在1M以内，格式为mp3\\wav":'音效时间长短建议为 <span style="color: #258426;">1秒</span><br>大小在50k以内，格式为mp3\\wav')+'<a href="'+(game.$$isOem?"http://www.webportal.cc/sys/view.jsp?id=408":"http://hd."+HdPortal.HomeHost+"/news/2285")+'" target="_blank" style="text-decoration:underline;">如何制作音乐?</a>',{html:true},"center");var J=I===0?0:2;H.css("margin-left",D);$.each(["defaultSound","closeSound","userDefined"],function(N,P){var O=N+J,M=L.find("#"+P+I);M.click(function(Q){if(K.optFlag!=O){changeIsSave()}K.optFlag=O;H.toggle(P=="userDefined");if(I===0){$$(".soundIcon").toggle(P!="closeSound").toggleClass("soundIconHide",P=="closeSound")}});if(K.optFlag===O){M.attr("checked","checked").click()}})});setBuyInput(v.find(".js_ver"))},50)}])},});return}if(j==-5){c.editPoup.show({title:"编辑背景",info:function(t,s,u){var r=m[0];c.Css.initCssLine({win:u,arg:r._cssArg[0],index:0,warp:t,});c.initEditImgLine({win:u,arg:r,index:0,warp:t,});t.find(".editLine.uploadLine").css("padding",0);setTimeout(function(){t.find(".editLine>.mgbox").css("margin-left",HdPortal.syncOuterWidth(t.find(".editLine .title")))},50)},});return}if(j===-6){c.editPoup.show({title:"编辑弹窗标题",info:function(t,r,u){var s='<div id="editAccessKeyPopupTitle" class="editLine"><div class="mainLine verTipsBox"><div class="title item" style="vertical-align:top;"><span class="powerIcon flag '+game.$$verInfo.bjClass+'"></span><span class="name">弹窗标题：</span></div><div class="content item"><input id="defaultText" ng-model="game._flagC.f4096" ng-value="false" type="radio" name="accessKeyRadio"  _isDef /><label for="defaultText">默认</label><input id="cusText" class="js_ver" _ver="'+HdPortal.hdVer.BJ+'" ng-model="game._flagC.f4096" ng-value="true" type="radio" name="accessKeyRadio"/><label for="cusText">自定义</label><div style="margin-top:10px;" ng-show="game._flagC.f4096"><div><input id="editInput" type="text" ng-model="game._setting.accesspopuptitle" style="width:350px" /><div></div></div></div></div>';c.compileHtml(s,["$element","$scope","$newWatch",function(v,y,z){t.html(v);var w=t.find("#editInput");setBuyInput(t.find(".js_ver"));r.box.on("poup_hide",function(){if(ERR.hasErr(w.parents(".mainLine"),true)){ERR.removeErr(w)}});z("game._flagC.f4096",function(B,A){if(B===A){return}if(!B){ERR.removeErr(w);$$("#accessKeyPopupTitle").text(gameDef._setting.accesspopuptitle)}else{$$("#accessKeyPopupTitle").text(game._setting.accesspopuptitle)}});z("game._setting.accesspopuptitle",function(B,A){if(B==A){return}if(!game._flagC.f4096){return"$def"}else{if(B.trim()!==""){$$("#accessKeyPopupTitle").text(B);ERR.removeErr(w)}else{ERR.addErr(w,"自定义弹窗标题不能为空",$());return"$old"}}})()}])},});return}if(j===-7){c.editPoup.show({className:"advertising",title:"广告页设置",info:function(t,r,u){var s='<div id="editAdvertisingPopup" class="editLine"><div class="advertisingSetting editLine uploadLine"><div class="title item"><span class="name">是否限时：</span></div><div class="content item"><input type="radio" ng-model="game._flagC.f134217728" ng-value="false" id="limitAdvertisingTime" /><label for="limitAdvertisingTime">是</label><span ng-show="!game._flagC.f134217728" style="margin-right: 20px;"><input id="advertisingTime" type="text" ng-model="game._setting.advertisingTime" maxlength="3" model-format="int" class="input inputNum onlyNum minInput" />  秒</span><input type="radio" ng-model="game._flagC.f134217728" ng-value="true" id="notLimitAdvertisingTime" /><label for="notLimitAdvertisingTime">否</label></div><div ng-show="game._flagC.f134217728" style="margin-left: 100px;" class="tipsColor">选择“否”时只有点击“跳过”按钮，才可以跳过广告页</div></div><div class="advertisingSetting editLine uploadLine" ng-show="!game._flagC.f134217728"><div class="title item"><span class="name">强制观看：</span></div><div class="content item"><input type="radio" ng-model="game._flagC.f268435456" ng-value="false" id="notForceAdvertising" /><label for="notForceAdvertising">关闭</label><input type="radio" ng-model="game._flagC.f268435456" ng-value="true" id="forceAdvertising" /><label for="forceAdvertising">开启</label></div><div ng-show="game._flagC.f268435456" style="margin-left: 100px;" class="tipsColor">开启后只能等待广告展示完毕，无法点击“跳过”按钮跳过广告</div></div><div class="advertisingSetting editLine uploadLine"><div class="title item"><span class="name">展示方式：</span></div><div class="content item"><input type="radio" ng-model="game._setting.advertisingDisplayModel" ng-value="1" id="randomDisplayModel" /><label for="randomDisplayModel">随机展示</label><input type="radio" ng-model="game._setting.advertisingDisplayModel" ng-value="0" id="orderDisplayModel" /><label for="orderDisplayModel">轮播展示</label></div><div ng-show="game._setting.advertisingDisplayModel === 1" style="margin-left: 100px;" class="tipsColor">随机展示：随机选取一张广告页进行展示</div><div ng-show="game._setting.advertisingDisplayModel === 0" style="margin-left: 100px;" class="tipsColor">轮播展示：展示全部广告页，可左右滑动切换</div></div><div class="editLine uploadLine"><div class="title item"><span class="name">广告页数量：</span></div><div class="content item"><div class="advertisingDropdownBox dropDownBox_main"><div ng-click="showDropdown = !showDropdown"><div class="txt" style="width: 60px;" ng-bind="game._setting.advertisingNumber"></div><span class="icon dropDownArrow"></span></div><div class="dropDownBox_sub" ng-show="showDropdown"><div class="options" ng-click="setDropdownValue(1)">1</div><div class="options" ng-click="setDropdownValue(2)">2</div><div class="options" ng-click="setDropdownValue(3)">3</div><div class="options" ng-click="setDropdownValue(4)">4</div></div></div></div></div><div class="advertisingUploadFileBox" style="overflow: hidden;"></div></div>';c.compileHtml(s,["$element","$scope","$newWatch",function(D,C,z){t.html(D);var E=D.find(".advertisingUploadFileBox");var y=D.find("#advertisingTime");var A=y.parents(".advertisingSetting");var w=window.getPreviewWin().hg;var v=game._setting.advertisingTime;C.showDropdown=false;C.setDropdownValue=function B(F){C.showDropdown=false;if(game._setting.advertisingNumber===F){return}E.css("height",F*102+"px");w.fire("advertisingSetting","changeNumberOrModel",game._setting.advertisingDisplayModel,F,game._setting.advertisingNumber);game._setting.advertisingNumber=F};E.css("height",game._setting.advertisingNumber*102+"px");m.forEach(function(F,G){c.initEditImgLine({win:u,arg:F,index:G,warp:E})});r.box.on("click",function(F){if($(F.target).parents(".advertisingDropdownBox").length===0){C.$safeApply(function(){C.showDropdown=false})}});z("game._flagC.f134217728",function(G,F){if(G===F){return}if(G){game._setting.advertisingTime=v}w.fire("advertisingSetting","changeForce",game._flagC.f268435456,!G);w.fire("advertisingSetting","changeTime",!G?game._setting.advertisingTime:"")});z("game._setting.advertisingTime",function(G,F){if(G===F){return}if(G>=1&&G<=30){if(!game._flagC.f134217728){w.fire("advertisingSetting","changeTime",G)}ERR.removeErr(y);v=G;r.box.data("editClose",function(){return true})}else{r.box.data("editClose",function(){HdPortal.hdShowMsg("error","尚有信息未填写或填写错误,请先填写或修改");return false});ERR.addErr(y,"请输入数字1-30",A,"position: absolute; top: 42px; left: 0;");return"$old"}})();z("game._flagC.f268435456",function(G,F){if(G===F){return}w.fire("advertisingSetting","changeForce",G,!game._flagC.f134217728)});z("game._setting.advertisingDisplayModel",function(G,F){if(G===F){return}w.fire("advertisingSetting","changeNumberOrModel",G,game._setting.advertisingNumber)})}])}});return}if(j==-8){var i=o.replace(/editTarget-|editRelate-/,"");var k={selectName:(i!="homeBanner"?"banner数量：":"活动banner数量："),prop:i,imgArgs:(m||[])};d(k);return}e.call(this,o,j)};function e(n,l){var m=c.getInjector();if(l!=999&&typeof n==="function"){n.call(this,m);return}var k=$(".checkBorder");var o;var p=["explain","awardCusBtn","servicePhone","jumptoHostInfo","timelimitLine","noticeLine"];if($.inArray(n,p)>-1){var j=n=="explain"?"$base_hight_set":"$award_hight_set";c.rootSafeApply(function(){game[j]=true})}if(l==999){if(typeof n==="function"){o=n.call(this,m)}else{o=$(n)}}else{if(n=="joinNum"||n=="editTarget-joinInfo"){o=$("#joinNumBox");if(g_isRegistration){o=$("#regNumBox")}}else{if(n=="editTarget-joinGroupLine"||n=="editTarget-joinGroupDetail"){o=$("#joinNumBox");if(g_isRegistration){o=$("#regNumBox")}}else{if(n=="editTarget-groupInfo"){o=$("#awardAmountSetting,#comAwardAmountSetting")}else{if(n=="editTarget-fullGroupInfo"){o=$("#groupMemberAmountBox")}else{if(n=="logoImg"){o=$("#uploadLogoWrap")}else{if(n=="gameTime"){o=$("#setGameTimeBox")}else{if(n=="awardSetting"){f()}else{if(n==="explain"){o=$("#activeExplain").parents(".settingLine")}else{if(n==="actName"){o=$("#actNameSetting")}else{if(n==="drawInfo"||n==="editTarget-drawInfo"){if($("#drawTimesSettingBox #setDrawTotalBox").css("display")=="none"){o=$("#drawTimesSettingBox #dayDrawTimes")}else{o=$("#drawTimesSettingBox")}}else{if(n==="editTarget-playInfo"){if($("#playTimesSettingBox #setDrawTotalBox").css("display")=="none"){o=$("#playTimesSettingBox .dayPlayTimes")}else{o=$("#playTimesSettingBox")}}else{if(n==="hostLine"){o=$(".hostNameWrap");if(game.$$verInfo.realVer!=HdPortal.hdVer.MD&&game.createTime>1527004799000){HdPortal.hdShowMsg("error","要编辑主办单位，请到个人中心的企业信息进行修改");return}else{if(!game.$base_compay_set){$(".hd_company_info .seniorSetBoxOption").click()}}}else{if(n==="skillLine"){g(m)}else{if(n==="rankBox"){h(m)}else{if(n==="minscore"){o=$("#drawConditionBox")}else{if(n==="menuBtn"){o=$("#menuBoxWrap")}else{var i=$(".awardSettingBox").eq(game.$checkeIndex);if(n=="awardName"){o=i.find(".awardDescribeBox")}else{if(n=="awardTime"){o=i.find(".setCodeTimeBox")}else{if(n=="awardSubTitle"){o=i.find(".setAwardSubTitleBox")}else{if(n=="codeOptInfo"){o=i.find(".setAwardOptInfoBox")}else{if(n=="awardCusText"){o=i.find(".setAwardTextBox")}else{if(n=="awardCusBtn"){o=i.find(".setAwardBtnBox")}else{if(n=="bottomCusBtn"&&game.$$afterWxCard&&game.$cAward.$type.btn){o=i.find(".setAwardCashSiteBox")}else{if(n=="setAwardImage"){o=i.find(".setAwardImageBox")}else{if(n=="codeImg"){o=i.find(".setAwardQRCodeBox")}else{if(n=="servicePhone"){o=i.find(".setServicePhoneBox")}else{if(n=="jumptoHostInfo"){o=i.find(".openHostInfoBox")}else{if(n=="timelimitLine"){o=i.find(".setAwardTimeLimitBox")}else{if(n=="addressLine"){o=i.find(".setAwardCashSiteBox")}else{if(n=="noticeLine"){o=i.find(".setCashInfoBox")}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}if(o){l=o.closest(".settingBox").attr("option")}game.$tabSetting.select(l);if(typeof o==="undefined"){return}c.scrollView(o);if(o[0]===k[0]){return}k.removeClass("checkBorder");if(o.hasClass("checkBorder")){return}o.one("mouseover",function(){o.removeClass("checkBorder")}).addClass("checkBorder")}function d(i){if(!i.prop){return}if(game._setting[i.prop]==null){game._setting[i.prop]={bannerNumber:1,bannerAutoplay:true,$$number:1}}var q=game._setting[i.prop];game._setting[i.prop].$$number||(game._setting[i.prop].$$number=q.bannerNumber);var p=game._setting[i.prop].$$number;var r=passAuthVer(HdPortal.hdVer.BJ,false,false);var m=i.selectName||"活动banner数量";var l=(i.imgArgs&&i.imgArgs.length)||10;var s=i.prop=="homeBanner"?30:(i.prop=="shopBanner"?31:0);var o=window.getPreviewWin().hg;var j=!r&&game.$$isOem&&p==1;var k=!r&&!game.$$isPublish;var n=!r&&game.$$isPublish&&p==1;c.editPoup.show({className:"upload",title:"编辑图片",info:function(v,t,w){var u='<div class="swiperBannerBox editLine"><div class="editLine uploadLine verTipsBox"><div class="title item"><span class="powerIcon flag '+game.$$verInfo.bjClass+'"></span><span class="name">'+m+'</span></div><div class="content item"><div class="dropDownBox_main'+(j||k||n?" dropdownBoxDisabled":"")+'" ng-click="handleDropDownClick()"><div><div class="txt" ng-bind="bannerNumber"></div><span class="icon dropDownArrow"></span></div><div class="dropDownBox_sub" ng-style="dropdownStyle" ng-show="showDropdown"><div class="options" ng-repeat="i in maxLengthArray track by $index" ng-class="{ dropdownBoxDisabled: ($index != 0 && '+(!r&&game.$$isPublish)+') }"  ng-click="setDropdownValue($event, $index + 1)">{{ $index + 1 }}</div></div></div></div></div><div class="cutLine"></div><div class="editLine uploadLine" ng-show="bannerNumber > 1"><div class="title item"><span class="name">自动轮播：</span></div><div class="content item"><input type="radio" id="openAutoPlay" ng-model="bannerAutoplay" ng-value="true" /><label for="openAutoPlay">开启</label><input type="radio" id="closeAutoPlay" ng-model="bannerAutoplay" ng-value="false" /><label for="closeAutoPlay">关闭</label></div></div><div class="cutLine" ng-show="bannerNumber > 1"></div><div class="uploadImgBox" ng-style="uploadImgBoxStyle"></div></div>';c.compileHtml(u,["$element","$scope","$newWatch",function(z,B,E){v.html(z);var C=z.find(".uploadImgBox");var A=v.find(".powerIcon");t.box.off("click").on("click",function(G){B.$safeApply(function(){var H=!!$(G.target).parents(".dropDownBox_main").length;if(H){return}B.showDropdown=H})});B.maxLengthArray=Array(l);B.bannerAutoplay=q.bannerAutoplay;B.bannerNumber=q.bannerNumber;B.dropdownStyle={height:"auto"};B.uploadImgBoxStyle={height:q.bannerNumber*102+"px"};B.showDropdown=false;B.setDropdownStyle=function D(G){if(G==1){B.dropdownStyle.height="146px"}else{if(G==2){B.dropdownStyle.height="286px"}else{B.dropdownStyle.height="auto"}}};B.setDropdownStyle(B.bannerNumber);B.setDropdownValue=function F(G,H){if(j||!r&&game.$$isPublish&&H!=1||B.bannerNumber===H){return}G&&G.stopPropagation();B.setDropdownStyle(H);B.showDropdown=false;B.bannerNumber=q.bannerNumber=H;B.uploadImgBoxStyle.height=H*102+"px";o.fire("bannerNumberChange",i.prop,H)};B.handleDropDownClick=function y(){if(j){return}if(!game.$$isOem&&k||n){c.showNoSupportTips(A,"活动 banner 数量设置为互动铂金版功能",s,s,"",top.window);return}B.showDropdown=!B.showDropdown};A.on("mouseover",function(){if(j){return}if(!game.$$isOem&&k||n){c.showNoSupportTips(A,"活动 banner 数量设置为互动铂金版功能",s,s,"",top.window)}});B.$watch("bannerAutoplay",function(H,G){if(H==G){return}q.bannerAutoplay=H});$.each(i.imgArgs,function(H,G){c.initEditImgLine({win:w,arg:G,index:H,warp:C,})});setTimeout(function(){c.initEditImgLineTitle(t)},50)}])}})}function f(){c.editPoup.show({title:"编辑奖品说明",info:function(j,i,k){c.compileHtml('<div class="editLine"><div class="mainLine verTipsBox"><span class="title"><span class="powerIcon '+game.$$verInfo.byClass+' flag"></span>编辑奖品说明：</span><span class="content"><input id="edit_defAwardExp" ng-model="game._flag.f256" ng-value=false type="radio" name="awardExplain" checked><label for="edit_defAwardExp">默认</label><input id="edit_selfAwardExp" ng-model="game._flag.f256" ng-value=true class="js_ver" _ver="'+HdPortal.hdVer.BY+'" type="radio" name="awardExplain"><label for="edit_selfAwardExp">自定义</label></span></div><div class="detailsLine" ed-show="game._flag.f256" style="margin: 10px 0px 9px 145px;" ><textarea class="awardExpInput" style="width: 320px;height: 135px;line-height: 18px;padding: 5px;border: 1px solid #C8C8C8;" ng-model="game._setting.ae" ng-trim="false" placeholder="自定义编辑你的奖品说明"></textarea></div></div>',["$element","$scope","$newWatch",function(l,m,q){j.append(l);i.box.data("editClose",function(){if($.trim(game._setting.ae).length==0){m.$safeApply(function(){game._flag.f256=false})}else{if(ERR.hasErr(l)){return false}}if(n(game._setting.ae)){game._setting.ae=p}m.$destroy()});q("game._flag.f256",function(s,r){$$(function(){$$("#awardLineBox").toggle(!s);$$("#selfAwardLine").toggle(s)})});var o=false,p=game._setting.ae;q("game._setting.ae",function(s,r){if(s===r){return}o=true;if(n(s)){return"$def"}p=s;$$(function(){$$("#selfAwardLine").html("<pre style=\"font-family:'微软雅黑';\">"+hdFai.encodeHtml(s)+"</pre>")})})();function n(t){var r=l.find(".awardExpInput");if(game.$$createTime>1476189000000){var s=HdPortal.checkSensitword(r);if(s){ERR.addErr(r,"存在微信敏感词"+s.sensword+"，建议修改为"+s.replaceWord,l,"margin:0;","$sef");return true}}if(o&&$.trim(game._setting.ae).length==0){ERR.addErr(r,"奖品说明不能为空",l,"margin:0","$sef");return true}ERR.removeErr(r);return false}setBuyInput(l.find(".js_ver"))}])}})}function h(i){c.editPoup.show({title:"编辑排行榜",info:function(k,j,l){c.compileHtml('<div class="editLine"><span class="title"> 排行榜显示玩家数量：</span><span class="content"><input id="edit_defaultRank" ng-model="game._setting.rankshowtype" ng-value=::1 type="radio" name="rankNumber"><label for="edit_defaultRank">默认</label><input id="edit_selfRank" ng-model="game._setting.rankshowtype" ng-value=::2 type="radio" name="rankNumber"><label for="edit_selfRank" style="margin-right:0">自定义显示</label><span ed-show="game._setting.rankshowtype == 2"><input class="selfRankLimit onlyNum minInput" ng-model="game._setting.rankshownum" model-format="int" maxlength="4" type="text">名</span></span></div>',["$element","$scope","$newWatch",function(m,n,q){k.append(m);var p=game._setting.rankshownum;j.box.data("editClose",function(){if(ERR.hasErr(m)){return false}if(o(game._setting.rankshownum)){game._setting.rankshownum=p}$$("#rankInfoBox tr.rankInfo").each(function(r){$(this).toggle(r<game._setting.rankshownum)});n.$destroy()});q("game._setting.rankshowtype",function(s,r){if(s==r){return}if(s==1){game._setting.rankshownum=100}else{game._setting.rankshownum=p}});q("game._setting.rankshownum",function(s,r){if(s==r){return}if(o(s)){return"$def"}game._setting.rankshowtype!=1&&(p=s);$$(function(){$$("#showRankNum").text(s)})})();function o(r){var s=m.find(".selfRankLimit");if($.trim(r).length==0){ERR.addErr(s,"输入不能为空",m,"margin-left:145px");return true}if(r<10||r>5000){ERR.addErr(s,"请输入10-5000之间的数字",m,"margin-left:145px");return true}ERR.removeErr(s);return false}}])},})}function g(i){c.editPoup.show({title:"编辑广告",info:function(k,j,l){c.compileHtml('<div class="verTipsBox editLine"><div class="mainLine"><span class="title"><span class="powerIcon flag" ng-class="::game.isOldSkill?game.$$verInfo.bjClass:\'\'"></span>{{::game.$$isOem?"技术支持":"广告"}}：</span><span class="content"><input id="edit_defaultSkill" ng-model="game._setting.skillsptype" ng-value=::2 class="" type="radio" name="skillSupport"><label for="edit_defaultSkill">默认</label><input id="edit_hideSkill" ng-model="game._setting.skillsptype" ng-value=::1 ng-disabled="unBuySkill" ng-class="::{js_ver:game.isOldSkill}" _ver="'+HdPortal.hdVer.BJ+'" type="radio" name="skillSupport"><label for="edit_hideSkill">隐藏</label><input id="edit_selfSkill" ng-model="game._setting.skillsptype" ng-value=::3 ng-disabled="unBuySkill" ng-class="::{js_ver:game.isOldSkill}" _ver="'+HdPortal.hdVer.BJ+'" type="radio" name="skillSupport" ><label for="edit_selfSkill">自定义</label></span></div><div ng-show="unBuySkill" class="tipsColor" style="margin-left:91px;">隐藏或自定义广告<span  ng-bind-html="::game.$$skillMsg|to_trusted"></sapn></div><div ed-show="!unBuySkill && game._setting.skillsptype == 3" class="detailsLine" style="margin-left:90px;"><div><span class="title"><span class="flag14">*</span>单位名称：</span><input class="skillName input" ng-model="game._setting.skn" type="text" style="width:275px;"></div><div style="margin-top:15px"><span class="title"><span class="flag14">&nbsp;</span>链接地址：</span><input class="skillLink input" ng-model="game._setting.skl" type="text" style="width:275px;"></div></div></div>',["$element","$scope","$newWatch",function(m,o,r){HdPortal.logDog(1000005,1);k.append(m);r("!game.isOldSkill && !game._flagB.f8192",function(t,s){o.unBuySkill=t});j.box.data("editClose",function(){if(ERR.hasErr(m)){return false}if(q(game._setting.skn)){game._setting.skn=n}o.$destroy()});ERR.removeErr(m.find(".skillName"));var n=game._setting.skn,p=game._setting.skl;r("game._setting.skillsptype",function(t,s){if(t==2){p=game._setting.skl;game._setting.skn=gameDef._setting.skn;game._setting.skl=hdFai.decodeUrl(gameDef._setting.skl)}else{if(t==3){game._setting.skn=n;game._setting.skl=p}}$$(function(){$$(".skillCont").toggle(t!=1)})});r("game._setting.skn",function(t,s){if(q(t)){return"$def"}t==3&&(n=game._setting.skn);$$(function(){$$(".skillName").text(t)})})();function q(v){var s=m.find(".skillName");var u=game._setting.partnerType;if(u!=1&&game.$$createTime>1476189000000){var t=HdPortal.checkSensitword(v);if(t){ERR.addErr(s,"存在微信敏感词"+t.sensword+"，建议修改为"+t.replaceWord,m,"margin-left: 16px;");return true}}return !HdPortal.checkMaxLen(v,20,s,"noLimitType",false,m,"margin-left: 16px;")}setTimeout(function(){setBuyInput(m.find(".js_ver"))},10)}])},})}c.setAdQRCode=function(){c.editPoup.show({title:"广告二维码",info:function(j,i,k){c.compileHtml('<div class="editLine"><div class="mainLine"><span class="title">特殊广告二维码：</span><span class="content"><input id="adverQRCodeDef" ng-model="game._flagB.f524288" ng-value=false type="radio" name="QRCodeStyle" checked><label for="adverQRCodeDef">默认</label><input id="adverQRCodeCustom" ng-model="game._flagB.f524288" ng-value=true type="radio" name="QRCodeStyle"><label for="adverQRCodeCustom">自定义</label></span></div><div class="detailsLine" ng-show="game._flagB.f524288" style="margin:15px 0px 0px 116px;"><div class="QRImg comUploadImg"><img ng-src="{{::game._setting.al || game.$$qrImgPathDef}}" /></div><div class="QRloaBox comUploadBox chooseImg"><span class="btn"></span></div></div></div>',["$element","$scope",function(l,n){j.append(l);var o="";var m=l.find(".QRImg img");c.createHtml5Upload({groupId:0,uploadImg:m,uploadBtn:l.find(".QRloaBox .btn"),from:-1,isPortal:true,buttonText:"＋上传二维码",limit:5000,onSuccess:function(p){o=p.path},});i.box.data("editClose",function(){game._setting.al="";if(game._flagB.f524288&&o&&o!=game.$$qrImgPathDef){game._setting.al=o}});m[0].complete&&hdFaiOperateImg(m[0]);m.on("load",function(){hdFaiOperateImg(this)})}])},})};c.recoveryImg=function(l,m,i,n){$(l).hide();i.attr("src",m);if(n.attr("id")=="resule-gift-sucImg"){var j=i[0].id;j=j.replace("uploadImg-","");if(j==game.$checkeIndex){$$(n).attr("resize","0")}var k=$$(n).data("defData");game._awardList[j].aimgw=k.width;game._awardList[j].aimgh=k.height;n.data("theImgUploadIndex",parseInt(j))}else{n.each(function(p,o){var u=o.nodeName;var r=$$(this);if(/img/i.test(u)){var s=r.data("defData");if(!s){return false}var t=$.extend(true,{},s);t={width:getPreviewWin().parseRemToPx(t.width),height:getPreviewWin().parseRemToPx(t.height)};var q=getPreviewWin().HdGame.getPosition(r,{width:r.parent().width(),height:r.parent().height()},{width:t.width,height:t.height});r.attr("resize","0").add(r.parent()).width(t.width).height(t.height).hdTrigger("hd-resizable-autoChange",[t,q]);if(q){r.add(r.parent()).css({left:q.left,top:q.top,});q=null}}else{if(r.hasClass("hd-img-fillDiv")){var s=r.data("defData");!r.data("defPositionData")&&(r.data("defPositionData",{left:r.position().left+r.width()/2,top:r.position().top+ +r.height()/2}));if(!s){return false}var t=$.extend(true,{},s);t={width:getPreviewWin().parseRemToPx(t.width),height:getPreviewWin().parseRemToPx(t.height)};var q=getPreviewWin().HdGame.getPosition(r,{width:t.width,height:t.height},{width:t.width,height:t.height});r.css({width:t.width,height:t.height,left:q.left,top:q.top});r.hdTrigger("hd-resizable-autoChange")}}});setJqSrc(n,m)}setTimeout(function(){hdFai.Img.optimize(i[0],{width:80,height:80,mode:hdFai.Img.MODE_SCALE_FILL})},10);n.hdTrigger("hd-editUpload-recover",[m,l,i])};c.recoveryMusic=function(l,k,i){var j=l.parents(".musicUploadBox");l.hide();j.find(".musicPath").val(k);j.find(".musicName").html(i).attr("title",i)};c.getImgName=function(j){var i=j.match(/\/([^\.\/]+?\.\w+)($|\?)/i);if(i===null){return false}return i[1]}})();c.addEditBtn=function(g,f){var h={name:"",selecter:".home,.gameBgBox",onclick:null,prepend:false,filter:null,};if($.isPlainObject(g)){$.extend(h,g)}else{var i={name:g,onclick:f,};if(arguments.length===3){if(typeof arguments[2]==="function"){i.selecter=arguments[1];i.onclick=arguments[2]}else{i.onclick=arguments[1];i.prepend=arguments[2]}}else{if(arguments.length===4){i.selecter=arguments[1];i.onclick=arguments[2];i.prepend=arguments[3]}}$.extend(h,i)}if(typeof h.selecter==="string"){h.selecter=$$(h.selecter)}if($.type(h.selecter)!="function"&&h.selecter.length<=0){return}var e=$("<a class='tool' hidefocus='true' href='javascript:;'>"+h.name+"</a>");if(h.prepend){$("#moduleLayerBox").prepend(e)}else{$("#moduleLayerBox").append(e)}e.hide().on("click",h.onclick);if($.type(h.selecter)=="function"){h.selecter(e)}else{h.selecter.on("mouseover",function(j){if(h.filter){if(!h.filter(j.target)){return}}e.show()})}if($.type(h.selecter)!="function"){var d=h.selecter.data("editBtnOpts");!d&&h.selecter.data("editBtnOpts",d=[]);d.push(h)}};c.triggerEditBtn=function(e,g){if(!$$.checkFire("ready")){return}var k=$$(e);if(k.length==0){return}var f=k.data("editBtnOpts");for(var h=0,d=f.length;h<d;h++){var j=f[h];if(g===undefined||j.name===g){j.onclick()}}};(function(){var e={};function k(){!e.gameTopBar&&v("gameTopBar",[{_key:"gtopcol",_flag:8388608,title:"文字颜色",from:"#gameTopBar",type:"color",name:"color",},{_key:"gtopis|gtopicon",_flag:16777216,title:"头像描边",from:"#gameTopBar .userImgBox",type:"color",name:"border-color",},{_key:"gtopbgcol|gtopbg",_flag:33554432,title:"背景颜色",from:"#gameTopBar",type:"color",name:"background-color",defTra:-1,},]);return e.gameTopBar}function r(){!e.joinNum&&v("joinNum",[{_flag:2097152,title:"常规文字",from:"#joinNumLine",css:[{_key:"jlfsize",type:"size",name:"font-size",},{_key:"jlcolor",_flag:131072,type:"color",name:"color",},{_key:"jlscolor",_flag:262144,type:"color",name:"text-shadow"}]},{_flag:4194304,title:"参与人数",opt:0,from:"#joinNum",css:[{_key:"jnfsize",type:"size",name:"font-size",},{_key:"jncolor",_flag:524288,type:"color",name:"color",},{_key:"jnscolor",_flag:1048576,type:"color",name:"text-shadow",}]}]);return e.joinNum}function n(A,z,y){$.each(A,function(B,C){if(C.css){z(C);n(C.css,z,C)}else{z(C,y)}})}function u(y){return y===""||y===undefined}function l(A,y){if(!A){return}var B=A.split("|");var z=(B.length>1?B[1]:B[0])+"def";y(B[0],z)}function v(z,y){e[z]=y;n(y,function(B,A){B._flag&&(B.opt=game._flag["f"+B._flag]?1:0);l(B._key,function(D,C){B.type=="size"&&(B.opt=1);B.val=game._setting[D];B.defVal=game._setting[C];if(u(B.val)){return}if(B.type=="size"){B.val=parseFloat(B.val)*20;if((B.defVal+"").indexOf("rem")!=-1){B.defVal=parseFloat(B.defVal)*20}else{B.defVal=parseFloat(B.defVal)}}else{if(B.name=="text-shadow"){B.val=h(B.val);B.defVal=h(B.defVal)}}B.val=q(B.val);B.defVal=q(B.defVal);if(B.defTra<0){if(B.defVal){B.defTra=i(B.defVal);B.defVal=o(B.defVal)}B.tra=i(B.val);B.val=o(B.val)}})});$$.on("save",function(A,B){var C=c.regroupPropCssList(y,function(D,E){E._flag&&(D._flag=E._flag);E._key&&(D._key=E._key);E.type&&(D.type=E.type)});n(C,function(E,D){E._flag&&(B._flag["f"+E._flag]=E.opt==1);l(E._key,function(G,F){if(u(E.val)){return}if(E.type=="size"){A[G]=(E.val/20)+"rem";A[F]=E.defVal}else{A[G]=t(E.val,E.tra);A[F]=t(E.defVal,E.defTra)}})})})}function s(y,z){if(y=="gameTopBar"){z=k()}if(y=="joinNum"){z=r()}c.editPoup.show({width:432,title:"编辑样式",info:function(B,A,C){$.each(z,function(E,D){f({win:C,arg:D,index:E,warp:B,})});B.find(".editLine>.mgbox").css("margin-left",HdPortal.syncOuterWidth(B.find(".editLine>.title")))},})}function f(y){y=$.extend({win:null,arg:null,index:0,warp:null,},y);var B=y.arg;if(B.hide){return}var F=$$(B.from);var D;F.data("_cssEditArg",B);if(B.css){if(B.css.length==1){B.title&&(B.css[0].title=B.title);D=j(0,y.win,B.css[0],F,y.index,0,B).addClass("editLine");y.warp&&y.warp.append(D)}else{D=y.win.$('<div class="editLine setLine"><span class="title">'+B.title+"：</span>"+(typeof B.opt==="undefined"?"":('<input id="cssDefault-'+y.index+'" class="cssDefault" type="radio" name="cssOpt-'+y.index+'" checked><label for="cssDefault-'+y.index+'">默认</label><input id="cssSelf-'+y.index+'" class="cssSelf" type="radio" name="cssOpt-'+y.index+'" ><label for="cssSelf-'+y.index+'">自定义</label>'))+'<div class="setBox mgbox"></div></div><div class="cutLine"></div>');var E=D.find(".setBox");for(var C=0;C<B.css.length;C++){E.append(j(1,y.win,B.css[C],F,y.index,C))}var z=D.find(".cssDefault");var A=D.find(".cssSelf");var G=function(H){E.find(".setLine").each(function(J,L){var M=B.css[J];var K=M.opt;if(M.type==="size"){g(F,M,H);M.opt=1;return}if(H){y.win.$(L).find(".defSet").click();M.opt=K}else{y.win.$(L).find(K?".selfSet":".defSet").attr("checked","checked").click()}});E.toggle(!H);var I=H?0:1;if(B.opt!=I){changeIsSave()}B.opt=I};z.on("click",function(){G(true)});A.on("click",function(){G(false)});y.warp&&y.warp.append(D);E.find(".setLine>.mgbox").css("margin-left",HdPortal.syncOuterWidth(E.find(".setLine>.title")));setTimeout(function(){if(B.opt){A.attr("checked","checked").click()}else{z.attr("checked","checked").click()}},10)}}else{D=j(0,y.win,B,F,0,y.index).addClass("editLine");y.warp&&y.warp.append(D)}return D}function j(B,G,K,I,E,D,J){if(u(K.defVal)){if(K.type=="size"){K.defVal=a(parseFloat(I.css(K.name)),1)}else{if(K.name==="text-shadow"){K.defVal=q(h(I.css(K.name)))}else{K.defVal=q(I.css(K.name))}}}K.defVal=q(K.defVal);if(K.defTra<0){K.defTra=i(K.defVal);K.defVal=o(K.defVal)}if(!K.val){K.val=K.defVal}K.val=q(K.val);if(K.defTra!==undefined&&(K.tra==undefined||K.tra<0)){K.tra=K.defTra}if(!K._parseSize&&K.type=="size"){K.val=HdPortal.Num.round(a(K.val),4);K.defVal=HdPortal.Num.round(a(K.defVal),4);K._parseSize=true}var H=K.title;if(!H){switch(K.name){case"font-size":H="文字大小";break;case"color":H="文字颜色";break;case"text-shadow":H="描边颜色";break;case"background-color":H="背景颜色";break;case"border-color":H="边框颜色";break}}if(B==0){H+="："}if(K.type==="size"){var F=G.$('<div class="setLine" style="line-height:30px"><span class="title">'+H+'</span><div class="setSliderBar"></div>\n<div class="setSliderLetter">'+parseInt(K.val)+"px</div></div>");var C=F.find(".setSliderBar");var y=F.find(".setSliderLetter");C.slider({animate:true,max:32,min:12,orientation:"horizontal",step:1,value:K.val,start:function(L,M){C.addClass("w-resize");K.val=M.value},slide:function(L,M){y.text(M.value+"px");K.val=M.value;g(I,K);changeIsSave()},stop:function(L,M){C.removeClass("w-resize");y.text(M.value+"px");K.val=M.value}});K.opt=1}else{if(K.type==="color"){var F=G.$('<div class="setLine"><span class="title">'+H+'</span><input id="defColor-'+E+"-"+D+'" class="defSet" type="radio" name="color-'+E+"-"+D+'" checked><label for="defColor-'+E+"-"+D+'">默认</label><input id="selfColor-'+E+"-"+D+'" class="selfSet" type="radio" name="color-'+E+"-"+D+'" ><label for="selfColor-'+E+"-"+D+'">自定义</label><div class="setCtrl"></div>'+(typeof K.tra==="undefined"?"":('<div class="opacitySet'+(B==0?" mgbox":"")+'"><span class="title">不透明度</span><div class="setSliderBar"></div>\n<div class="setSliderLetter">'+K.tra*100+"%</div></div>"))+"</div>");if(typeof K.tra!=="undefined"){var C=F.find(".setSliderBar");var y=F.find(".setSliderLetter");C.slider({animate:true,max:1,min:0,orientation:"horizontal",step:0.1,value:K.tra,start:function(L,M){C.addClass("w-resize");K.tra=M.value},slide:function(L,M){y.text(M.value*100+"%");K.tra=M.value;g(I,K);changeIsSave()},stop:function(L,M){C.removeClass("w-resize");y.text(M.value*100+"%");K.tra=M.value}})}var A=F.find(".defSet");var z=F.find(".selfSet");A.click(function(){G.$(this).nextAll(".setCtrl,.opacitySet").hide();g(I,K,true);if(K.opt==1){changeIsSave()}K.opt=0;J&&(J.opt=0)});z.click(function(){G.$(this).nextAll(".setCtrl,.opacitySet").show();g(I,K);F.find(".setCtrl").faiColorPicker({advance:true,defaultcolor:o(K.val),onchange:function(L){K.val=q(L);g(I,K);changeIsSave()}});if(K.opt==0){changeIsSave()}K.opt=1;J&&(J.opt=1)});setTimeout(function(){(K.opt?z:A).click().attr("checked","checked")},10)}}return F}function g(C,z,y){var B=y?z.defVal:z.val;if(z.type==="size"){if(!isNaN(Number(B))){C.css(z.name,B+"px")}else{C.css(z.name,B)}return}var A=y?z.defTra:z.tra;if(z.name==="text-shadow"){if(hdFai.isIE()&&B==="none"){C.css(z.name,w("rgba(255,255,255,0)"))}else{C.css(z.name,w(t(B,A)))}}else{C.css(z.name,t(B,A))}}function w(y){if(y=="none"||y.length>40){return y}return y+" -1px -1px 0px, "+y+" 0px -1px 0px, "+y+" 1px -1px 0px, "+y+" 1px 0px 0px, "+y+" 1px 1px 0px, "+y+" 0px 1px 0px, "+y+" -1px 1px 0px, "+y+" -1px 0px 0px"}var d=/(rgba?\(.+?\)|#[0-9a-fA-f]{3,6})([\s,]|$)/;function h(z){if(!z||z=="none"||z.length<40){return z}var y=z.match(d);if(y){return y[1]}return z}function o(y){if(y=="none"){return y}if(y==="transparent"){return"rgb(255,255,255)"}else{if(y.indexOf("(")==3){return y}}return"rgb"+y.substring(y.indexOf("("),y.lastIndexOf(","))+")"}var p=/^#[0-9a-fA-f]{3}$/;var m=/^#[0-9a-fA-f]{6}$/;function q(B){B=$.trim(B);if(p.test(B)){var y="#";for(var A=1;A<4;A+=1){var C=B.slice(A,A+1);y+=C+C}B=y}if(!m.test(B)){return B}B=parseInt(B.substring(1),16);var z=["rgb(",B>>16,",",(B&65280)>>8,",",(B&255),")"];return z.join("")}function t(z,y){if(z=="none"||typeof y==="undefined"){return z}return"rgba"+z.substring(z.indexOf("("),z.indexOf(")"))+","+(y?y:0)+")"}function i(y){if(y=="none"||y==="transparent"){return 0}else{if(y.indexOf("(")==3){return 1}}var z=y.substring(y.lastIndexOf(",")+1,y.lastIndexOf(")"));if(!isNaN(z)){z=Number(z);z=parseInt(z*10)/10}return z}c.Css={showCssByGame:s,initCssLine:f,setColor:g,getTextShadow:w,getShadowColor:h,parseRgbaToRbg:o,HextoRgb:q,getRgba:t,getA:i,}})();c.initModuleLayer=function(h,i,j,g){$("#"+h).off("mouseover").off("mouseleave").on("mouseover",function(){$("#homeBgmoduleLayer").hide();d(h,g);f(h,i,j)}).on("mouseleave",function(){clearTimeout(c.initModuleLayer.timer);c.initModuleLayer.timer=setTimeout(function(){var m=h+"moduleLayer";var n=$("#"+m);var l=n.attr("_mouseIn");if(l==0){k(h);n.remove()}},20)});function k(l){$("#"+l+"moveFrameLeft").remove();$("#"+l+"moveFrameRight").remove();$("#"+l+"moveFrameTop").remove();$("#"+l+"moveFrameBottom").remove()}function d(o,n){var p=$("#"+o);var q=["Left","Right","Top","Bottom"];var l=n?"gameMoveFrame":"portalMoveFrame";var m="";$.each(q,function(r,s){if($("#"+o+"moveFrame"+s).length==0){m+='<div id="'+o+"moveFrame"+s+'" class="moveFrame '+l+'" style="border-'+s.toLowerCase()+'-width:1px"></div>'}});if(m){$("body").append(m);e(p,o)}}function e(q,r){var n=q.offset().left;var o=q.offset().top;var m=q.outerWidth();var p=q.outerHeight();$("#"+r+"moveFrameLeft").css({left:n,top:o,width:0,height:p,borderLeftWidth:1});$("#"+r+"moveFrameRight").css({left:n+m-1,top:o,width:0,height:p,borderRightWidth:1});$("#"+r+"moveFrameTop").css({left:n,top:o,width:m,height:0,borderTopWidth:1});$("#"+r+"moveFrameBottom").css({left:n,top:o+p-1,width:m,height:0,borderBottomWidth:1})}function f(m,n,o){var l=m+"moduleLayer";var p=$("#"+m);var q=$("<div id='"+l+"' class='moduleLayer' _mouseIn='0' style='position:absolute;margin:0;'><a class='tool showTool' hidefocus='true' href='javascript:;' onclick='Edit.showEditByGame("+n+',"'+o+"\");return false;'>编辑</a></div>");$("#"+l).remove();q.appendTo("body").css("left",p.offset().left+p.outerWidth()-2-q.width()).css("top",p.offset().top-q.height()-1).mouseover(function(){$(this).attr("_mouseIn",1)}).mouseleave(function(){$(this).attr("_mouseIn",0);k(m);$("#"+l).remove()})}};c.tmpImgList=[];c.createHtml5Upload=function(p,z,l,u,r,d,w,m,s){var h={groupId:0,uploadImg:null,uploadBtn:null,from:"",isPortal:false,buttonText:"",limit:10*1024,onSuccess:null,showProgress:false,progressBox:null,};var i=p;if(!i||typeof i!=="object"){i={groupId:p,uploadImg:$(z),uploadBtn:$(l),from:u,isPortal:r,buttonText:d,limit:w,onSuccess:m,showProgress:s,}}$.extend(h,i);if(!h.uploadBtn||h.uploadBtn.length==0){return}var d=h.isPortal?h.buttonText.replace("＋ ",'<span class="addIcon"></span>'):'<span class="addIcon"></span>上传替换';var n="",t="",A=false;var f=h.from=="forMusic";var o=h.uploadBtn.closest(".forMusicBox");var v=f?o.find(".musicPath").val():h.uploadImg.attr("src");var j=h.uploadBtn.parent();var k=h.progressBox||j;var e=null;var y=$.fn.uploadify.call(h.uploadBtn,{groupId:h.groupId,auto:true,fileTypeExts:f?"*.mp3;*.wav;":"*.jpg;*.png;*.gif;*.jpeg;*.bmp",fileSizeLimit:(parseInt(h.limit)/1000)*1024*1024,multi:false,post_params:{groupId:h.groupId,imgMode:2,maxWidth:10000,maxHeight:10000,watermarkUse:false,},button_image_type:3,buttonText:d,buttonClass:"main-Button",breakPoints:true,saveInfoLocal:false,showUploadedPercent:true,showUploadedSize:true,removeTimeout:9999999,isPortal:h.isPortal,progressBox:k,isparallel:true,getFileSizeUrl:"/ajax/advanceUpload.jsp?cmd=_getUploadSize",uploader:"/ajax/advanceUpload.jsp?cmd=_upload&gameId="+(game.id==-1?game.$$tmpFileId:game.id),onUploadSuccess:function(C,I){if(A){A=false;return}var F=$.parseJSON(I);h.onSuccess&&h.onSuccess(F,h.from,h.uploadBtn);if(F.success){if(g_isNewOpt){var H=F.path;c.tmpImgList.push(H.substring(H.lastIndexOf("/")+1,H.lastIndexOf(".")))}g("progress",100);var E=j.find(".recoveryBtn");if(E.length>0&&c.getImgName(F.path)!=c.getImgName(v)){E.css("display","inline-block")}if(f){var G=F.name.split(".");G="."+G[G.length-1];if(F.path.indexOf(G)===-1){F.path+=G}o.find(".musicName").html(F.name).attr("title",F.name);o.find(".musicPath").val(F.path)}else{if(h.from!==-1){var D=$$(h.from);if(D.attr("id")!="resule-gift-sucImg"){D.data("your-Original-Size",F);D.each(function(){var J=$(this);if(J.attr("edit_store_src")){J.attr("edit_store_src",F.path)}else{setJqSrc(J,F.path)}})}}h.uploadImg.attr("src",F.path);h.uploadImg.attr("_path",F.path);if(h.uploadImg.parent().hasClass("attentionImg")){game.tmpAwardPath=F.path}else{if(h.uploadImg.parent().hasClass("QRImg")){game.tmpGaojiPath=F.path}}HdPortal.logDog(1000155,3)}hdFai.ing("文件上传成功",true);var B=C.size/(1024*1024);$.each([0.5,1,2,5,10],function(J,K){B<=K&&HdPortal.logDog(1000190,J+1)});B>10&&HdPortal.logDog(1000190,6);changeIsSave()}else{hdFai.ing("文件:"+C.name+"，"+F.msg,true)}},onUploadStart:function(B){_uTime=new Date().getTime();A=false;if(f){t=o.find(".musicName").html();n=o.find(".musicPath").val()}else{n=h.uploadImg.attr("src")}g("show")},onUploadError:function(B,C){g("remove");hdFai.ing("网络繁忙，文件:"+B.name+"上传失败，请稍后重试")},onUploadComplete:function(B){g("complete")},onProgress:function(B){h.showProgress&&q(B)}});return y;function q(B){if(B.status=="start"){if(e){e.remove()}k.append('<div id="progressWrap_'+B.id+'" class="bodyProgressWrap uploadtime"><div class="mission uploadInner"><div id="progress'+B.id+'" class="progress uploadprogres"></div></div><div id="progressNum'+B.id+'" class="progressNum uploadpercent">0%</div><a class="progressCancel cancelUpload" href="javascript:void(0);"></a></div>');e=k.find(".uploadtime");e.find(".cancelUpload").on("click",function(D){D=window.event;D.cancelBubble=true;A=true;y.cancel();hdFai.ing("文件取消成功",true);if(f){o.find(".musicName").html(t);o.find(".musicPath").val(n)}else{if(h.from!==-1){var C=$$(h.from);setJqSrc(C,n);h.uploadImg.attr("src",n);h.uploadImg.attr("_path",n)}}g("remove")})}else{if(B.status=="ing"){g("ing",B.percent)}else{if(B.status=="end"){g("remove")}else{if(B.status=="error"){g("error")}}}}}function g(C,B){if(!e){return}if(C=="show"){e.show()}else{if(C=="ing"){if(B>99.5){e.find(".cancelUpload").off("click")}g("progress",B)}else{if(C=="progress"){e.find(".progress").css("width",Math.round(B)+"%");e.find(".uploadpercent").html(Math.round(B)+"%")}else{if(C=="remove"){e.remove();e=null}else{if(C=="complete"){e.add(e.find(".progress,.uploadpercent")).attr("id","");e.fadeOut(3000,function(){g("remove")})}else{if(C=="error"){e.find("#progress").addClass("progressError")}}}}}}}};c.createCustomUpload=function(i){var d={groupId:0,uploadImg:null,uploadBtn:null,from:"",isPortal:false,buttonText:"",limit:10*1024,onSuccess:null,url:"",onStart:null,index:0,};var h=i;$.extend(d,h);var e="";if(d.from=="forMusic"){e="*.mp3;*.wav;"}else{if(d.from==-2){e="*.xls;*.xlsx"}else{e="*.jpg;*.png;*.gif;*.jpeg"}}var f={groupId:d.groupId,auto:true,fileTypeExts:e,fileSizeLimit:(parseInt(d.limit)/1000)*1024*1024,multi:false,post_params:{groupId:d.groupId,imgMode:2,maxWidth:10000,maxHeight:10000,watermarkUse:false,},button_image_type:3,buttonText:d.isPortal?d.buttonText:"重新上传",breakPoints:true,saveInfoLocal:false,showUploadedPercent:true,showUploadedSize:true,removeTimeout:9999999,isPortal:d.isPortal,isparallel:true,getFileSizeUrl:"/ajax/advanceUpload.jsp?cmd=_getUploadSize",uploader:d.url,onUploadSuccess:function(j,k){d.onSuccess&&d.onSuccess(k,d)},onUploadStart:function(j){d.onStart&&d.onStart(g,j,d)},onUploadError:function(j,l,k){console.log(k.responseText);hdFai.ing("网络繁忙，文件:"+j.name+"上传失败，请稍后重试")}};var g=d.uploadBtn.uploadify(f);return g};c.showNoSupportTips=(function(){var f=null;var h;var g=function(i){$(this).data("enter",true)};var d=function(i){if(hdFai.top._noSupportTipBox.data("timeout")){e()}else{$(this).data("enter",false)}};var e=function(){h.HdPortal.hoverTipsBox.hide();h=hdFai.top._noSupportTipBox=null};return function(n,p,m,o,j,l){clearTimeout(f);h=l||window;if(hdFai.top._noSupportTipBox){hdFai.top._noSupportTipBox.remove()}var i=[];if(o&&o>0){i.push({id:1000144,src:o})}var k=HdPortal.noSupportTipA.replace(/openQuickPay\(\)/,"openQuickPay("+hdFai.encodeHtml($.toJSON(i))+")");hdFai.top._noSupportTipBox=h.HdPortal.hoverTipsBox.showHtml(n,"up",p+(k||""),$.extend({marginRight:10,parent:function(r,s){var q=r.closest(".settingLine");if(q.length==0){q=s("body")}return q}},j));hdFai.top._noSupportTipBox.on("mouseenter",g).on("mouseleave",d);f=setTimeout(function(){if(!hdFai.top._noSupportTipBox.data("enter")){e()}else{hdFai.top._noSupportTipBox.data("timeout",true)}},3000)}})();c.checkHdGiftTotal=function(A,k){var f={};var y=[1,2,3,4,21,22,23,24,25,26,27,28,41,42,43,44,51,52,53,61,62,63];for(var t=0;t<y.length;t++){f[y[t]]=0}var w=function(C,D){if(!C){C=m.eq(D)}else{C=C.add(m.eq(D))}return C};var e=function(E,D){if(A){if(A[D.giftType]){return true}}else{for(var C=0;C<game.$giftNumList.length;C++){if(E==game.$giftNumList[C].typeB){return true}}}return false};var g=function(E,D){if(A[D.giftType]){return A[D.giftType]}else{for(var C=0;C<game.$giftNumList.length;C++){if(E==game.$giftNumList[C].typeB){return game.$giftNumList[C].amount}}}return 0};var h={};var j={};var m;var n=game.style==71?[$(".groupAwardAmount"),$(".groupAwardAmountBox")]:[$(".awardAmount"),$(".awardAmountBox")];if(!isPublish){m=n[0]}else{for(var t=0;t<8;t++){var B=n[t+1>game._setting.max_an?0:1].eq(t);m=m?m.add(B):B}}for(var t=0;t<game._setting.an;t++){var z=awardList[t];var s=gameLast._awardList[t].amount-gameLast.$$prizedNum[t];if(z.awardtype==6||z.awardtype==7||z.awardtype==8){var l=z.amount-(isPublish?game.$$prizedNum[t]+s:0);var o=z.giftType;l<0&&(l=0);f[o]+=l;h[o]=w(h[o],t);var v=game.storeId;var q=game.areaId;var r=e(o,z);var u=g(o,z);var d=(!HdPortal.isOem&&HdPortal.isMainstore)||(HdPortal.isOem&&game.$$openAcctSvr);j[o]=(r&&f[o]>u)||(!r&&f[o]>0);if(j[o]){var p=f[o]-u;ERR.addErr(h[o],"{hfGift,-1}|当前礼品可用数量不足"+f[o]+"个，当前可用数量"+u+"个"+(d?"&ensp;<a onclick=\"Edit.showGiftBox('"+z.giftTypeItem.val+"','"+p+"','"+v+"','"+q+"');return false;\">马上采购</a>":""),$(".awardDetail"))}else{ERR.removeErr(h[o],"hfGift")}}else{ERR.removeErr(m.eq(t),"hfGift")}}};c.showGiftBox=function(g,e,d,f){HdPortal.showBuyGiftBox(g,e,d,f,function(h){c.checkHdGiftTotal(h)})};c.checkPasswordredTotal=function(j,e){if(typeof j!="undefined"&&(j==8||awardList[j].awardtype!==5)){return true}var l=0;var q=game.style==71?[$(".groupAwardAmount"),$(".groupAwardAmountBox")]:[$(".awardAmount"),$(".awardAmountBox")];var h;if(!isPublish){h=q[0]}else{for(var f=0;f<8;f++){var p=q[f+1>game._setting.max_an?0:1].eq(f);h=h?h.add(p):p}}var o=function(s,t){if(!s){s=h.eq(t)}else{s=s.add(h.eq(t))}return s};var r,n;var m=false;for(var f=0;f<game._setting.an;f++){var k=awardList[f];if(k.awardtype==5){var g=k.amount-(isPublish?game.$$prizedNum[f]:0);g<0&&(g=0);if(k.hbtype==0){l+=k.passwordrednum*g}else{l+=k.hbAverage*g;m=true}r=o(r,f)}else{n=o(n,f)}}if(!getIsSave()&&isPublish){lastPasswordredTotal=0;$.each(gameLast._awardList,function(u,v){if(v.awardtype==5){var t=v.amount-game.$$prizedNum[u];t<0&&(t=0);var s;if(v.hbtype==0){s=parseInt(v.passwordrednum)}else{s=parseInt(v.hbAverage)}if(!isNaN(s)){lastPasswordredTotal+=s*t}}});lastPasswordredTotal=hp.Num.div(lastPasswordredTotal,100);$.ajax({type:"post",url:"/ajax/hdcash_h.jsp?cmd=getBalance&storeId="+g_storeId+"&areaId="+g_areaId,error:function(){alert("服务繁忙，请稍候重试")},success:function(s){var i=$.parseJSON(s);if(i.success){g_balance=i.balance}else{alert("服务繁忙，请稍候重试")}}})}var d=function(i){i=hp.Num.div(i,100);var s=hp.Num.sub(i,lastPasswordredTotal);if(s>g_balance){ERR.addErr(r,"{redPacket,-1}|当前红包余额不足"+s+"元，当前"+g_balance+"元"+(HdPortal.canRecharge&&!HdPortal.closeRecharge&&HdPortal.accreditRecharge?'&nbsp;<a onclick="Edit.topUp();return false;">前往充值</a>':""));ERR.removeErr(n,"redPacket")}else{ERR.removeErr(h,"redPacket")}};if(m&&isPublish&&e){$.ajax({type:"post",url:"/ajax/hdportal_h.jsp?cmd=checkLevelDeviation&gameid="+game.id,error:function(){alert("服务繁忙，请稍候重试")},success:function(s){var D=$.parseJSON(s);if(D.rt==0){var t=D.deviation;console.log(t);var w=t.length;for(var u=0;u<w;u++){var B=t[u].level-1;var y=awardList[B];var C=isNaN(t[u].usedAmount)?0:t[u].usedAmount-0;var A=isNaN(t[u].noneAmount)?0:t[u].noneAmount-0;var v=game.$$prizedNum[B]-0;var z=gameLast._awardList[B];if(y.hbtype==0){}else{l=l+(y.hbAverage*z.amount-(C+A))}}d(l)}else{alert("服务繁忙，请稍候重试")}}})}else{if(!m||(!isPublish||j+1>game._setting.max_an)){d(l)}}return};c.checkAmountTotal=function(f){var g=0;for(var e=0;e<8;e++){if(e<game._setting.an){g+=awardList[e].amount}else{if(game.$$isPublish){g+=game.$$prizedNum[e]}}}if(f!==undefined){g+=f}var h=g>game.$$verInfo.awardAmountLimit;if(f===undefined){var d=$(game.style==71?".groupAwardAmount":".awardAmount").not(":eq(8)");if(game.$$isPublish){d=d.filter(":gt("+(game._setting.max_an-1)+")")}ERR.toggleErr(h,d,"{amountTotal,-1}|总奖品数量不超过"+addCommas(game.$$verInfo.awardAmountLimit)+"份",$(".awardDetail"),"margin-left: "+g_awardMg+"px;")}return h};c.sumAmountTotal=function(d){var f=0;if(!(d instanceof Array)){d=[d]}var m=d.length;var l=game.$$isPublish;for(var k=0;k<m;k++){var e=awardList.length;for(var g=0;g<e;g++){var h=d[k];if(awardList[g].awardtype==h){if(!l){f+=(awardList[g].amount-0)}else{f+=(awardList[g].amount-game.$$prizedNum[g]-0)}}}}return f};c.topUp=function(){HdPortal.poupTopUpBox(function(d){if(d.success){g_balance=parseFloat(d.balance.toFixed(2));c.checkPasswordredTotal()}},game.$$isOem)};c.showPreviewBox=function(e){HdPortal.logDog(1000156,13);var d=HdPortal.showPreviewBox(e);d.addClass("version3").find("iframe").load(function(){try{var m="";var q=d.find("iframe")[0].contentWindow.document;var i=$("#editActive .topBar .column");i.each(function(r,s){var t=$(s);if(t.find(".name").text()==="首页"){t.click();return false}});$$('link[rel="stylesheet"][type="text/css"]').each(function(){m+=this.outerHTML});var n=$$(".body");var l=n.siblings(".ruleImg");var h=n.siblings(".imgContainer").find("#relationBox");var g=n.siblings("#bottomTab");var p=n.siblings("#logoImgBox");var j=n.find("canvas")[0];m+=n[0].outerHTML;if(l.length>0){m+=l[0].outerHTML}if(h.length>0){m+=h[0].outerHTML}if(g.length>0&&(e.game.style==69||e.game.style==67||e.game.style==77)){m+=g[0].outerHTML}if(p.length>0){m+=p[0].outerHTML}m=m.replace(/<!-[\s\S]*?-->/g,"").replace(/onload=["'].+?["']([\s>])/g,"$1");q.documentElement.style.fontSize=getPreviewWin().g_rem+"px";q.getElementsByTagName("body")[0].innerHTML=m;var f=q.getElementsByTagName("canvas")[0];f.width=f.width/2;f.height=f.height/2;var k=f.getContext("2d");k.drawImage(j,0,0,j.width/2,j.height/2)}catch(o){console.warn("previewBox--"+o)}});return d};c.showFansOnlySample=function(){var d=top.$("#fansOnlySampleMask");if(d.length==0){d=top.$('<div id="fansOnlySampleMask" class="activePoupMask"><div class="activePoupBox2"><div class="activeClose"></div><img id="fansOnlySampleImg" src="'+HdPortal.resRoot+'/version2/image/fansOnlySample.png" ></div></div>');top.$("body").append(d);d.click(function(e){e.preventDefault();e.stopPropagation();if(!top.$(e.target).is("#fansOnlySampleImg")){d.hide()}})}d.show();HdPortal.logDog(1000153,55)};(function(){var e;var d=$.throttle(function(g,f){g=g||$("#editActive .topBar .column");if(f===undefined){f=g.index(g.filter(".checked"))}if(!e){e=$(".phoneBox .currentPage")}e.text((f+1)+"/"+g.length)});c.updataTopBarTap=function(n,f){var h=$("#editActive .topBar");var o=h.find(".column.checked .name").html();var m=Math.min($("#editActive .topBar .column.checked").index(),n.size()-1);var l="";var q=n.size();for(var k=0;k<q;k++){l+='<div class="column"><span class="name">'+n.getName(k)+"</span></div>"}h.html(l).data("columnList",n);var j=n.getIndex(o);if(j<0&&m>=0){j=m}if(j<0){j=0}var g=h.find(".column");var p=g.eq(j);if(f){p.click()}else{p.addClass("checked")}d(g,j)};c.initTopBarTapEvent=function(){$("#editActive .topBar").on("click",".column",function(l,o){var i=$(this);var j=i.parent().children(".column");var k=j.index(i);var g=i.find(".name").html();if(g=="首页"){if(game._flag.f536870912&&!$$(".showAwardBox").data("awardSlideOptions")){$("#openSlide").attr("checked","checked").click()}if($$(".showAwardBox").data("awardSlideOptions")&&$$(".showAwardBox").is(":hidden")){$$(".showAwardBox").newAwardSlide("wakeup")}}if(k==0||k==1||k==2||k==3){$$("#awardDetailBox").hide()}$("#homeBgmoduleLayer").hide();var n=$("#editActive .topBar").data("columnList");if(n){var h=n.getByName(g);if(h&&h[1]!=undefined){var m=typeof h[1]=="function"?h[1]:getPreviewWin()[h[1]];if(typeof m=="function"){m.apply(null,h.slice(2))}}}j.filter(".checked").removeClass("checked");i.addClass("checked");$$.on("load",function(){var p=getPreviewWin().hg;if(p){p.fire("changeTopBar",g)}});if(g=="奖品详情"&&game.$tabSetting.val!=1&&game.$tabSetting.val!=4){game.$tabSetting.select(1)}!arguments[0].isTrigger&&(operateFlagList[2]=true);getPreviewWin().HdGame.removeAllEditLayer();if(game.style==62&&$$(".home").is(":visible")&&game._flag.f32){$$("#logoImgBox").show()}else{if(game.style==62&&!$$(".home").is(":visible")&&game._flag.f32){$$("#logoImgBox").hide().removeClass("footerBox")}}if(game.$$isQuestionGame&&(g=="游戏过程"||g=="听歌过程")&&!l.isTrigger&&!o){game.$tabSetting.select(8)}d(j,k)});$(".phoneBox .changePage").click(function(){var h=$("#editActive .topBar .column");var g=h.index(h.filter(".checked"))+($(this).hasClass("next")?1:-1);if(g>=h.length){g=0}else{if(g<0){g=h.length-1}}h.eq(g).trigger("click");getPreviewWin().HdGame.removeAllEditLayer()});var f=$("#editActive .topBar .column");if(f.filter(".checked").length==0){f.eq(0).click()}}})();c.showUserDefineView=function(){var n=50;var p=game._setting.apropIdx;var m=game.$$isPublish;var e=0;var o="自定义联系信息";if(game.$$data.isPaymentGame){e=2;o="自定义收货地址"}var k=HdPortal.poupUpBox('<ul class="defineInfoDiv center" ></ul><div class="addDefine"><span class="info">+添加字段</span></div><input class="addInfoId infoInput" style="display:none;"></input><div class="addInfoErr hide" style="text-align: center;color: #fe896a;">最多只能新增50个自定义字段!</div>',5,o,"",true,"saveDefineInfo",function(){if(k.find(".confirmBtn").is(".disabled")){return"stop"}var r=[];k.find("li .defineInfoBlue").each(function(){var s=$(this);var t={};t.name=s.find(".info").text();t.key=s.data("key");t.isOpen=s.data("isOpen");r.push(t)});c.rootSafeApply(function(){game._setting._nodrawcontact=r;game._setting.apropIdx=p})});k.find(".poupContent").height(332);k.find(".poupContent").css("overflow","auto");var g=k.find(".defineInfoDiv");var f;if(e){f=g.clone().addClass("fixed").insertBefore(g)}g.sortable({axis:"y",cancel:".sortDisabled"}).disableSelection();$.each(game._setting._nodrawcontact,function(r,t){var u=false,s=t.$disabled;if(e&&r<=e){s=u=true}d(t.name,t.key,t.isOpen,s,u)});k.find(".addDefine").click(function(){if(g.find("li").length>=n+3){k.find(".addInfoErr").text("最多只能新增50个自定义字段!").show();return}else{k.find(".addInfoErr").hide()}k.find(".addDefine").hide();k.find(".addInfoId").show();k.find(".addInfoId").val("");k.find(".addInfoId").focus()});k.find(".addInfoId").blur(function(r){q()}).keydown(function(r){if(r.keyCode==13){q()}}).bind("input propertychange",function(){i($(this),$(this).next(),true)});g.on("click",".defineInfoBlue",function(){var s=$(this).data("key");if(s=="ausername"||s=="aphone"||s=="aadress"){return}var r=$(this).find(".info").text();$(this).hide();$(this).siblings(".deleteBtn").hide();$(this).siblings(".editInput").val(r).show().focus()});g.on("blur",".editInput",function(){var r=$(this).val().trim();if(!i($(this),$(this).parent().find(".editInputErr"))){return}$(this).hide();$(this).siblings(".deleteBtn").show();$(this).siblings(".defineInfoBlue").find(".info").text(r);$(this).siblings(".defineInfoBlue").show().focus()});g.on("keydown",".editInput",function(s){if(s.keyCode==13){var r=$(this).val().trim();if(!i($(this),$(this).parent().find(".editInputErr"))){return}$(this).hide();$(this).siblings(".deleteBtn").show();$(this).siblings(".defineInfoBlue").find(".info").text(r);$(this).siblings(".defineInfoBlue").show().focus()}});g.on("input propertychange",".editInput",function(){i($(this),$(this).parent().find(".editInputErr"))});g.on("click",".deleteBtn",function(){if($(this).is(".disabled")){return}$(this).parent().remove()});function q(){if(!i(k.find(".addInfoId"),k.find(".addInfoErr"),true)){return}var r=k.find(".addInfoId").val().trim();if(r){d(r,"aprop"+p++,false);k.find(".addInfoId").val("")}k.find(".addInfoId").hide();k.find(".addDefine").show()}function d(s,u,t,v,w){$newDefineInfo=$('<li><div class="defineInfoBlue"><span class="info"></span></div></li>');$defineInfoBlue=$newDefineInfo.find(".defineInfoBlue");$defineInfoBlue.find(".info").text(s);$defineInfoBlue.data("key",u);$defineInfoBlue.data("isOpen",t);if(v){$defineInfoBlue.addClass("sortDisabled")}if(u!="ausername"&&u!="aphone"&&u!="aadress"){var y="deleteBtn ";var r="";if(m&&j(u)){y+="disabled";r='title="活动发布后不可删除"'}$newDefineInfo.append('<div class="'+y+'" '+r+"></div>");$newDefineInfo.append('<input class="editInput" style="display:none;"></input>');$newDefineInfo.append('<div class="editInputErr" style="display:none;"></div>')}(w?f:g).append($newDefineInfo)}function j(s){var t=gameLast._setting._nodrawcontact;for(var r=0;r<t.length;r++){var u=t[r];if(u.key===s){return true}}return false}function i(s,r,u){var t=s.val().trim();if(!t&&!u){r.text("不能为空").show();l();return false}if(h(t)>20){r.text("最多输入10个汉字或20个英文字母").show();l();return false}r.hide();l();return true}function l(){var r=k.find(".poupContent .addInfoErr:visible").length+g.find(".editInputErr:visible").length;if(r>0){k.find(".confirmBtn").addClass("disabled")}else{k.find(".confirmBtn").removeClass("disabled")}}function h(r){if(r==null){return 0}return r.replace(/[^\x00-\xff]/g,"**").length}};c.setTimepickerLimit=function(f,d,i,h){if(typeof f=="string"){f=new Date(f.replace(/-/g,"/"))}if(typeof f=="number"){f=new Date(f)}var j=f.getTime();var g=i?"max":"min";var e=d.datetimepicker("getDate");h==undefined&&(h=86400000);d.datetimepicker("option",g+"Date",f);d.datetimepicker("option",g+"DateTime",f);if(i){if(e.getTime()>j){return d.datetimepicker("setDate",new Date(j-h))}}else{if(e.getTime()<=j){return d.datetimepicker("setDate",new Date(j+h))}}d.datetimepicker("setDate",e)};var b=375/320;function a(d,e){return e?d/b:d*b}c.regroupPropCssList=function(f,e){var g=[];var d=function(i,h){var j={opt:i.opt};if(h){j.opt=0}j.val=!j.opt?i.defVal:i.val;j.defVal=i.defVal;if(i._parseSize){j.val=a(j.val,1);j.defVal=a(j.defVal,1)}if(typeof i.tra!=="undefined"){j.tra=!j.opt?i.defTra:i.tra;j.defTra=i.defTra}e&&e(j,i);return j};$.each(f,function(h,j){if(j.css){var k={css:[]};if(typeof j.opt!=="undefined"){k.opt=j.opt}e&&e(k,j);$.each(j.css,function(l,i){k.css.push(d(i,k.opt===0))});g.push(k)}else{g.push(d(j))}});return g};c.regroupPropList=function(e){var f=getPreviewWin().hg.edit;if(!f||!f.originDef){return}if(!f.hasInitEle){if(!e.propList){e.propList=gameLast._setting.propList}}else{var d=[];$.each(f.originDef,function(l,m){var h=f.origin[l];var o="editTarget-"+m.name;if($$("."+o).not(".editTarget_input").length===0){return}var t=m.path;var n=false;var p={};p.name=m.name;if(m.pos||m.size||t){if(t&&typeof t[0]!=="string"){n=[];for(var g=0;g<t.length;g++){n.push(o+(g===0?"":("-"+g)))}}var r=c.parsedGameArg(o,n,false,m);if(!r){return}m.pos&&(p.pos=$.parseJSON(r.pos));m.size&&(p.size=$.parseJSON(r.size));if(t){if(/^\[.+]$/.test(r.path)){var s=$.parseJSON(r.path);for(var k=0;k<s.length;k++){s[k]=[s[k]]}p.path=s}else{p.path=[r.path]}if(h.showPath&&h.showPath.length>0){p.showPath=h.showPath}}}if(m.css){p.css=c.regroupPropCssList(m.crrCssArg)}if(m.text){p.text=[];$.each(m.text,function(i,q){if(q.type==1){var u={};u.value=$.trim($$(".editTarget-"+p.name).val());p.text.push(u)}else{if(q.type==2){var j=h.text[0];var u={};u.val=j.val;u.txtopt=j.txtopt;p.text.push(u)}}})}d.push(p)});e.propList=$.toJSON(d)}};c.checkCusAccessKey=function(g,f){var e=null;var h="";var i=$("#cusKey");g||(g=i.val());function d(k){var j=k.length;if(/[^0-9a-zA-Z\u4e00-\u9fa5]/.test(k)||j<=0||j>20){return false}else{return true}}if(f){$(".topBar .column").each(function(j){if($(this).find(".name").text()=="访问密钥"){$(this).trigger("click");return false}});game.$tabSetting.select(0,true);if(!game.$base_hight_set){$(".seniorSetBoxOption").click()}}if(g.trim()==""){h="通用码不能为空！";ERR.addErr(i,h,"","");e={cmd:"breakSave",msg:h}}else{if(!d(g)){h="通用码只能由数字、字母或中文组成，且长度最多为20个字！";ERR.addErr(i,h,"","");e={cmd:"breakSave",msg:h}}else{ERR.removeErr(i)}}return e};c.showManagePopup=function(k){var g;var f=k.game;var j='<div class="accessKeyPopupBox"><div class="editAccessKeyPopup hide"><div class="editAccessKeyPopupContent"><span class="editAccessKeyPopupIcon"></span><input type="text" class="editAccessKeyPopupInput" placeholder="请输入访问密钥" /></div><div class="editAccessKeyPopupErrorMessage hide">密钥不能为空且长度不能超过20个字符</div><div class="editAccessKeyPopupFooter"><span class="editAccessKeyPopupFooterBtn cancelBtn main-Button">取消</span><span class="editAccessKeyPopupFooterBtn accessKeyConfirmBtn main-Button">修改</span></div></div><div class="accessKeyPopupBoxTable" style="height: 500px;"></div></div>';var i='<div class="accessKeyBoxTableToolbar"><div class="number"><span class="item">密钥数量：<i class="blue">0</i></span><span class="item">已使用：<i class="blue">0</i></span><span class="item">剩余：<i class="blue">0</i></span></div><div class="controller"><div class="searchAccessKeyBox left"><input class="searchAccessKey" type="text" placeholder="搜索密钥" /><span class="search-icon"></span></div><span class="toolbarBtn main-Button-blue export">导出</span><span class="toolbarBtn main-Button-blue import">手工导入</span><span class="toolbarBtn main-Button-blue autoGenerator">自动生成</span></div><div class="clear"></div></div>';var d=c.getEditPoup("accessKeyBox",{title:"密钥管理",topBar:i,info:j}).show();var e=d.box.find(".accessKeyPopupBoxTable");(function h(p,n){var l=p.box;var w={name:["deleteAccessKey","autoGenerator","importAccessKey","cmtExportTask"],status:"",options:{hasTitle:false,hasBottom:true,showMask:false,confirmBtnName:"生成",cancelBtnName:"取消"}};var y=function(){setTimeout(function(){w.status="";l.removeData("editClose")},0)};var o=function(){l.data("editClose",function(){return false})};var v=l.find(".editAccessKeyPopup");var u=v.find(".editAccessKeyPopupInput");var s=v.find(".accessKeyConfirmBtn");var m=v.find(".editAccessKeyPopupFooterBtn.cancelBtn");var r=v.find(".editAccessKeyPopupErrorMessage");var t=l.find(".controller .searchAccessKey");var q=l.find(".controller .search-icon");p.$(".bg-mask").on("click",function(z){if(w.status!=""){w[w.status].find(".poupBottom .cancleBtn,.poupTitle .closeBtn").click()}});l.on("click",".accessKeyPopupBoxTable div.accessKeyTableOpeartion span.editAccessKey",function(B){var z=$(B.target);var A=n.faiTable("getPrimaryKeyData",z.parents("tr").attr("_index"));if(z.hasClass("editAccessKeyDisabled")||A.status){return}var C=z.position();v.hide();u.val(A.cusKey||A.keyId);u.data("oldKey",A.cusKey||A.keyId);v.css({left:324+"px",top:C.top+z.outerHeight()+9+"px"});v.show()});l.on("click",".accessKeyPopupBoxTable div.accessKeyTableOpeartion span.deleteAccessKey",function(D){var z=$(D.target);var C=n.faiTable("getPrimaryKeyData",z.parents("tr").attr("_index"));if(z.hasClass("deleteAccessKeyDisabled")||C.status){return}var B='<div style="text-align:center;margin-top: 60px;color: #333;"> 删除密钥后无法恢复。确认删除该密钥吗?</div>';var A=w.name[0];o();m.click();w.status=A;w[A]=HdPortal.popup($.extend({},w.options,{name:A,content:B,confirmBtnName:"确认",width:600,cancelFun:y,confirmFun:function(){var E=function(F,G){y();HdPortal.hdShowMsg(F,G,true)};$.ajax({type:"post",url:"/ajax/hdportal_h.jsp?cmd=delAccessKey&gameid="+f.id+"&key="+C.keyId+"&_TOKEN="+k.downLoadToken,success:function(F){F=JSON.parse(F);if(F.rt){E("error",F.result||"系统繁忙，请稍后再试")}else{HdPortal.logDog(1000153,67);E("right","删除成功")}n.faiTable("loadAjaxPage")},error:function(F){E("error","系统繁忙，请稍后再试")}})}}))});t.on("blue input propertychange",function(){var z=t.val().trim();z=z.replace(/[^0-9a-zA-Z]/g,"");t.val(z)});t.on("keyup",function(z){if(z.keyCode===13){q.click()}});q.on("click",function(){var z=t.val().trim();n.faiTable("rmSearchObj");if(z!=""){n.faiTable("searchString",[{uid:0,cmd:"eq",searchKeyList:k.searchKeyList||[],searchString:z}])}});m.on("click",function(){v.hide();r.hide();u.removeClass("hasErr");s.removeClass("disabled")});u.on("blur input propertychange",function(){var A=u.val().trim();var z=function(C){var B=C.length;if(/[^0-9a-zA-Z]/.test(C)||B<=5||B>20){return false}else{return true}};if(A==""){u.addClass("hasErr");s.addClass("disabled");r.text("密钥不能为空！");r.show()}else{if(!z(A)){u.addClass("hasErr");s.addClass("disabled");r.text("密钥只能由数字、字母组成，且长度为6-20个字！");r.show()}else{u.removeClass("hasErr");s.removeClass("disabled");r.hide()}}});s.on("click",function(){if(s.data("uploading")){HdPortal.hdShowMsg("error","正在提交修改，请勿频繁点击按钮");return}if(u.hasClass("hasErr")||s.hasClass("disabled")){return}s.data("uploading",true);var A=u.data("oldKey");var B=u.val().trim();var z=function(C,D){v.hide();s.data("uploading",false);HdPortal.hdShowMsg(C,D,false)};if(A==B){z("right","修改成功");return}$.ajax({type:"post",url:"/ajax/hdportal_h.jsp?cmd=updateAccessKey&gameid="+f.id+"&_TOKEN="+k.downLoadToken,data:{oldkey:A,newkey:B},success:function(C){C=JSON.parse(C);if(C.rt){z("error",C.result||"系统繁忙，请稍后再试")}else{HdPortal.logDog(1000153,66);z("right","修改成功")}n.faiTable("loadAjaxPage")},error:function(C){z("error","系统繁忙，请稍后再试")}})});l.find(".accessKeyBoxTableToolbar .toolbarBtn.autoGenerator").on("click",function(E){HdPortal.logDog(1000153,61);var B=w.name[1];var D='<div class="autoGeneratorAccessKeyBox"><label for="generatorAccessKeyCount">密钥数量：</label><input id="generatorAccessKeyCount" type="text" class="input1" value="1" /><div class="generatorAccessKeyMessage hide">密钥数量不能为空且每次最多生成10,000个密钥</div></div>';o();w.status=B;w[B]=HdPortal.popup($.extend({},w.options,{name:B,content:D,styles:"width: 428px;",cancelFun:y,confirmFun:function(){function F(G,H){y();HdPortal.hdShowMsg(G,H,false)}$.ajax({type:"post",url:"/ajax/hdportal_h.jsp?cmd=createSysAccessKey&gameid="+f.id+"&num="+encodeURI(parseInt(A.val()))+"&_TOKEN="+k.downLoadToken,success:function(G){G=JSON.parse(G);if(G.rt){F("error",G.result||"系统繁忙，请稍后再试")}else{HdPortal.logDog(1000153,62);F("right","成功生成密钥！")}n.faiTable("loadAjaxPage")},error:function(G){F("error","系统繁忙，请稍后再试")}})}}));var A=w[B].find(".autoGeneratorAccessKeyBox #generatorAccessKeyCount");var z=w[B].find(".poupBottom div.confirmBtn");var C=w[B].find(".autoGeneratorAccessKeyBox .generatorAccessKeyMessage");A.off("blur input propertychange").on("blur input propertychange",function(G){var H=A.val();var F=function(){C.show();A.addClass("hasErr");z.addClass("disabled")};H=H.replace(/[^0-9]/g,function(J,I){return""});A.val(H);H=parseInt(H);if(isNaN(H)||H<=0||H>10000){F()}else{C.hide();A.removeClass("hasErr");z.removeClass("disabled")}})});l.find(".accessKeyBoxTableToolbar .toolbarBtn.import").on("click",function(){HdPortal.logDog(1000153,63);var A=w.name[2];var D='<div class="importAccessKeyBox"><div class="tipMessage"><span class="left">请按示例模板格式填写密钥后上传</span><a href="'+k.resRoot+'/version2/image/nostore/自定义上传密钥模板.xls?v=201804111723" class="accessKeyLink">下载模板</a><div class="clear"></div></div><div class="comUploadBox"><form id="uploadFileForm" enctype="multipart/form-data"><span class="btn"><input type="file" class="uploadInput theSpecialDesigan" name="ctrl" accept="application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" /><a class="uploadBtn uploadify-button main-Button">上传</a></span><span class="uploadText hide"></span></form></div><div class="importAccessKeyMessage hide"><span class="warningIcon"></span><span class="text"></span></div><div class="outLengthPopup hide"><div class="outLengthList"></div><div class="outLengthConfirmBtn accessKeyLink">我知道了</div></div></div>';o();w.status=A;w[A]=HdPortal.popup($.extend({},w.options,{name:A,content:D,styles:"width: 430px;",cancelFun:y,confirmFun:function(){console.log(!g);if(!g){return}closeing=true;var J=new FormData();J.append("filedata",g);$.ajax({type:"post",url:"/ajax/hdportal_h.jsp?cmd=createCusAccessKey&gameid="+f.id,data:J,contentType:false,processData:false,success:function(K){K=JSON.parse(K);if(K.rt){HdPortal.hdShowMsg("error",K.result||"系统繁忙，请稍后再试",false)}else{HdPortal.logDog(1000153,64);HdPortal.hdShowMsg("right","成功生成密钥！",false);n.faiTable("loadAjaxPage")}y()},error:function(K){y();HdPortal.hdShowMsg("error","系统繁忙，请稍后再试",false)}})}}));var F=w[A].find(".importAccessKeyBox .comUploadBox .uploadBtn");var C=w[A].find(".importAccessKeyBox .comUploadBox .uploadText");var z=w[A].find(".importAccessKeyBox .comUploadBox .uploadInput");var E=w[A].find(".importAccessKeyBox .importAccessKeyMessage");var B=w[A].find(".poupBottom div.confirmBtn");var I=w[A].find(".outLengthPopup");var H=I.find(".outLengthList");var G=I.find(".outLengthConfirmBtn");B.addClass("disabled");E.off("click",".text .outLength").on("click",".text .outLength",function(J){I.show()});G.off("click").on("click",function(J){I.hide()});F.off("click").on("click",function(J){J.preventDefault();J.stopPropagation();z.click()});z.off("change").on("change",function(L){var J=this;g=this.files[0];F.text("重新上传");if(!g){return}HdPortal.wxCardProgress.init();B.addClass("disabled");var K=new FormData();K.append("filedata",g);$.ajax({type:"post",url:"/ajax/hdportal_h.jsp?cmd=uploadCusAccessKey&gameid="+f.id+"&_TOKEN="+k.downLoadToken,data:K,contentType:false,processData:false,success:function(M){M=JSON.parse(M);HdPortal.wxCardProgress.end(function(){if(M.rt){HdPortal.hdShowMsg("error",M.result||"系统繁忙，请稍后再试",false);C.hide();B.addClass("disabled");E.hide()}else{HdPortal.hdShowMsg("right","上传成功!",false);if(M.num!==-1){C.show();C.text("可生成密钥数量："+M.num);B.removeClass("disabled")}else{E.hide();C.hide();E.find(".text").text("密钥生成失败，请重试");B.addClass("disabled")}}if(M.data){if(M.data.outLen&&M.data.outLen.length){E.show();E.find(".text").html('部分密钥超过20个字符，不可生成<span class="accessKeyLink outLength">查看详细</span>');H.text(M.data.outLen.join("、"));B.addClass("disabled")}else{if(M.data.isRepeat){E.show();B.removeClass("disabled");E.find(".text").text("存在重复密钥，已去重处理")}}}});J.value=""},error:function(M){HdPortal.wxCardProgress.die(function(){J.value="";HdPortal.hdShowMsg("error","系统繁忙，请稍后再试",false);E.hide();C.hide();B.addClass("disabled")})}})})});l.find(".accessKeyBoxTableToolbar .toolbarBtn.export").on("click",function(){$.ajax({type:"post",url:"/ajax/hdexport_h.jsp?cmd=exportAccessKeyCount&gameid="+f.id+"&_TOKEN="+k.downLoadToken,success:function(z){z=JSON.parse(z);if(z.rt){HdPortal.hdShowMsg("error","系统繁忙，请稍后再试",false);return}if(z.num<=20000){window.location.href="/ajax/hdexport_h.jsp?cmd=exportAccessKey&gameid="+f.id+"&_TOKEN="+k.downLoadToken;HdPortal.logDog(1000153,65)}else{var A=w.name[3];w.status=A;o();w[A]=HdPortal.showCmtExportTask(function(){$.ajax({type:"post",url:"/ajax/hdexport_h.jsp?cmd=exportAccessKeyTask&gameid="+f.id+"&_TOKEN="+k.downLoadToken,success:function(B){HdPortal.logDog(1000153,65)}});y();setTimeout(function(){p.hide();HdPortal.showExportCenterEntrance()},400)},y)}},error:function(z){HdPortal.hdShowMsg("error","系统繁忙，请稍后再试",false)}})})}(d,e));e.faiTable({tableColumn:{showCheckbox:false,columns:[{key:"key",name:"密钥",colClass:"textCenter",rowClass:"textCenter",onsort:false,extData:function(l,m){return m.cusKey||m.keyId}},{key:"status",name:"状态",colClass:"textCenter",rowClass:"textCenter",onsort:false,extData:function(l,m){return m.status?"已使用":"未使用"}},{key:"username",name:"使用者",colClass:"textCenter",rowClass:"textCenter",onsort:false,extData:function(l,m){return m.status?m.playerName:"-"}},{key:"usedTime",name:"使用时间",colClass:"textCenter",rowClass:"textCenter",onsort:false,extData:function(l,m){return m.status?HdPortal.getDateStringSecond(m.usedTime):"-"}},{key:"opeartion",name:"操作",colClass:"textCenter",rowClass:"textCenter",onsort:false,extData:function(l,m){var n='<span class="item editAccessKey">修改</span><span class="item deleteAccessKey">删除</span>';if(m.status){n='<span class="item editAccessKey editAccessKeyDisabled" title="已使用的密钥不可修改">修改</span><span class="item deleteAccessKey deleteAccessKeyDisabled" title="已使用的密钥不可删除">删除</span>'}return'<div class="accessKeyTableOpeartion">'+n+"</div>"}}]},ajaxPage:{url:"/ajax/hpFaiTabel_h.jsp?cmd=getAllAccessKey&gameid="+f.id+"&_TOKEN="+k.downLoadToken,cache:false,regroup:function(m){var l=m.totalCount||0;var o=Math.max(0,m.usedNum);var n='<span class="item">密钥数量：<i class="blue">'+l+'</i></span><span class="item">已使用：<i class="blue">'+o+'</i></span><span class="item">剩余：<i class="blue">'+(l-o)+"</i></span>";d.box.find(".accessKeyBoxTableToolbar .number").html(n)}},bottom:{show:true,showTotal:true,showAllTotal:true,showPage:true,showPageJump:true,showPageNumSelect:false},page:{startPage:1,showCount:10},itemHover:true,noDataMsg:"<center>没有数据</center>"});c.showManagePopup=d.show.bind(d);return d};c.initReplyContent=function(e,f){var g=f.award;f.replyDefineInfo=[{title:"登记成功",val:"登记成功，请等待派发奖品",},{title:"券码已核销",val:"该券号已经登记过了，请耐心等待派发奖品",},{title:"券码已过期",val:"兑奖期限已过，请联系管理员",}];var d=!g.replyDefine||g.replyDefine[0]=="false";if(!d){$.each(g.replyDefine,function(j,h){if(j==0){return}f.replyDefineInfo[j-1].val=h})}if(passAuthVer(HdPortal.hdVer.BJ,false,!d)){$.each(f.replyDefineInfo,function(h){f.$watch("replyDefineInfo["+h+"].val",function(k,j){if(k==j){return}var i=e.find(".replyDefineInput"+h);if(k.length==0||k.length>600){ERR.addErr(i,"输入不能为空且长度不超过600个字");return}ERR.removeErr(i);if(d){if(!g.replyDefine){g.replyDefine=["true"];$.each(f.replyDefineInfo,function(m,l){g.replyDefine.push(l.val)})}else{if(g.replyDefine[0]=="false"){g.replyDefine[0]="true"}}d=false}g.replyDefine[h+1]=k})})}else{if(!d){g.replyDefine[0]="false"}f.$$postDigest(function(){var h=e.find(".mainInput").addClass("disableBg").attr("readonly",true);if(game.$$isOem){return}e.find(".powerIcon").on("mouseover",function(){c.showNoSupportTips($(this),"自定义回复内容为互动"+game.$$verInfo.bjName+"功能",3,8)});h.on("click",function(){$(this).closest(".verTipsBox").find(".powerIcon").trigger("mouseover")})})}};c.editCancelVerCode=function(){if(game.id<=0){return}if(!game._codeList||game.hasSaveCode){$.ajax({url:"/ajax/hdportal_h.jsp?cmd=getVerificationCodeList",type:"post",data:{storeId:g_storeId,areaId:g_areaId},success:function(h){h=JSON.parse(h);if(h.success){game.hasSaveCode=false;game._codeList=[].concat(h.list);game.codeList=[].concat(h.list);game.delIdArr=[];game._delIdArr=[];game.addList=[];game._addList=[];var g="";for(var j=0;j<game.codeList.length;j++){g+='<div class="codeitem"'+(game.codeList[j].remark.length==0?"":' title="备注：'+game.codeList[j].remark)+'" data-id='+game.codeList[j].id+">"+game.codeList[j].code+'<span class="close"></span></div>'}f(g)}else{HdPortal.hdShowMsg("error","获取核销码列表失败，请稍后再试",true)}},error:function(){HdPortal.hdShowMsg("error","服务器繁忙，请稍后再试",true)}})}else{var d="";for(var e=0;e<game.codeList.length;e++){d+='<span class="codeitem"'+(game.codeList[e].remark.length==0?"":' title="备注：'+game.codeList[e].remark)+'" data-id='+game.codeList[e].id+">"+game.codeList[e].code+'<span class="close"></span></span>'}f(d)}function f(g){var h={name:"editCancelverBox",content:'<div class="headtip clearfix"><p class="tiptext">已添加了<span class="addedNum"></span>个核销码；最多能添加3000个核销码 ; 保存后将核销码分配给线下核销员</p><div class="editBtn"><span class="cancelVerCode_output">导出</span><span class="cancelVerCode_add">添加</span><div class="add_dialog"><span class="arrow_wrap"></span><div><label for="verCode" class="c_left"><span class="flag">*</span>核销码：</label><input type="text" class="c_right" id="verCode"></div><div><label for="" class="c_left"></label><span class="c_right tip" id="addCodeTip">必须是3-6位的数字或英文字母，不区分大小写</span></div><div><label for="verRemark" class="c_left">备注：</label><input type="text" class="c_right" id="verRemark"></div><div class="remarkTip hide"><label for="" class="c_left"></label><span class="c_right tip" id="addRemarkTip">长度不超过15个字</span></div><div class="btn_btm"><span class="btn_cancel main-Button-blue">取消</span><span class="addBtn titleBtn main-Button">添加</span></div></div></div></div><div class="codelist">'+g+"</div>",hasTitle:true,hasBottom:true,title:"配置核销码",width:680,height:0,showMask:true,confirmBtnName:"保存",cancelBtnName:"取消",confirmFun:function(){game.editCodeConfirm=true;game._codeList=[].concat(game.codeList);game._addList=[].concat(game.addList);game._delIdArr=[].concat(game._delIdArr);if(!game.hasSaveCode&&((game.addList&&game.addList.length>0)||(game.delIdArr&&game.delIdArr.length>0))){$.ajax({url:"/ajax/hdportal_h.jsp?cmd=saveVerificationCodeList",type:"post",data:{storeId:g_storeId,areaId:g_areaId,addList:JSON.stringify(game.addList),delList:JSON.stringify(game.delIdArr)},success:function(j){j=JSON.parse(j);if(j.success){HdPortal.hdShowMsg("right",j.msg,true);game.hasSaveCode=true}else{HdPortal.hdShowMsg("error",j.msg,true)}},error:function(){HdPortal.hdShowMsg("error","服务器繁忙，请稍后再试",true)}})}},cancelFun:function(){game.codeList=[].concat(game._codeList);game.addList=[].concat(game._addList);game.delIdArr=[].concat(game._delIdArr)},closeFun:function(){if(!game.editCodeConfirm){game.codeList=[].concat(game._codeList);game.addList=[].concat(game._addList);game.delIdArr=[].concat(game._delIdArr);delete game.editCodeConfirm}},styles:"",contentStyles:"",hasAnimate:true,isComfirmBox:true};var i=HdPortal.popup(h);i.find(".addedNum").text(game.codeList.length);i.on("click",".cancelVerCode_add",function(){i.find(".add_dialog").show()});i.on("click",".btn_cancel",function(){i.find(".add_dialog").hide();i.find("#verCode").css({border:"1px solid #e7e7e7"}).val("");i.find("#addCodeTip").css({color:"#585858"}).html("必须是3-6位的数字或英文字母，不区分大小写");i.find("#verCode").removeClass("inputErr ERR_hasErr");i.find("#verRemark").removeClass("inputErr ERR_hasErr").val("");i.find(".remarkTip").hide();i.find(".addBtn").removeClass("disabled")});i.find("#verCode,#verRemark").css({paddingLeft:"10px"});i.on("click",".close",function(){var k=$(this);var j={name:"vercodeDelComfirm",hasTitle:false,content:"删除后该核销码将无法使用，确认删除？",width:680,contentStyles:"text-align: center;padding-top: 70px",confirmFun:function(){var p=k.parent().data("id");for(var o=0;o<game.codeList.length;o++){if(game.codeList[o].id==p){if(/_code/.test(p)){for(var n=0;n<game.addList.length;n++){if(game.addList[n].code+"_code"==p){game.addList.splice(n,1);break}}}else{game.delIdArr.push(p)}game.codeList.splice(o,1);var l="";for(var m=0;m<game.codeList.length;m++){l+='<span class="codeitem"'+(game.codeList[m].remark.length==0?"":' title="备注：'+game.codeList[m].remark)+'" data-id='+game.codeList[m].id+">"+game.codeList[m].code+'<span class="close"></span></span>'}i.find(".codelist").html(l);i.find(".addedNum").text(game.codeList.length);break}}}};HdPortal.popup(j)});i.on("input propertychange","#verCode",function(){var j=$(this).val().trim();if(/^[a-zA-Z0-9]{3,6}$/.test(j)){i.find("#verCode").removeClass("inputErr ERR_hasErr");i.find("#addCodeTip").css({color:"#585858"})}else{i.find("#verCode").addClass("inputErr ERR_hasErr");i.find("#addCodeTip").css({color:"red"}).html("必须是3-6位的数字或英文字母，不区分大小写")}i.find(".addBtn").toggleClass("disabled",ERR.hasErr(i)>0)}).on("input propertychange","#verRemark",function(){var j=$(this).val().trim();if(j.length>15){$(this).addClass("inputErr ERR_hasErr");i.find(".remarkTip").show()}else{$(this).removeClass("inputErr ERR_hasErr");i.find(".remarkTip").hide()}i.find(".addBtn").toggleClass("disabled",ERR.hasErr(i)>0)});i.on("blur","#verCode",function(){var j=i.find("#verCode").val();if(j==""){$(this).addClass("inputErr ERR_hasErr");i.find("#addCodeTip").css({color:"red"}).html("输入不能为空")}else{if((/^[a-zA-Z0-9]{3,6}$/.test(j))){$(this).removeClass("inputErr ERR_hasErr");i.find("#addCodeTip").css({color:"#585858"}).html("必须是3-6位的数字或英文字母，不区分大小写")}}i.find(".addBtn").toggleClass("disabled",ERR.hasErr(i)>0)});i.on("click",".addBtn",function(){var l=3000;if(game.codeList&&game.codeList.length>=l){HdPortal.hdShowMsg("error","最多只能添加"+l+"个核销码！",true);return}var p=i.find("#verCode").val().trim().toLowerCase();var q=i.find("#verRemark").val().trim();if(p==""){i.find("#verCode").addClass("inputErr ERR_hasErr");i.find("#addCodeTip").css({color:"red"}).html("输入不能为空");return}if(!(/^[a-zA-Z0-9]{3,6}$/.test(p))){return}for(var o=0;o<game.codeList.length;o++){if(game.codeList[o].code==p){HdPortal.hdShowMsg("error","该核销码已存在，请重新输入",true);i.find("#verCode").val("");i.find("#verRemark").val("");return}}for(var n=0;n<game._codeList.length;n++){if(game._codeList[n].code==p){var m=game.delIdArr.indexOf(game._codeList[n].id);game.delIdArr.splice(m,1);game.codeList.push(game._codeList[n]);var k='<span class="codeitem"'+(game._codeList[n].remark.length==0?"":' title="备注：'+game._codeList[n].remark)+'" data-id='+game._codeList[n].id+">"+game._codeList[n].code+'<span class="close"></span></span>';i.find(".codelist").append(k);HdPortal.hdShowMsg("right","添加成功",true);i.find(".addedNum").text(game.codeList.length);return}}i.find("#verCode").val("");i.find("#verRemark").val("");var r={};var k="";r.code=p;r.remark=q;r.id=p+"_code";game.codeList.push(r);k='<span class="codeitem"'+(r.remark.length==0?"":' title="备注：'+r.remark)+'" data-id='+r.id+">"+r.code+'<span class="close"></span></span>';HdPortal.hdShowMsg("right","添加成功",true);i.find(".addedNum").text(game.codeList.length);i.find(".codelist").append(k);i.find(".add_dialog").hide();game.addList.push({code:p,remark:q})});i.on("click",".cancelVerCode_output",function(){$("#downloadExcel").attr("action","/ajax/hdportal_h.jsp?cmd=exportVerificationCode&storeId="+g_storeId+"&areaId="+g_areaId);$("#downloadExcel").submit()})}};c.initLayout=function(){c.initHoverTips($(".editDetail"));$(document.body).on("showDatepicker","#ui-datepicker-div",function(d){var e=$(this);e.css("top",parseFloat(e.css("top"))+6)})};c.initHoverTips=function(d,e){var f=function(i,j,h){var g=i.attr("_args");g=g?$.parseJSON(g):["down",null,"left"];h&&(g[1]=$.extend(g[1],h));return[i.children(".target"),g[0],j,g[1],g[2]]};HdPortal.hoverTipsBox.link({time:function(h){var g=parseFloat(h.attr("_time"));isNaN(g)&&(g=100);return g},agent:[d,".hoverContentBox"],enter:function(i,j,h){var g=j.children(".hoverTipsBox");if(g.length>0){if(!g.data("_hasLayout")){HdPortal.hoverTipsBox.layout.apply(HdPortal.hoverTipsBox,f(j,g));g.data("_hasLayout",true)}return g}}},function(h){var g="";h.find(".content").each(function(i,j){g+=this.outerHTML});if(!g){return false}return f(h,g,{html:true,parent:".settingLine"})})};c.getAsynchPoup=function(g){g=$.extend({key:"",initData:null,resKey:"",layout:"layout",},g);g.resKey=g.resKey||g.key;var f=HdPortal.getAsynchPopup({resKey:g.resKey,closeEvent:"",popup:function(l,k,j){return c.getEditPoup(e(j),function(m){return i(l,m,k,j)}).show()}});if($.type(g.layout)=="string"){var d=g.layout;g.layout=function(){return f[d].apply(f,arguments)}}return f;function e(j){if(!j){return g.key}return g.key+"_"+j.replace(/\./g,"_")}function i(m,j,l,k){m(function(){j.layout(h(g.layout,j,l,k))},j.box);return h(g.initData,j,l,k)}function h(m,j,l,k){if($.type(m)=="function"){m=m(j,l,k)}return m}};c.showFaiArea=c.getAsynchPoup({key:"faiArea",initData:function(d,e){return{maskClose:false,width:660,className:"faiArea",title:"选择"+$(e).closest(".settingLine").find(".leftTitle .name").text().replace("：",""),}}});c.showWxShareText=c.getAsynchPoup({key:"wxShareText",initData:{maskClose:false,width:648,title:"分享内容设置"},})})(Edit);$(function(){Edit.initLayout();$(".replaceBox").each(function(a,b){var c=$(this);var d=c.attr("_target");if(d){d=$("#"+d);if(d.length>0){c.after(d);c.remove()}}})});